(self.webpackChunk_gooddata_sdk_ui_web_components=self.webpackChunk_gooddata_sdk_ui_web_components||[]).push([[205],{72338:(t,e,i)=>{i.r(e),i.d(e,{ContextDeferredAuthProvider:()=>Il,default:()=>Pl,redirectToBearAuthentication:()=>Rl,redirectToBearSsoAuthentication:()=>Sl}),i(85890);var r=i(81028),s=i.n(r),a=i(37693),n=i.n(a);function o(t){return!n()(t)&&void 0!==t.visualizationObject}function l(t){return!n()(t)&&void 0!==t.measure}function u(t){return!n()(t)&&void 0!==t.visualizationAttribute}function c(t){return!n()(t)&&(void 0!==t.positiveAttributeFilter||void 0!==t.negativeAttributeFilter)}function d(t){return!n()(t)&&void 0!==t.positiveAttributeFilter}function h(t){return function(t){var e,i;return null!==(i=null===(e=function(t){return e=t.definition,n()(e)||void 0===e.measureDefinition?void 0:t.definition.measureDefinition;var e}(t))||void 0===e?void 0:e.filters)&&void 0!==i?i:[]}(t).filter(c)}function p(t){return d(t)?t.positiveAttributeFilter.displayForm.uri:t.negativeAttributeFilter.displayForm.uri}function g(t){const e=function(t){return t.buckets.reduce(((t,e)=>(t.push(...function(t){return t.items.reduce(((t,e)=>(u(e)&&t.push(e.visualizationAttribute),t)),[])}(e)),t)),[])}(t).map((t=>t.displayForm.uri)),i=function(t){return function(t){return t.buckets.reduce(((t,e)=>(t.push(...function(t){return t.items.reduce(((t,e)=>(l(e)&&t.push(e.measure),t)),[])}(e)),t)),[])}(t).reduce(((t,e)=>(t.push(...h(e)),t)),[])}(t);return[...i.map(p),...e]}var m=i(65890),f=i(93064),b=i.n(f),y=i(49274),v=i.n(y),w=i(53991),j=i.n(w),C=i(36553),O=i.n(C),D=i(46186),x=i.n(D),k=i(3335),F=i.n(k),A=i(94778),I=i.n(A);const P=(t,e)=>I().stringify(t,Object.assign(Object.assign({},e),{arrayFormat:"comma"})),R="X-GDC-DEPRECATED",S={name:"@gooddata/api-client-bear",version:"0.0.0-dev.0"};function T(t,e){const i={setRequestHeader(t,i){j()(e,["headers",t],i)}};v()(e.beforeSend)&&e.beforeSend(i,t)}function E(t,e,i){let r=t;const s=e;return i&&(-1===t.indexOf(i)&&(r=i+t),s.mode="cors",s.credentials="include"),{url:r,settings:s}}function $({name:t,version:e}){return{"X-GDC-JS-PKG":t,"X-GDC-JS-PKG-VERSION":e}}class z extends Error{constructor(t,e){super(t),this.cause=e,Object.setPrototypeOf(this,new.target.prototype)}}class B extends z{constructor(t,e,i){super(t,null),this.response=e,this.responseBody=i}}class U extends z{}class M{constructor(t,e){this.response=t,this.responseBody=e}get data(){return this.getDataInner()}getData(){return this.getDataInner()}getRawData(){return this.responseBody}getHeaders(){return this.response}getDataInner(){if("string"==typeof this.responseBody)try{return JSON.parse(this.responseBody)}catch(t){throw new Error("Cannot parse responseBody.")}throw new Error("ArrayBuffer ResponseBody cannot be parsed to requested type.")}}let L=!0;class W{constructor(t,e){this.fetch=t,this.configStorage=e,O()(e,{xhrSettings:{}})}ensureNoLeadingTokenRequest(){this.tokenRequest=null}ajaxSetup(t){Object.assign(this.configStorage.xhrSettings,t)}async ajax(t,e={}){var i,r;const s=this.createRequestSettings(e),{url:a,settings:n}=E(t,s,this.configStorage.domain);if(T(a,n),this.tokenRequest)return this.continueAfterTokenRequest(a,n);let o;try{o=await this.fetch(a,n)}catch(t){throw new U(t.message,t)}const l=n.arrayBufferResponseBody?await o.arrayBuffer():await o.text();if(401===o.status){const t=-1!==a.indexOf("/gdc/account/login"),e=-1!==a.indexOf("/gdc/account/token");if(t||e)throw new B("Unauthorized",o,l);return this.handleUnauthorized(a,n)}if(202===o.status&&!n.dontPollOnResult){let t;try{t=JSON.parse(this.responseBodyAsString(l))}catch(e){t={}}const e=""!==o.url?o.url:void 0;let s=null!==(r=null!==(i=t.uri)&&void 0!==i?i:e)&&void 0!==r?r:a;const u=n;return o.headers.has("Location")&&(s=o.headers.get("Location")),u.method="GET",delete u.data,delete u.body,function(t,e,i){const r=F()(e,"pollDelay");return new Promise(((s,a)=>{setTimeout((()=>{i(t,e).then(s,a)}),r)}))}(s,u,this.ajax.bind(this))}if(this.verifyRestApiDeprecationStatus(o.headers),o.status>=200&&o.status<=399)return new M(o,l);throw new B(o.statusText,o,this.responseBodyAsString(l))}get(t,e){return this.ajax(t,x()({method:"GET"},e))}getParsed(t,e={}){const{data:i}=e,r=(0,m._T)(e,["data"]);let s=t;return i&&(s=`${t}?${P(i)}`),this.ajax(s,x()({method:"GET"},r)).then((t=>t.getData()))}head(t,e){return this.ajax(t,x()({method:"HEAD"},e))}post(t,e){return this.ajax(t,x()({method:"POST"},e))}postParsed(t,e){return this.ajax(t,x()({method:"POST"},e)).then((t=>t.getData()))}put(t,e){return this.ajax(t,x()({method:"PUT"},e))}del(t,e){return this.ajax(t,x()({method:"DELETE"},e))}createRequestSettings(t){const e=x()({headers:Object.assign({Accept:"application/json; charset=utf-8","Content-Type":"application/json","X-GDC-VERSION":5},$(this.configStorage.originPackage||S))},this.configStorage.xhrSettings,t);return e.pollDelay=void 0!==e.pollDelay?e.pollDelay:1e3,e.body=e.data?e.data:e.body,e.mode="same-origin",e.credentials="same-origin",b()(e.body)&&(e.body=JSON.stringify(e.body)),e}continueAfterTokenRequest(t,e){return this.tokenRequest.then((async i=>{if(!i.ok)throw new B("Unauthorized",i,null);return this.tokenRequest=null,this.ajax(t,e)}),(t=>(this.tokenRequest=null,t)))}async handleUnauthorized(t,e){if(this.tokenRequest)return this.continueAfterTokenRequest(t,e);const{url:i,settings:r}=E("/gdc/account/token",this.createRequestSettings({}),this.configStorage.domain);T(i,r),this.tokenRequest=this.fetch(i,r);const s=await this.tokenRequest,a=await s.text();if(this.tokenRequest=null,401===s.status)throw new B("Unauthorized",s,a);if(!s.ok)throw new B(s.statusText,s,a);return this.ajax(t,e)}logDeprecatedRestApiCall(t){console.warn(`The REST API version 5 is deprecated (${t}). Please migrate your application to use GoodData.UI SDK or @gooddata/api-client-bear package that supports newer version of the API.`)}isRestApiDeprecated(t){return t.has(R)}verifyRestApiDeprecationStatus(t){if(L&&this.isRestApiDeprecated(t)){const e=t.get(R);this.logDeprecatedRestApiCall(e),L=!1}}responseBodyAsString(t){const e=new TextDecoder("utf-8");return t instanceof ArrayBuffer?e.decode(t):t}}var N=i(73734),G=i(20253),q=i.n(G),V=i(46139),H=i.n(V),_=i(44384);function K(t){return new Promise((e=>{setTimeout((()=>e()),t)}))}function J(t){const e=t.status;return 200===e||e>=400}const Q=t=>{const e=t.headers.get("Content-Disposition")||"",i=/filename\*?=([^']*'')?([^;]*)/.exec(e),r=i?i[2]:void 0;return r?decodeURIComponent(r):void 0},Z=t=>{switch(t){case"csv":return"text/csv";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";default:return"application/octet-stream"}},X=i.n(_)()((t=>!!q()(t)||!!H()(t)&&n()(t))),Y=t=>{var e;return null===(e=null==t?void 0:t.query)||void 0===e?void 0:e.entries},tt=(t,e,i,r={})=>{const{attempts:s=0,maxAttempts:a=50,pollStep:n=5e3}=r;return t(e).then((t=>t.getData())).then((o=>s>a?Promise.reject(new Error(o)):i(o)?Promise.resolve(o):K(n).then((()=>tt(t,e,i,Object.assign(Object.assign({},r),{attempts:s+1}))))))},et=(t,e,i,r={})=>{const{attempts:s=0,maxAttempts:a=50,pollStep:n=5e3,blobContentType:o}=r;return t(e,{arrayBufferResponseBody:void 0!==o}).then((o=>{if(s>a)return Promise.reject(new Error("Export timeout!!!"));const l=o.getHeaders();if(i(l,o)){if(200===l.status){if(r.blobContentType){const t=new Blob([o.getRawData()],{type:r.blobContentType});return Promise.resolve({uri:e,objectUrl:URL.createObjectURL(t),fileName:Q(l)})}return Promise.resolve({uri:e})}return Promise.reject(new B(o.statusText,o,o.getData()))}return K(n).then((()=>et(t,e,i,Object.assign(Object.assign({},r),{attempts:s+1}))))}))},it=/\/gdc\/md\/\S+\/obj\/\d+/,rt=t=>it.test(t);function st(t){return t?`?${Object.keys(t).map((e=>{return i=e,r=t[e],Array.isArray(r)?r.map((t=>`${encodeURIComponent(i)}=${encodeURIComponent(t)}`)).join("&"):`${encodeURIComponent(i)}=${encodeURIComponent(r)}`;var i,r})).join("&")}`:""}function at(t,e,i,r=0,s=[]){return new Promise(((a,n)=>{t.get(`${e}?offset=${r}&limit=100`).then((t=>t.getData())).then((n=>{var o,l;const u=null==n?void 0:n[i],c=s.concat(u.items),d=null!==(l=null===(o=null==u?void 0:u.paging)||void 0===o?void 0:o.totalCount)&&void 0!==l?l:0,h=r+100;a(h>d?c:at(t,e,i,h,c))}),n)}))}const nt=t=>{if("true"===t)return!0;if("false"===t)return!1;const e=Number(t);return e.toString()===t?e:t},ot=[{r:43,g:107,b:174},{r:105,g:170,b:81},{r:238,g:177,b:76},{r:213,g:60,b:56},{r:137,g:77,b:148},{r:115,g:115,b:115},{r:68,g:169,b:190},{r:150,g:189,b:95},{r:253,g:147,b:105},{r:225,g:93,b:134},{r:124,g:111,b:173},{r:165,g:165,b:165},{r:122,g:166,b:213},{r:130,g:208,b:141},{r:255,g:210,b:137},{r:241,g:132,b:128},{r:191,g:144,b:198},{r:191,g:191,b:191}];class lt{constructor(t){this.xhr=t}getCurrentProjectId(){return this.xhr.getParsed("/gdc/app/account/bootstrap/projectId").then((t=>t.projectId))}getProject(t){return this.xhr.getParsed(`/gdc/projects/${t}`)}getProjects(t){return at(this.xhr,`/gdc/account/profile/${t}/projects`,"projects").then((t=>t.map((t=>t.project))))}getProjectsWithPaging(t,e,i,r){const s={limit:i,offset:e,userId:t,projectStates:"ENABLED",userState:"ENABLED"};r&&(s.titleSubstring=r);const a=`/gdc/internal/projects/?${P(s)}`;return this.xhr.get(a).then((t=>t.getData()))}getDatasets(t){return this.xhr.get(`/gdc/md/${t}/query/datasets`).then((t=>t.getData())).then(Y)}getColorPalette(t){return this.xhr.get(`/gdc/projects/${t}/styleSettings`).then((t=>t.getData())).then((t=>t?t.styleSettings.chartPalette.map((t=>({r:t.fill.r,g:t.fill.g,b:t.fill.b}))):ot)).catch((t=>{if(!(t instanceof z))return ot;throw t}))}getColorPaletteWithGuids(t){return this.xhr.get(`/gdc/projects/${t}/styleSettings`).then((t=>t.getData())).then((t=>(null==t?void 0:t.styleSettings)?t.styleSettings.chartPalette:void 0)).catch((t=>{if(t instanceof z)throw t}))}setColorPalette(t,e){return this.xhr.put(`/gdc/projects/${t}/styleSettings`,{body:{styleSettings:{chartPalette:e.map(((t,e)=>({fill:t,guid:`guid${e}`})))}}})}getTimezone(t){const e=`/gdc/app/projects/${t}/timezone`;return this.xhr.getParsed(e).then((t=>t.timezone))}setTimezone(t,e){const i=`/gdc/md/${t}/service/timezone`,r={service:{timezone:e}};return this.xhr.post(i,{body:r}).then((t=>t.getData()))}createProject(t,e,i={}){const{summary:r,projectTemplate:s,driver:a="Pg",environment:n="TESTING",guidedNavigation:o=1}=i;return this.xhr.post("/gdc/projects",{body:JSON.stringify({project:{content:{guidedNavigation:o,driver:a,authorizationToken:e,environment:n},meta:{title:t,summary:r,projectTemplate:s}}})}).then((t=>t.getData())).then((t=>tt(this.xhr.get.bind(this.xhr),t.uri,(t=>(t=>{const e=t.content.state;return"ENABLED"===e||"DELETED"===e})(t.project)),i)))}deleteProject(t){return this.xhr.del(`/gdc/projects/${t}`)}getFeatureFlags(t){return this.xhr.get(`/gdc/app/projects/${t}/featureFlags`).then((t=>t.getData())).then((t=>(null==t?void 0:t.featureFlags)?t.featureFlags:{}))}getConfig(t){return this.xhr.get(`/gdc/app/projects/${t}/config`).then((t=>t.getData())).then((t=>{var e;return(null===(e=null==t?void 0:t.settings)||void 0===e?void 0:e.items)?t.settings.items:[]}))}getConfigItem(t,e){return this.xhr.get(`/gdc/app/projects/${t}/config/${e}`).then((t=>t.getData())).catch((t=>{var e;if(404!==(null===(e=null==t?void 0:t.response)||void 0===e?void 0:e.status))throw t}))}getProjectFeatureFlags(t,e){return this.getConfig(t).then((t=>{const i=e?t.filter((t=>t.settingItem.source===e)):t,r={};return i.forEach((t=>{r[t.settingItem.key]=nt(t.settingItem.value)})),r}))}getUserListWithPaging(t,e){return this.xhr.getParsed(`/gdc/projects/${t}/userlist`,{data:e})}getUserList(t,e){const i=async(r=0,s=1e3,a=[])=>this.getUserListWithPaging(t,Object.assign(Object.assign({},e),{limit:s,offset:r})).then((({userList:{items:t,paging:{count:e}}})=>{const n=[...a,...t];return e<s?n:i(r+s,s,n)}));return i()}getUserGroups(t,e){const{offset:i="0",limit:r=100}=e;return this.xhr.getParsed(`/gdc/userGroups?project=${t}&offset=${i}&limit=${r}`)}getGranteesInfo(t,e){const{permission:i="read"}=e,r=t.replace("/md/","/projects/");return this.xhr.getParsed(`${r}/grantees?permission=${i}`)}convertGrantees(t=[]){return t.map((t=>({aclEntryURI:{permission:"read",grantee:t}})))}handleGranteesChangeError(t){var e;if(200!==(null===(e=null==t?void 0:t.response)||void 0===e?void 0:e.status))throw t}addGrantees(t,e){const i={granteeURIs:{items:this.convertGrantees(e)}};return this.xhr.post(`${t}/grantees/add`,{body:Object.assign({},i)}).catch(this.handleGranteesChangeError)}removeGrantees(t,e=[]){const i={granteeURIs:{items:this.convertGrantees(e)}};return this.xhr.post(`${t}/grantees/remove`,{body:Object.assign({},i)}).catch(this.handleGranteesChangeError)}getPermissions(t,e){return this.xhr.getParsed(`/gdc/projects/${t}/users/${e}/permissions`)}getProjectLcmIdentifiers(t,e,i,r){return(0,N.kG)(t,"domain ID must be specified"),e?this.xhr.getParsed(`/gdc/projects/${e}/lcmEntity`).then((({projectUri:t,clientId:e,dataProductId:i,segmentId:r})=>({projectLcm:{projectId:this.extractIdFromUri(t),clientId:e,dataProductId:i,segmentId:r}}))):((0,N.kG)(i,"product ID must be specified when project ID is not provided"),(0,N.kG)(r,"client ID must be specified when project ID is not provided"),this.xhr.getParsed(`/gdc/domains/${t}/dataproducts/${i}/clients/${r}`).then((({client:{id:t,project:e,segment:i,links:r}})=>({projectLcm:{projectId:this.extractIdFromUri(e),clientId:t,dataProductId:this.extractIdFromUri(null==r?void 0:r.dataProduct),segmentId:this.extractIdFromUri(i)}}))))}extractIdFromUri(t){return null==t?void 0:t.split("/").pop()}}class ut{constructor(t){this.xhr=t}async isLoggedIn(){var t;try{return!!(await this.xhr.get("/gdc/account/token")).response.ok}catch(e){if(401===(null===(t=null==e?void 0:e.response)||void 0===t?void 0:t.status))return!1;throw e}}async isLoggedInProject(t){const e=await this.getCurrentProfile(),i=new lt(this.xhr);return(await i.getProjects(e.links.self.split("/")[4])).some((e=>{var i;return(null===(i=e.links)||void 0===i?void 0:i.self)===`/gdc/projects/${t}`}))}login(t,e){return this.xhr.postParsed("/gdc/account/login",{body:JSON.stringify({postUserLogin:{login:t,password:e,remember:1,captcha:"",verifyCaptcha:""}})})}loginSso(t,e,i){return this.xhr.post("/gdc/account/customerlogin",{data:{pgpLoginRequest:{targetUrl:i,ssoProvider:e,encryptedClaims:t}}})}async logout(){if(await this.isLoggedIn()){const{logoutUri:t}=await this.getAccountInfo();return this.xhr.del(t)}}getCurrentProfile(){return this.xhr.getParsed("/gdc/account/profile/current").then((t=>t.accountSetting))}getUserRegionalNumberFormatting(t){return this.xhr.getParsed(`/gdc/account/profile/${t}/settings/separators`).then((t=>({decimal:t.separators.decimal,thousand:t.separators.thousand})))}updateProfileSettings(t,e){return this.xhr.put(`/gdc/account/profile/${t}/settings`,{body:e})}async getAccountInfo(){const{accountInfo:t}=await this.xhr.getParsed("/gdc/app/account/bootstrap/account");return t}async getUserConfigs(t){return(await this.xhr.getParsed(`/gdc/account/profile/${t}/config`)).settings.items||[]}getUserFeatureFlags(t,e){return this.getUserConfigs(t).then((t=>{const i=e?t.filter((t=>e.includes(t.settingItem.source))):t,r={};return i.forEach((t=>{r[t.settingItem.key]=nt(t.settingItem.value)})),r}))}async getFeatureFlags(){const{featureFlags:t}=await this.xhr.getParsed("/gdc/app/account/bootstrap/featureFlags");return t}async getCurrentOrganization(){return this.xhr.getParsed("/gdc/app/organization/current")}getBootstrapResource(t={}){const{projectId:e,productId:i,clientId:r,loadAnalyticalDashboards:s=!0}=t;let a=`/gdc/app/account/bootstrap?loadAnalyticalDashboards=${s}`;return e?a=`${a}&projectUri=/gdc/projects/${e}`:i&&r&&(a=`${a}&projectUri=/gdc/projects/client:${i}:${r}`),this.xhr.getParsed(a)}initiateSamlSso(t){return this.xhr.ensureNoLeadingTokenRequest(),this.xhr.get(`/gdc/account/samlrequest?${I().stringify({relayState:t})}`).then((t=>t.getData())).then((t=>{const e=t.samlRequests.items[0].samlRequest.loginUrl;window.location.assign(e)}))}}var ct=i(83401),dt=i.n(ct),ht=i(610),pt=i.n(ht),gt=i(36614),mt=i.n(gt),ft=i(72626),bt=i.n(ft),yt=i(76967),vt=i.n(yt),wt=i(90576),jt=i.n(wt);function Ct(t){return!vt()(t)&&"attribute"===t.meta.category}function Ot(t){return!vt()(t)&&jt()(t,"attribute")}function Dt(t){return!vt()(t)&&"attributeDisplayForm"===t.meta.category}function xt(t){return!vt()(t)&&"metric"===t.meta.category}function kt(t){return!vt()(t)&&"fact"===t.meta.category}function Ft(t){return!vt()(t)&&"dataSet"===t.meta.category}function At(t){return!vt()(t)&&"theme"===t.meta.category}function It(t){if(!t.response.ok)throw new B(t.response.statusText,t.response,t.getData());return t.getData()}class Pt{constructor(t){this.xhr=t}async getAttributeElementDefaultDisplayFormValue(t){const e=t.match(/(.+)\/elements\?id=(.*)/);if(!e)throw new Error("Provide valid attribute element uri");const i=e[1],r=e[2],s=await this.getAttributeDefaultDisplayForm(i);if(!s)throw new Error("Attribute of the provided element has no default display form!");const a=s.meta.uri;return(await this.xhr.getParsed(`${a}/elements?id=${r}`)).attributeElements.elements[0]}async getAttributeDefaultDisplayForm(t){const e=await this.xhr.getParsed(t);if(!Ot(e))throw new Error("Provided uri is not attribute uri!");return e.attribute.content.displayForms.find((t=>1===t.content.default))||e.attribute.content.displayForms[0]}async getObjectByIdentifier(t,e){const i=await this.getObjectUri(t,e);return this.xhr.getParsed(i)}async getObjectsByIdentifiers(t,e){const i=(await this.getUrisFromIdentifiers(t,e)).map((t=>t.uri));return this.getObjects(t,i)}getObjects(t,e){const i=`/gdc/md/${t}/objects/get`,r=dt()(e,50).map((t=>{const e={get:{items:t}};return this.xhr.post(i,{body:e}).then((t=>{if(!t.response.ok)throw new B(t.response.statusText,t.response,t.responseBody);return t.getData()})).then((t=>t.objects.items.map((t=>t.visualizationObject?{visualizationObject:t.visualizationObject}:t))))}));return Promise.all(r).then(pt())}getObjectsByQuery(t,e){const i=(t,e=[])=>this.xhr.get(t).then((t=>t.getData())).then((({objects:t})=>{e.push(...t.items);const r=t.paging.next;return r?i(r,e):e})),r=e.deprecated?{deprecated:1}:{},s=`/gdc/md/${t}/objects/query`,a=mt()(Object.assign(Object.assign({limit:50},e),r),["category","mode","author","limit","deprecated"]);return i(s+st(a))}getObjectsByQueryWithPaging(t,e){const i=(null==e?void 0:e.getTotalCount)?1:0,r=`/gdc/md/${t}/objects/query?${P(Object.assign(Object.assign({},e),{getTotalCount:i}))}`;return this.xhr.get(r).then((t=>t.getData())).then((({objects:t})=>t))}getObjectUsing(t,e,i={}){const{types:r=[],nearest:s=!1}=i,a=`/gdc/md/${t}/using2`,n={inUse:{uri:e,types:r,nearest:s?1:0}};return this.xhr.post(a,{body:n}).then(It).then((t=>t.entries))}getObjectUsingMany(t,e,i={}){const{types:r=[],nearest:s=!1}=i,a=`/gdc/md/${t}/using2`,n={inUseMany:{uris:e,types:r,nearest:s?1:0}};return this.xhr.post(a,{body:n}).then(It).then((t=>t.useMany))}getObjectUsedBy(t,e,i){const{nearest:r=!1,types:s=[]}=i,a={inUse:{nearest:r?1:0,uri:e,types:s}};return this.xhr.postParsed(`/gdc/md/${t}/usedby2`,{body:a}).then((t=>t.entries))}getObjectsUsedByMany(t,e,i){const r=`/gdc/md/${t}/usedby2`,{nearest:s=!1,types:a=[]}=i,n={inUseMany:{nearest:s?1:0,uris:e,types:a}};return this.xhr.postParsed(r,{body:n}).then((t=>t.useMany))}getVisualizations(t){return this.xhr.get(`/gdc/md/${t}/query/visualizationobjects`).then((t=>t.response.ok?t.getData():t.response)).then(Y)}getAttributes(t){return this.xhr.get(`/gdc/md/${t}/query/attributes`).then((t=>t.response.ok?t.getData():t.response)).then(Y)}getDimensions(t){return this.xhr.get(`/gdc/md/${t}/query/dimensions`).then((t=>t.response.ok?t.getData():t.response)).then(Y)}getFolders(t,e){const i=(t,e)=>{const i=e?`?type=${e}`:"";return this.xhr.get(`/gdc/md/${t}/query/folders${i}`).then((t=>t.getData())).then(Y)};switch(e){case"fact":case"metric":return i(t,e);case"attribute":return this.getDimensions(t);default:return Promise.all([i(t,"fact"),i(t,"metric"),this.getDimensions(t)]).then((([t,e,i])=>({fact:t,metric:e,attribute:i})))}}getFacts(t){return this.xhr.get(`/gdc/md/${t}/query/facts`).then((t=>t.response.ok?t.getData():t.response)).then(Y)}getMetrics(t){return this.xhr.get(`/gdc/md/${t}/query/metrics`).then((t=>t.response.ok?t.getData():t.response)).then(Y)}getProjectDashboards(t){return this.xhr.getParsed(`/gdc/md/${t}/query/projectdashboards`).then((e=>{const i=e.query.entries.map((t=>t.link));return this.getObjects(t,i)}))}getAnalyticalDashboards(t,e){return this.xhr.getParsed(`/gdc/md/${t}/query/analyticaldashboard?showAll=${e?1:0}`).then((t=>t.query.entries))}getDashboardPlugins(t){return this.xhr.getParsed(`/gdc/md/${t}/query/dashboardplugins`).then((t=>t.query.entries))}getAvailableMetrics(t,e=[]){return this.xhr.post(`/gdc/md/${t}/availablemetrics`,{body:e}).then((t=>t.response.ok?t.getData():t.response)).then((t=>t.entries))}getAvailableAttributes(t,e=[]){return this.xhr.post(`/gdc/md/${t}/drillcrosspaths`,{body:e}).then((t=>t.response.ok?t.getData():t.response)).then((t=>t.drillcrosspath.links))}getAvailableFacts(t,e=[]){return this.xhr.post(`/gdc/md/${t}/availablefacts`,{body:e}).then((t=>t.response.ok?t.getData():t.response)).then((t=>t.entries))}getObjectDetails(t){return this.xhr.get(t).then((t=>t.getData()))}getFoldersWithItems(t,e){return this.getFolders(t,e).then((i=>{const r=t=>Promise.all(t.map(this.getObjectDetails)).then((t=>t.map((t=>t.metric))));function s(t,e){return t.map((t=>t[e]))}const a=t=>{t.forEach((t=>{t.items.sort(((t,e)=>t.meta.title<e.meta.title?-1:t.meta.title>e.meta.title?1:0))})),t.sort(((t,e)=>t.title<e.title?-1:t.title>e.title?1:0))},n=s(i,"link"),o=s(i,"title");return Promise.all(n.map(this.getObjectDetails)).then((i=>{if("attribute"===e)return this.getAttributes(t).then((t=>{const e=[];i.forEach((t=>{t.dimension.content.attributes.forEach((t=>{e.push(t.meta.uri)}))}));const r=t.filter((t=>-1===e.indexOf(t.link))).map((t=>t.link));return Promise.all(r.map(this.getObjectDetails)).then((t=>{const e=t.map((t=>t.attribute)),r=i.map((t=>({title:t.dimension.meta.title,items:t.dimension.content.attributes})));return r.push({title:"Unsorted",items:e}),a(r),r}))}));if("metric"===e){const e=i.map((t=>s(t.folder.content.entries,"link")));return this.getMetrics(t).then((t=>{const s=[];i.forEach((t=>{t.folder.content.entries.forEach((t=>{s.push(t.link)}))}));const n=t.filter((t=>-1===s.indexOf(t.link))).map((t=>t.link));return e.push(n),Promise.all(e.map((t=>r(t)))).then((t=>{const e=t.map(((t,e)=>({title:o[e]||"Unsorted",items:t})));return a(e),e}))}))}return Promise.reject(null)}))}))}getObjectIdentifier(t){function e(t){if(t.attribute)return t.attribute.content.displayForms[0].meta.identifier;if(t.dimension)return t.dimension.content.attributes.content.displayForms[0].meta.identifier;if(t.metric)return t.metric.meta.identifier;if(t.dataSet)return t.dataSet.meta.identifier;throw Error("Unknown object!")}return b()(t)?Promise.resolve(e(t)):this.getObjectDetails(t).then((t=>e(t)))}getObjectUri(t,e){return this.xhr.post(`/gdc/md/${t}/identifiers`,{body:{identifierToUri:[e]}}).then((i=>{const r=i.getData().identifiers.find((t=>t.identifier===e));if(r)return r.uri;throw new B(`Object with identifier ${e} not found in project ${t}`,i.response,i.responseBody)}))}getUrisFromIdentifiers(t,e){return e.length?this.xhr.post(`/gdc/md/${t}/identifiers`,{body:{identifierToUri:e}}).then((t=>t.getData())).then((t=>t.identifiers)):Promise.resolve([])}getIdentifiersFromUris(t,e){return this.xhr.post(`/gdc/md/${t}/identifiers`,{body:{uriToIdentifier:e}}).then((t=>t.getData())).then((t=>t.identifiers))}translateElementLabelsToUris(t,e,i,r="EXACT"){return this.xhr.post(`/gdc/md/${t}/labels`,{body:{elementLabelToUri:[{labelUri:e,mode:r,patterns:i}]}}).then((t=>{var e;return t.response.ok?null===(e=t.getData())||void 0===e?void 0:e.elementLabelUri:t.response}))}getValidElements(t,e,i={}){const r=st(bt()(mt()(i,["limit","offset","order","filter","prompt"]),(t=>void 0!==t))),s=mt()(i,["uris","complement","includeTotalCountWithoutFilters","restrictiveDefinition"]),{afm:a}=i;return(a?()=>this.xhr.post(`/gdc/app/projects/${t}/executeAfm/debug`,{body:{execution:{afm:a}}}).then((t=>t.getData())).then((t=>Object.assign(Object.assign({},s),{restrictiveDefinitionContent:t.reportDefinitionWithInlinedMetrics.content}))):()=>Promise.resolve(s))().then((i=>this.xhr.postParsed(`/gdc/md/${t}/obj/${e}/validElements${r}`.replace(/\?$/,""),{body:{validElementsRequest:i}})))}getVisualization(t){return this.getObjectDetails(t).then((t=>({visualizationObject:t.visualizationObject})))}saveVisualization(t,e){return this.createObject(t,{visualizationObject:e.visualizationObject})}updateVisualization(t,e,i){const r=e.split("/").slice(-1)[0];return this.updateObject(t,r,{visualizationObject:i.visualizationObject})}deleteVisualization(t){return this.deleteObject(t)}deleteObject(t){return this.xhr.del(t)}async bulkDeleteObjects(t,e,i="cascade"){const r=`/gdc/md/${t}/objects/delete`,s={delete:{items:e,mode:i}};await this.xhr.post(r,{data:s})}createObject(t,e){return this.xhr.postParsed(`/gdc/md/${t}/obj?createAndGet=true`,{body:e})}updateObject(t,e,i){return this.xhr.put(`/gdc/md/${t}/obj/${e}`,{body:i}).then((t=>t.getData()))}openVisualizationAsReport(t,e){return this.xhr.post(`/gdc/internal/projects/${t}/convertVisualizationObject`,{body:e}).then((t=>t.getData())).then((({uri:t})=>t))}ldmManage(t,e,i={}){return this.xhr.post(`/gdc/md/${t}/ldm/manage2`,{body:{manage:{maql:e}}}).then((t=>t.getData())).then((t=>{const e=t.entries[0].link;return tt(this.xhr.get.bind(this.xhr),e,this.isTaskFinished,i)})).then(this.checkStatusForError)}etlPull(t,e,i={}){return this.xhr.post(`/gdc/md/${t}/etl/pull2`,{body:{pullIntegration:e}}).then((t=>t.getData())).then((t=>{const e=t.pull2Task.links.poll;return tt(this.xhr.get.bind(this.xhr),e,this.isTaskFinished,i)})).then(this.checkStatusForError)}isTaskFinished(t){const e=t.wTaskStatus.status;return"OK"===e||"ERROR"===e}checkStatusForError(t){return"ERROR"===t.wTaskStatus.status?Promise.reject(t):t}}var Rt=i(76917),St=i.n(Rt),Tt=i(17506),Et=i.n(Tt),$t=i(84799),zt=i.n($t);function Bt(t,e){return zt()(t,Et()(["identifier","uri","author","created","updated","contributor",(null==e?void 0:e.clearLockedFlag)&&"locked"]))}class Ut{constructor(t){this.xhr=t,this.metadataModule=new Pt(t),this.userModule=new ut(t)}async saveDashboardAs(t,e,i){var r,s,a,n;const o=await this.getObjectsFromDashboard(t,e),l=await this.metadataModule.getObjectDetails(e),{analyticalDashboard:u}=l,c=[],d=[];try{const e=await this.duplicateFilterContext(t,o,i);c.push(e);const h=await this.duplicateOrKeepKpis(t,o,i);this.shouldCopyKpi(i)&&c.push(...Array.from(h.values()));const p=await this.duplicateWidgets(t,o,i);d.push(...Array.from(p.values()));const g=function(t,e){return i=>{const r=t.get(i),s=e.get(i);return r||s||i}}(h,p),m=function(t,e,i){return St()(Object.assign(Object.assign({},t.content),{filterContext:i,widgets:t.content.widgets.map((t=>e(t)))}),(t=>{const i=t.uri;if(i)return Object.assign(Object.assign({},t),{uri:e(i)})}))}(u,g,e),f={analyticalDashboard:Object.assign(Object.assign({},l.analyticalDashboard),{content:{filterContext:e,layout:Object.assign({},m.layout),widgets:[...m.widgets]},meta:Object.assign(Object.assign({},Bt(l.analyticalDashboard.meta,i)),{title:null!==(r=i.name)&&void 0!==r?r:`Copy of ${u.meta.title}`,summary:null!==(a=null!==(s=i.summary)&&void 0!==s?s:u.meta.summary)&&void 0!==a?a:"",tags:null!==(n=i.tags)&&void 0!==n?n:u.meta.tags})})};return(await this.metadataModule.createObject(t,f)).analyticalDashboard.meta.uri}catch(r){return this.shouldCopyVisObj(i)?await Promise.all(d.map((e=>this.cascadingDelete(t,e)))):await Promise.all(d.map((t=>this.metadataModule.deleteObject(t)))),await Promise.all(c.map((e=>this.cascadingDelete(t,e)))),e}}async cascadingDelete(t,e){const i=await this.metadataModule.getObjectUsing(t,e),r=(await this.userModule.getAccountInfo()).profileUri,s=i.filter((t=>t.author===r)).map((t=>t.link));return this.xhr.post(`/gdc/md/${t}/objects/delete`,{body:{delete:{items:[e].concat(s),mode:"cascade"}}})}async duplicateOrKeepKpis(t,e,i){const r=new Map;return this.shouldCopyKpi(i)&&await Promise.all(e.filter((t=>"kpi"===this.unwrapObj(t).meta.category)).map((async e=>{const{kpi:s}=e,a={kpi:{meta:Bt(s.meta,i),content:Object.assign({},s.content)}},n=(await this.metadataModule.createObject(t,a)).kpi.meta.uri;r.set(s.meta.uri,n)}))),r}async duplicateWidgets(t,e,i){const r=new Map;return await Promise.all(e.filter((t=>"visualizationWidget"===this.unwrapObj(t).meta.category)).map((async e=>this.createAndUpdateWidgets(t,e,i,r)))),r}async createAndUpdateWidgets(t,e,i,r){const{visualizationWidget:s}=e;if(this.shouldCopyVisObj(i)){const a=await this.metadataModule.getObjectDetails(s.content.visualization),n={visualizationObject:{meta:Bt(a.visualizationObject.meta,i),content:Object.assign({},a.visualizationObject.content)}},o=(await this.metadataModule.createObject(t,n)).visualizationObject.meta.uri,l={visualizationWidget:{meta:Bt(e.visualizationWidget.meta,i),content:Object.assign(Object.assign({},e.visualizationWidget.content),{visualization:o})}},u=(await this.metadataModule.createObject(t,l)).visualizationWidget.meta.uri;r.set(s.meta.uri,u)}else{const s={visualizationWidget:{meta:Bt(e.visualizationWidget.meta,i),content:Object.assign({},e.visualizationWidget.content)}},{visualizationWidget:a}=await this.metadataModule.createObject(t,s);r.set(e.visualizationWidget.meta.uri,a.meta.uri)}}async duplicateFilterContext(t,e,i){const r=e.filter((t=>"filterContext"===this.unwrapObj(t).meta.category))[0],s={filterContext:{meta:Bt(r.filterContext.meta,i),content:Object.assign({},r.filterContext.content)}},{filterContext:a}=await this.metadataModule.createObject(t,s);return a.meta.uri}async getObjectsFromDashboard(t,e){const i=await this.getObjectsUrisInDashboard(t,e);return this.metadataModule.getObjects(t,i)}async getObjectsUrisInDashboard(t,e){return(await this.metadataModule.getObjectUsing(t,e,{types:["kpi","visualizationWidget","filterContext"]})).map((t=>t.link))}unwrapObj(t){return t[Object.keys(t)[0]]}shouldCopyVisObj(t){return!(!t.copyVisObj&&void 0!==t.copyVisObj)}shouldCopyKpi(t){return!(!t.copyKpi&&void 0!==t.copyKpi)}}var Mt=i(74507),Lt=i.n(Mt),Wt=i(12347),Nt=i.n(Wt),Gt=i(66380),qt=i.n(Gt),Vt=i(84868),Ht=i.n(Vt),_t=i(96601),Kt=i.n(_t),Jt=i(11954),Qt=i.n(Jt),Zt=i(40596),Xt=i.n(Zt),Yt=i(78307),te=i.n(Yt),ee=i(11894),ie=i.n(ee);const re=/\{\S+\}/g;function se({metricDefinition:t}){return(t.expression.match(re)||[]).map((t=>t.substring(1,t.length-1)))}function ae({metricDefinition:t}){return t.identifier}function ne(t,{dependencies:e}){const i=Kt()(t,"identifier");return 0===ie()(e,i).length}function oe(t,e){for(let i=0;i<e.length;i+=1){const r=e[i];ne(t,r)&&(t.push(r),e.splice(i,1),i-=1)}}function le(t){const e=t.map((t=>({definition:t,identifier:ae(t),dependencies:se(t)})));return Kt()(function(t){const e=[];let i;for(;t.length>0;)if(i=t.length,oe(e,t),t.length===i)throw new Error("Metric defintions cannot be sorted due to missing dependencies.");return e}(e),"definition")}class ue{constructor(t){this.md=t}loadAttributesMap(t,e){return 0===e.length?Promise.resolve({}):this.md.getObjects(t,e).then((e=>{const i=function(t){return t.map((t=>t.attributeDisplayForm.content.formOf))}(e);return this.md.getObjects(t,i).then((t=>function(t,e){return t.reduce(((t,i)=>{const r=i.attributeDisplayForm.meta.uri,s=e.find((t=>t.attribute.meta.uri===i.attributeDisplayForm.content.formOf));return t[r]=s,t}),{})}(e,t)))}))}}const ce=Xt()(n());function de(t,e){return(t.element===e.id||t.element===e.uri)&&void 0===e.measureIndex}const he={extendedTabularDataResult:{values:[],warnings:[]}},pe=te()((function(t,e){const i=1e3-t.length;return e&&e.length>i?")"===e[e.length-1]?`${e.substring(0,i-2)}…)${t}`:`${e.substring(0,i-1)}…${t}`:`${e}${t}`}),""),ge="#,##0.00%";function me(t){var e,i;return(null!==(i=null===(e=ze(t))||void 0===e?void 0:e.aggregation)&&void 0!==i?i:"").toLowerCase()}function fe(t){return Qt()(Kt()(Ue(t),(t=>{return(null==(e=t)?void 0:e.positiveAttributeFilter)?n()(null===(i=e.positiveAttributeFilter)||void 0===i?void 0:i.in):(null==e?void 0:e.negativeAttributeFilter)?n()(null===(r=e.negativeAttributeFilter)||void 0===r?void 0:r.notIn):(null==e?void 0:e.absoluteDateFilter)?void 0===(null===(s=null==e?void 0:e.absoluteDateFilter)||void 0===s?void 0:s.from)&&void 0===(null===(a=null==e?void 0:e.absoluteDateFilter)||void 0===a?void 0:a.to):void 0===(null===(o=null==e?void 0:e.relativeDateFilter)||void 0===o?void 0:o.from)&&void 0===(null===(l=null==e?void 0:e.relativeDateFilter)||void 0===l?void 0:l.to);var e,i,r,s,a,o,l})))}function be(t){return""!==me(t)||!fe(t)}function ye(t,e){var i,r,s;return null===(s=null===(r=null===(i=null==e?void 0:e[t])||void 0===i?void 0:i.attribute)||void 0===r?void 0:r.meta)||void 0===s?void 0:s.uri}function ve(t,e){return c(e)?function(t,e){var i,r;const s=!!(null==t?void 0:t.negativeAttributeFilter),a=ye(null===(r=null===(i=null==t?void 0:t[s?"negativeAttributeFilter":"positiveAttributeFilter"])||void 0===i?void 0:i.displayForm)||void 0===r?void 0:r.uri,e),o=function(t){var e,i;const r=function(t){return void 0!==(null==t?void 0:t.negativeAttributeFilter)}(t),s=r?null===(e=null==t?void 0:t.negativeAttributeFilter)||void 0===e?void 0:e.notIn:null===(i=null==t?void 0:t.positiveAttributeFilter)||void 0===i?void 0:i.in;return null!=s?s:[]}(t);return n()(o)?null:`[${a}] ${s?"NOT ":""}IN (${Kt()(o,(t=>`[${t}]`)).join(",")})`}(e,t):""}function we(t,e){var i,r;const s=me(t).toUpperCase(),a=null===(r=null===(i=ze(t))||void 0===i?void 0:i.item)||void 0===r?void 0:r.uri,n=Nt()(Kt()(Ue(t),te()(ve,e)),(t=>!!t));return["SELECT",s?`${s}([${a}])`:`[${a}]`,ce(...n)&&`WHERE ${n.join(" AND ")}`].filter(Boolean).join(" ")}function je(t,e,i){var r,a,n;let o=`SELECT [${null===(a=null===(r=ze(i))||void 0===r?void 0:r.item)||void 0===a?void 0:a.uri}]`;be(i)&&(o=we(j()(s()(i),["definition","measureDefinition","filters"],[]),e));const l=ye(null===(n=null==t?void 0:t.displayForm)||void 0===n?void 0:n.uri,e),u=Nt()(Kt()(Ue(i),te()(ve,e)),(t=>!!t)),c=l?` BY ALL [${l}]`:"",d=ce(...u)?` WHERE ${u.join(" AND ")}`:"";return`SELECT (${o}${d}) / (${o}${c}${d})`}function Ce(t,e){return`SELECT ${e} FOR PREVIOUS ([${t}])`}function Oe(t,e,i){return Lt().hash(`${i}#${t}#${e}`)}function De(t,e,i,r,s){var a,o,l;const[,,,u,,c]=(null!==(l=null===(o=null===(a=ze(t))||void 0===a?void 0:a.item)||void 0===o?void 0:o.uri)&&void 0!==l?l:"").split("/"),d=`${u}_${c}`,h=r(i(t,s)),p=n()(Ue(t)),g=function(t){const e=me(t);return""===e?"metric":"count"===e?"attribute":"fact"}(t);return`${g}_${d}.generated.${h}${p||fe(t)?"":"_filtered"}_${e}`}function xe(t,e){var i,r,s,a;const n=(null!==(r=null===(i=null==e?void 0:e.properties)||void 0===i?void 0:i.sortItems)&&void 0!==r?r:[]).find((e=>{var i,r,s;const a=null==e?void 0:e.measureSortItem;return!!a&&(null===(s=null===(r=null===(i=a.locators)||void 0===i?void 0:i[0])||void 0===r?void 0:r.measureLocatorItem)||void 0===s?void 0:s.measureIdentifier)===(null==t?void 0:t.localIdentifier)}));return null!==(a=null===(s=null==n?void 0:n.measureSortItem)||void 0===s?void 0:s.direction)&&void 0!==a?a:null}function ke(t,e){var i,r,s,a;const n=(null!==(r=null===(i=null==e?void 0:e.properties)||void 0===i?void 0:i.sortItems)&&void 0!==r?r:[]).find((e=>{const i=null==e?void 0:e.attributeSortItem;return!!i&&(null==i?void 0:i.attributeIdentifier)===(null==t?void 0:t.localIdentifier)}));return null!==(a=null===(s=null==n?void 0:n.attributeSortItem)||void 0===s?void 0:s.direction)&&void 0!==a?a:null}function Fe(t,e,i,r){const{format:s}=t,a=xe(t,e),n=pe(t.title),o=te()(Oe,n,s),l=me(t),u=De(t,l.length?l:"base",we,o,r);return{element:u,definition:{metricDefinition:{identifier:u,expression:we(t,r),title:n,format:s}},sort:a,meta:{measureIndex:i}}}function Ae(t,e,i,r){const s=qt()($e(e)),a=te()(je,s,r),n=pe(null==t?void 0:t.title),o=De(t,"percent",a,te()(Oe,n,ge),r);return{element:o,definition:{metricDefinition:{identifier:o,expression:a(t),title:n,format:ge}},sort:xe(t,e),meta:{measureIndex:i}}}function Ie(t,e){return Be(e).find((e=>{var i;return(null==e?void 0:e.localIdentifier)===(null===(i=function(t){var e,i;return null!==(i=null===(e=null==t?void 0:t.definition)||void 0===e?void 0:e.popMeasureDefinition)&&void 0!==i?i:{}}(t))||void 0===i?void 0:i.measureIdentifier)}))}function Pe(t,e,i){var r;return{element:ye(null===(r=null==i?void 0:i.displayForm)||void 0===r?void 0:r.uri,t),sort:ke(i,e)}}function Re({definition:t}){return void 0!==(null==t?void 0:t.popMeasureDefinition)}function Se({definition:t}){var e;return null===(e=null==t?void 0:t.measureDefinition)||void 0===e?void 0:e.computeRatio}const Te=new class{constructor(){this.rules=[]}addRule(t,e){this.rules.push([t,e])}match(t,e){const[,i]=Ht()(this.rules,(([i])=>Qt()(i,(i=>i(t,e)))));return(0,N.kG)(i,"No suitable rule to handle the parameters found."),i}};function Ee(t){var e;return null!==(e=null==t?void 0:t.buckets)&&void 0!==e?e:[]}function $e(t){return Ee(t).reduce(((t,e)=>(t.push(...function(t){return t.items.reduce(((t,e)=>(u(e)&&t.push(e.visualizationAttribute),t)),[])}(e)),t)),[])}function ze(t){var e,i;return null!==(i=null===(e=null==t?void 0:t.definition)||void 0===e?void 0:e.measureDefinition)&&void 0!==i?i:{}}function Be(t){return Ee(t).reduce(((t,e)=>(t.push(...function(t){return t.items.reduce(((t,e)=>(l(e)&&t.push(e.measure),t)),[])}(e)),t)),[])}function Ue(t){var e,i;return null!==(i=null===(e=ze(t))||void 0===e?void 0:e.filters)&&void 0!==i?i:[]}Te.addRule([function(t,e){return!!Re(t)&&Se(Ie(t,e))}],(function(t,e,i,r){var s,a,n;const o=null===(n=null===(a=null===(s=null==t?void 0:t.definition)||void 0===s?void 0:s.popMeasureDefinition)||void 0===a?void 0:a.popAttribute)||void 0===n?void 0:n.uri,l=Ie(t,e),u=Ae(l,e,i,r),c=pe(null==t?void 0:t.title),d=ge,h=te()(Oe,c,d),p=Ce(o,`(${u.definition.metricDefinition.expression})`),g=De(l,"pop",(()=>p),h,r);return{element:g,definition:{metricDefinition:{identifier:g,expression:p,title:c,format:d}},sort:xe(),meta:{measureIndex:i,isPoP:!0}}})),Te.addRule([Re],(function(t,e,i,r){var s,a,n,o,l;const u=pe(null==t?void 0:t.title),c=null==t?void 0:t.format,d=te()(Oe,u,c),h=null===(n=null===(a=null===(s=null==t?void 0:t.definition)||void 0===s?void 0:s.popMeasureDefinition)||void 0===a?void 0:a.popAttribute)||void 0===n?void 0:n.uri,p=Ie(t,e);let g=Ce(h,`[${null===(l=null===(o=ze(p))||void 0===o?void 0:o.item)||void 0===l?void 0:l.uri}]`);if(be(p)){const t=`(${Fe(p,e,i,r).definition.metricDefinition.expression})`;g=Ce(h,t)}const m=De(p,"pop",(()=>g),d,r);return{element:m,definition:{metricDefinition:{identifier:m,expression:g,title:u,format:c}},sort:xe(t,e),meta:{measureIndex:i,isPoP:!0}}})),Te.addRule([Se],Ae),Te.addRule([be],Fe),Te.addRule([function({definition:t}){var e;return void 0===(null===(e=null==t?void 0:t.measureDefinition)||void 0===e?void 0:e.aggregation)}],((t,e,i)=>{var r,s,a;return{element:null===(a=null===(s=null===(r=null==t?void 0:t.definition)||void 0===r?void 0:r.measureDefinition)||void 0===s?void 0:s.item)||void 0===a?void 0:a.uri,sort:xe(t,e),meta:{measureIndex:i}}}));class Me{constructor(t,e){this.xhr=t,this.loadAttributesMap=e}getData(t,e,i={},r={}){console.warn("ExperimentalExecutionsModule is deprecated and is no longer being maintained. Please migrate to the ExecuteAfmModule.");const s={isLoaded:!1},a={execution:{columns:e}};return["where","orderBy","definitions"].forEach((t=>{i[t]&&(a.execution[t]=i[t])})),this.xhr.post(`/gdc/internal/projects/${t}/experimental/executions`,Object.assign(Object.assign({},r),{body:JSON.stringify(a)})).then((t=>t.getData())).then((t=>{var e,a,n,o;return s.headers=(n=null==i?void 0:i.metricMappings,o=null!==(a=null===(e=null==t?void 0:t.executionResult)||void 0===e?void 0:e.headers)&&void 0!==a?a:[],n&&n.forEach((t=>{const e=Ht()(o,te()(de,t));e&&(e.measureIndex=t.measureIndex,e.isPoP=t.isPoP)})),o),this.loadExtendedDataResults(t.executionResult.extendedTabularDataResult,r)})).then((t=>{var e,i,r,a;const{result:n,status:o}=t;return Object.assign(Object.assign({},s),{rawData:null!==(i=null===(e=null==n?void 0:n.extendedTabularDataResult)||void 0===e?void 0:e.values)&&void 0!==i?i:[],warnings:null!==(a=null===(r=null==n?void 0:n.extendedTabularDataResult)||void 0===r?void 0:r.warnings)&&void 0!==a?a:[],isLoaded:!0,isEmpty:204===o})}))}mdToExecutionDefinitionsAndColumns(t,e,i={}){const r=g(e);return this.getAttributesMap(i,r,t).then((t=>function(t,e,i){const r=Be(t);let s=$e(t);const a=pt()(Kt()(r,((e,r)=>function(t,e){const i=Te.match(t,e);return(0,N.kG)(i,`Unknown metric factory for: ${t}`),i}(e,t)(e,t,r,i))));return e.removeDateItems&&(s=Nt()(s,(t=>!function(t,e={}){var i;return void 0!==function(t,e){var i,r,s;return null===(s=null===(r=null===(i=null==e?void 0:e[t])||void 0===i?void 0:i.attribute)||void 0===r?void 0:r.content)||void 0===s?void 0:s.type}(null===(i=null==t?void 0:t.displayForm)||void 0===i?void 0:i.uri,e)}(t,i)))),s=Kt()(s,te()(Pe,i,t)),{columns:Et()(Kt()([...s,...a],"element")),definitions:le(Et()(Kt()(a,"definition")))}}(e,i,t)))}getAttributesMap(t={},e,i){var r;const s=null!==(r=t.attributesMap)&&void 0!==r?r:{},a=function(t,e){return(t||[]).filter((t=>!e[t]))}(e,s);return this.loadAttributesMap(i,a).then((t=>Object.assign(Object.assign({},s),t)))}loadExtendedDataResults(t,e,i=he){return new Promise(((r,s)=>{this.xhr.ajax(t,e).then((t=>{const{response:e}=t;return 204===e.status?{status:e.status,result:""}:{status:e.status,result:t.getData()}})).then((({status:t,result:s})=>{var a,n,o,l,u,c,d,h,p,g;const m=[...null!==(n=null===(a=null==i?void 0:i.extendedTabularDataResult)||void 0===a?void 0:a.values)&&void 0!==n?n:[],...null!==(l=null===(o=null==s?void 0:s.extendedTabularDataResult)||void 0===o?void 0:o.values)&&void 0!==l?l:[]],f=[...null!==(c=null===(u=null==i?void 0:i.extendedTabularDataResult)||void 0===u?void 0:u.warnings)&&void 0!==c?c:[],...null!==(h=null===(d=null==s?void 0:s.extendedTabularDataResult)||void 0===d?void 0:d.warnings)&&void 0!==h?h:[]],b=x()({},i,{extendedTabularDataResult:{values:m,warnings:f}}),y=null===(g=null===(p=null==s?void 0:s.extendedTabularDataResult)||void 0===p?void 0:p.paging)||void 0===g?void 0:g.next;r(y?this.loadExtendedDataResults(y,e,b):{status:t,result:b})}),s)}))}}var Le=i(32354),We=i.n(Le);function Ne(t){return JSON.stringify(t)}class Ge extends B{constructor(t,e){super(t.message,t.response,t.responseBody),this.executionResponse=e}}class qe{constructor(t){this.xhr=t}executeAfm(t,e){var i,r,s;return Ke(null!==(s=null===(r=null===(i=e.execution.resultSpec)||void 0===i?void 0:i.dimensions)||void 0===r?void 0:r.length)&&void 0!==s?s:0),this.getExecutionResponse(t,e).then((t=>this.getExecutionResult(t.links.executionResult).then((e=>({executionResponse:t,executionResult:e}))).catch((e=>{throw new Ge(e,t)}))))}getExecutionResponse(t,e){var i,r,s;return Ke(null!==(s=null===(r=null===(i=e.execution.resultSpec)||void 0===i?void 0:i.dimensions)||void 0===r?void 0:r.length)&&void 0!==s?s:0),this.xhr.post(`/gdc/app/projects/${t}/executeAfm`,{body:Ne(e)}).then((t=>t.getData())).then(He)}_executeVisualization(t,e){return this._getVisExecutionResponse(t,e).then((t=>this.getExecutionResult(t.links.executionResult).then((e=>({executionResponse:t,executionResult:e})))))}_getVisExecutionResponse(t,e){const i=function(t){const{reference:e,resultSpec:i,filters:r}=t.visualizationExecution,s=i?{resultSpec:i}:void 0,a=r?{filters:r}:void 0;return JSON.stringify({visualizationExecution:Object.assign(Object.assign({reference:e},s),a)})}(e);return this.xhr.post(`/gdc/app/projects/${t}/executeVisualization`,{body:i}).then((t=>t.getData())).then(He)}getPartialExecutionResult(t,e,i){const r=Ve(t);return Ke(Number(I().parse(r).dimensions)),this.getPage(t,e,i)}getExecutionResult(t){const e=Ve(t),i=Number(I().parse(e).dimensions);Ke(i);const r=Array(i).fill(1e3),s=Array(i).fill(0);return this.getAllPages(t,r,s)}getPage(t,e,i){return this.fetchExecutionResult(t,e,i).then((t=>t?_e(t):null))}getAllPages(t,e,i,r){return this.fetchExecutionResult(t,e,i).then((i=>{if(!i)return null;const s=_e(i),a=r?function(t,e){var i,r,s,a,n,o,l,u,c,d,h,p;const g=t,{headerItems:m,data:f,paging:b}=e,y=t=>{const e=0===t?1:0;0===b.offset[e]&&Je(t,m,g)},v=b.offset[0];if(g.data[v])for(let t=0;t<f.length;t+=1){const e=f[t];g.data[t+v].push(...e)}else{const t=f;g.data.push(...t)}return b.offset.length>1?(y(0),y(1)):Je(0,m,g),1===b.offset.length&&(g.paging.count=[null!==(a=null===(s=null===(r=null===(i=null==g?void 0:g.headerItems)||void 0===i?void 0:i[0])||void 0===r?void 0:r[0])||void 0===s?void 0:s.length)&&void 0!==a?a:0]),2===b.offset.length&&(g.paging.count=[null!==(u=null===(l=null===(o=null===(n=null==g?void 0:g.headerItems)||void 0===n?void 0:n[0])||void 0===o?void 0:o[0])||void 0===l?void 0:l.length)&&void 0!==u?u:0,null!==(p=null===(h=null===(d=null===(c=null==g?void 0:g.headerItems)||void 0===c?void 0:c[1])||void 0===d?void 0:d[0])||void 0===h?void 0:h.length)&&void 0!==p?p:0]),g}(r,s):s,{offset:n,total:o}=s.paging,l=function(t,e,i){const r=i.length,s=e[0]+t[0];if(1===r)return[s];const a=e[1]+t[1],n=e[1]+t[1]<i[1];return[n?e[0]:s,n?a:0]}(e,n,o),u=function(t,e,i){const r=i.length;Ke(r);const s=(t,e,i)=>e+t>i?i-e:t;return 2===r&&0===e[1]&&t[0]<i[1]?[s(t[0],e[0],i[0]),t[0]]:We()(r).map((r=>s(t[r],e[r],i[r])))}(e,l,o);return function(t,e){return t[0]<e[0]}(l,o)?this.getAllPages(t,u,l,a):a}))}fetchExecutionResult(t,e,i){const r=function(t,e,i){const[r,s]=t.split(/\?(.+)/),a=Object.assign(Object.assign({},I().parse(s)),{limit:e.join(","),offset:i.join(",")});return r+P(a,{addQueryPrefix:!0})}(t,e,i);return this.xhr.get(r).then((t=>204===t.response.status?null:t.getData()))}}function Ve(t){return t.split(/\?(.+)/)[1]}function He(t){return t.executionResponse}function _e(t){return t.executionResult}function Ke(t){(0,N.kG)(1===t||2===t,`${t} dimensions are not allowed. Only 1 or 2 dimensions are supported.`)}function Je(t,e,i){if(e&&i.headerItems)for(let r=0;r<e[t].length;r+=1)i.headerItems[t][r].push(...e[t][r])}class Qe{constructor(t,e){this.executeAfmModule=new qe(t),this.executeAfm=this.executeAfmModule.executeAfm.bind(this.executeAfmModule),this.getExecutionResponse=this.executeAfmModule.getExecutionResponse.bind(this.executeAfmModule),this._executeVisualization=this.executeAfmModule._executeVisualization.bind(this.executeAfmModule),this._getVisExecutionResponse=this.executeAfmModule._getVisExecutionResponse.bind(this.executeAfmModule),this.getPartialExecutionResult=this.executeAfmModule.getPartialExecutionResult.bind(this.executeAfmModule),this.getExecutionResult=this.executeAfmModule.getExecutionResult.bind(this.executeAfmModule),this.xhr=t,this.md=e}getData(t,e,i={},r={}){return this.getExperimentalExecutionsModule().getData(t,e,i,r)}mdToExecutionDefinitionsAndColumns(t,e,i={}){return this.getExperimentalExecutionsModule().mdToExecutionDefinitionsAndColumns(t,e,i)}getExperimentalExecutionsModule(){const t=new ue(this.md);return new Me(this.xhr,t.loadAttributesMap.bind(t))}}class Ze{constructor(t){this.xhr=t,this.handleExportResultError=t=>{if(this.isApiResponseError(t)&&400===t.response.status&&-1!==t.responseBody.indexOf("Export to required format is not allowed for data flagged as restricted.")){const e=new B("You cannot export this insight because it contains restricted data.",t.response,t.responseBody);return Promise.reject(e)}return Promise.reject(t)}}exportResult(t,e,i={},r={}){const s={resultExport:{executionResult:e,exportConfig:Object.assign(Object.assign({},i),this.sanitizeExportConfig(i))}};return this.xhr.post(`/gdc/internal/projects/${t}/exportResult`,{body:s}).then((t=>t.getData())).then((t=>et(this.xhr.get.bind(this.xhr),t.uri,J,Object.assign(Object.assign({},r),{blobContentType:Z(i.format)})))).catch(this.handleExportResultError)}sanitizeExportConfig(t){const{afm:e}=t;if(e&&!n()(e.filters)){const i=Object.assign(Object.assign({},e),{filters:this.sanitizeFilters(e.filters)});return Object.assign(Object.assign({},t),{afm:i})}return t}isApiResponseError(t){return void 0!==t.response}sanitizeFilters(t){return t?Et()(t):[]}}var Xe=i(76654),Ye=i.n(Xe),ti=i(24245),ei=i.n(ti);function ii(t){return!n()(t)&&!!t.attributeFilter}function ri(t){return t.map((t=>function(t){return!n()(t)&&!!t.dateFilter}(t)?function(t){const{dateFilter:{from:e,to:i,type:r,granularity:s},dateFilter:a}=t,n=Ye()(a,ei());return{dateFilter:Object.assign(Object.assign(Object.assign({type:r,granularity:s},n),void 0===e?{}:{from:String(e)}),void 0===i?{}:{to:String(i)})}}(t):ii(t)?function(t){const{attributeFilter:{displayForm:e,negativeSelection:i,attributeElements:r}}=t;return{attributeFilter:{displayForm:e,negativeSelection:i,attributeElements:r}}}(t):t))}class si{constructor(t){this.xhr=t}async exportToPdf(t,e,i=[],r={}){const s=ri(i),a=this.getDashboardExportPayload(e,s),n=await this.xhr.post(`/gdc/internal/projects/${t}/exportDashboard`,{body:a});return this.pollPdfFile(n,r)}async pollPdfFile(t,e){const i=t.getData();return et(this.xhr.head.bind(this.xhr),i.uri,J,Object.assign(Object.assign({},e),{blobContentType:"application/pdf"}))}getDashboardExportPayload(t,e){return e.length?{dashboardExport:{dashboardUri:t,filters:e}}:{dashboardExport:{dashboardUri:t}}}}function ai(t){if(null===t)return;const e=(t||"").match("(?:(https)://+|(www\\.)?)\\w[:;,\\.?\\[\\]\\w/~%&=+#-@!]*");if(!e)throw new Error(`${t} is not a valid url`);return`https://${e[0].replace(/^https?:\/\/|\/$/g,"")}`}class ni{constructor(t){if(this.configStorage=t,1!==arguments.length)throw new Error("Config module has to be called with exactly one argument.")}setCustomDomain(t){this.configStorage.domain=ai(t)}getCustomDomain(){return this.configStorage.domain}setJsPackage(t,e){this.configStorage.originPackage||(this.configStorage.originPackage={name:t,version:e})}getJsPackage(){return this.configStorage.originPackage}setRequestHeader(t,e){j()(this.configStorage,["xhrSettings","headers",t],e)}getRequestHeader(t){var e,i,r;return null===(r=null===(i=null===(e=this.configStorage)||void 0===e?void 0:e.xhrSettings)||void 0===i?void 0:i.headers)||void 0===r?void 0:r[t]}}const oi={types:["attribute","metric","fact"],paging:{offset:0}},li={includeUnavailableDateDataSetsCount:!0,includeAvailableDateAttributes:!0},ui=(t={})=>t.returnAllRelatedDateDataSets?{}:t.returnAllDateDataSets?{requiredDataSets:{type:"ALL"}}:t.dataSetIdentifier?{requiredDataSets:{type:"CUSTOM",customIdentifiers:[t.dataSetIdentifier]}}:{requiredDataSets:{type:"PRODUCTION"}},ci=t=>{if((t=>!!t.uri)(t))return t.uri;if((t=>!!t.expression)(t))return t.expression;throw new Error("Item description can only have expression or uri")};class di{constructor(t,e){this.xhr=t,this.execution=e}async loadAllItems(t,e={}){const i=X(e),r=async(e,i=[])=>{const s=await this.xhr.getParsed(`/gdc/internal/projects/${t}/catalog/items`,{data:e}),a=s.catalogItems.items,n=[...i,...a];if(a.length===e.limit){const t=Object.assign(Object.assign({},e),{offset:s.catalogItems.paging.offset+e.limit});return r(t,n)}return n};return r(Object.assign({offset:0,limit:1e3},i))}async loadGroups(t,e={}){return(await this.xhr.getParsed(`/gdc/internal/projects/${t}/catalog/groups`,{data:X(e)})).catalogGroups}async loadAvailableItemUris(t,e){const i=Ye()(e.catalogQueryRequest,n());return(await this.xhr.postParsed(`/gdc/internal/projects/${t}/catalog/query`,{data:{catalogQueryRequest:i}})).catalogAvailableItems.items}loadItems(t,e={}){var i;const r=zt()(Object.assign(Object.assign(Object.assign({},oi),e),ui(e)),["dataSetIdentifier","returnAllDateDataSets","attributesMap"]),a=null===(i=s()(e))||void 0===i?void 0:i.bucketItems,n=null==e?void 0:e.attributesMap;return void 0!==(null==a?void 0:a.buckets)?this.loadItemDescriptionObjects(t,a,n).then((e=>this.loadCatalog(t,Object.assign(Object.assign({},r),{bucketItems:e.map(ci)})))):this.loadCatalog(t,r)}async loadDateDataSets(t,e){const i=s()(e).bucketItems,r=i?await this.loadItemDescriptionObjects(t,i,e.attributesMap):void 0,a=null==r?void 0:r.map(ci),n=["filter","types","paging","dataSetIdentifier","returnAllDateDataSets","returnAllRelatedDateDataSets","attributesMap"];e.includeObjectsWithTags&&n.push("excludeObjectsWithTags");const o=zt()(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},li),oi),e),ui(e)),{bucketItems:a}),n);return this.requestDateDataSets(t,o)}async loadItemDescriptionObjects(t,e,i={},r=!1){return(({columns:t,definitions:e})=>t?t.map((t=>{var i;const r=Ht()(e,(({metricDefinition:e})=>e.identifier===t)),s=null===(i=null==r?void 0:r.metricDefinition)||void 0===i?void 0:i.expression;return s?{expression:s}:{uri:t}})):[])(await this.execution.mdToExecutionDefinitionsAndColumns(t,e,{attributesMap:i,removeDateItems:r}))}async loadDataSets(t){const e=`/gdc/dataload/internal/projects/${t}/csv/datasets`;return(await this.xhr.getParsed(e)).datasets.items}requestDateDataSets(t,e){const i=`/gdc/internal/projects/${t}/loadDateDataSets`;return this.xhr.postParsed(i,{data:{dateDataSetsRequest:e}}).then((t=>t.dateDataSetsResponse))}loadCatalog(t,e){const i=`/gdc/internal/projects/${t}/loadCatalog`;return this.xhr.post(i,{data:{catalogRequest:e}}).then((t=>t.getData())).then((t=>t.catalogResponse))}}class hi{constructor(t){this.xhr=t}getCommonAttributes(t,e){return this.xhr.post(`/gdc/md/${t}/ldm/attributeupperbound`,{body:{attributeUpperBounds:{attributes:e}}}).then((t=>t.getData())).then((t=>{if(t.attributeUpperBoundsResponse)return t.attributeUpperBoundsResponse.upperbounds}))}}class pi{constructor(t){this.xhr=t}getCurrentOrganization(){return this.xhr.getParsed("/gdc/app/organization/current")}}class gi{constructor(t,e={}){this.fetchMethod=t,this.configStorage=function(t){const e=Object.assign({},t);return t.domain&&(e.domain=ai(t.domain)),e}(e),this.config=new ni(this.configStorage),this.xhr=new W(t,this.configStorage),this.user=new ut(this.xhr),this.md=new Pt(this.xhr),this.mdExt=new Ut(this.xhr),this.execution=new Qe(this.xhr,this.md),this.project=new lt(this.xhr),this.report=new Ze(this.xhr),this.dashboard=new si(this.xhr),this.catalogue=new di(this.xhr,this.execution),this.ldm=new hi(this.xhr),this.organization=new pi(this.xhr);const i=new ue(this.md);this.utils={loadAttributesMap:i.loadAttributesMap.bind(i),getAttributesDisplayForms:g}}clone(){return new gi(this.fetchMethod,s()(this.configStorage))}}const mi=t=>{return(e=fetch.bind(window),(t={})=>new gi(e,t))(t);var e};mi();var fi=i(33011),bi=i(85403),yi=i.n(bi),vi=i(5374),wi=i.n(vi),ji=i(89608),Ci=i.n(ji),Oi=i(77748);function Di(t){return void 0!==t.response}function xi(t){var e,i,r;if(t.response.status!==Oi.W.BAD_REQUEST)return!1;const s=null!==(r=null===(i=null===(e=function(t){try{return JSON.parse(t)}catch(t){return null}}(t.responseBody))||void 0===e?void 0:e.error)||void 0===i?void 0:i.message)&&void 0!==r?r:"";return wi()(s,"Attempt to execute protected report unsafely")||wi()(s,"Export to required format is not allowed for data flagged as restricted")}function ki(t){if(Di(t)){if(t.response.status===Oi.W.NO_CONTENT)return new fi.J("Server returned no data");if(t.response.status===Oi.W.REQUEST_TOO_LONG)return new fi.hp("Server has reached data size limits when processing this request",t);if(xi(t))return new fi.kF("Request not authorized",t)}return Fi(t)}function Fi(t){if((0,fi.O4)(t))return t;if(Di(t)){if(t.response.status===Oi.W.UNAUTHORIZED){const e=Ci()(t.responseBody)&&wi()(t.responseBody,"gdc.login.password.expired")?"credentials_expired":"invalid_credentials";return new fi.$b("Not authenticated against backend",t,e)}return xi(t)?new fi.kF("Request not authorized",t):new fi.ml(t.message,t.response.status,t.responseBody,function(t){var e,i,r,s;return(null===(i=null===(e=t.response)||void 0===e?void 0:e.headers)||void 0===i?void 0:i.get)?null===(s=null===(r=t.response)||void 0===r?void 0:r.headers)||void 0===s?void 0:s.get("x-gdc-request"):null}(t),t)}return new fi.S2("An unexpected error has occurred",t)}var Ai=i(70567),Ii=i(1662),Pi=i(15978),Ri=i(78838),Si=i.n(Ri),Ti=i(74627),Ei=i(65074),$i=i(61550),zi=i(91486),Bi=i(14215),Ui=i(2326);function Mi(t){return(0,Bi.hj)(t)?(0,Ui.lR)(t.uri):(0,Ui.Ii)(t.identifier)}function Li(t){return(0,Bi.Mt)(t)?t:Mi(t)}function Wi(t){const e=(0,Ii.OF)(t)?t.uris:t.values;(0,N.kG)(e.every((t=>null!==t)),"Nulls are not supported as attribute element values or uris on bear")}const Ni=6;function Gi(t){return parseFloat(t.toFixed(Ni))}function qi(t){if((0,Ii.C0)(t)){const e=q()(t.comparison.treatNullValuesAs)?{}:{treatNullValuesAs:t.comparison.treatNullValuesAs};return{comparison:Object.assign({operator:t.comparison.operator,value:Gi(t.comparison.value)},e)}}{const e=q()(t.range.treatNullValuesAs)?{}:{treatNullValuesAs:t.range.treatNullValuesAs};return{range:Object.assign({operator:t.range.operator,from:Gi(t.range.from),to:Gi(t.range.to)},e)}}}function Vi(t){return(0,Ii.tG)(t)?function(t){return void 0===t.measureValueFilter.condition?null:{measureValueFilter:{measure:Li(t.measureValueFilter.measure),condition:qi(t.measureValueFilter.condition)}}}(t):(0,Ii.Ey)(t)?function(t){const{measure:e,attributes:i,operator:r,value:s}=t.rankingFilter;return{rankingFilter:{measures:[Li(e)],attributes:null==i?void 0:i.map(Li),operator:r,value:s}}}(t):Hi(t)}function Hi(t){return(0,Ii.ZU)(t)?function(t){return(0,Ii.II)(t)&&(0,Ii.Or)(t)?null:(0,Ii.II)(t)?(Wi(t.negativeAttributeFilter.notIn),{negativeAttributeFilter:{displayForm:Mi(t.negativeAttributeFilter.displayForm),notIn:t.negativeAttributeFilter.notIn}}):(Wi(t.positiveAttributeFilter.in),{positiveAttributeFilter:{displayForm:Mi(t.positiveAttributeFilter.displayForm),in:t.positiveAttributeFilter.in}})}(t):(0,Ii.yf)(t)?function(t){const{absoluteDateFilter:e}=t;return void 0===e.from||void 0===e.to?null:{absoluteDateFilter:{dataSet:Mi(e.dataSet),from:String(e.from),to:String(e.to)}}}(t):function(t){const{relativeDateFilter:e}=t;return void 0===e.from||void 0===!e.to?null:{relativeDateFilter:{dataSet:Mi(e.dataSet),granularity:e.granularity,from:Number(e.from),to:Number(e.to)}}}(t)}function _i(t){return t?Et()(t.map(Vi)):[]}var Ki=i(56130);const Ji="#,##0.00%",Qi="#,##0";function Zi(t){const{measure:{definition:e}}=t,i=function(t){if((0,Ki.BJ)(t))return function(t){const{measureDefinition:e}=t,i=e.filters?Et()(e.filters.map(Hi)):[],r=i.length?{filters:i}:{},s=Xi(e.aggregation),a=s?{aggregation:s}:{},n=e.computeRatio,o=n?{computeRatio:n}:{};return{measure:Object.assign(Object.assign(Object.assign({item:Mi(e.item)},r),a),o)}}(t);if((0,Ki.Cg)(t))return function(t){const{popMeasureDefinition:e}=t;return{popMeasure:{measureIdentifier:e.measureIdentifier,popAttribute:Mi(e.popAttribute)}}}(t);if((0,Ki.V7)(t))return function(t){const{previousPeriodMeasure:e}=t;return{previousPeriodMeasure:{measureIdentifier:e.measureIdentifier,dateDataSets:e.dateDataSets.map((t=>({dataSet:Mi(t.dataSet),periodsAgo:t.periodsAgo})))}}}(t);if((0,Ki.B3)(t))return function(t){const{arithmeticMeasure:e}=t;return{arithmeticMeasure:{measureIdentifiers:e.measureIdentifiers.slice(),operator:e.operator}}}(t);throw Error("The measure definition is not supported: "+JSON.stringify(t))}(e),r=function(t){const{measure:{definition:e,format:i}}=t;if(i)return i;if((0,Ki.B3)(e)&&"change"===e.arithmeticMeasure.operator)return Ji;if((0,Ki.BJ)(e)){const{measureDefinition:t}=e;if(t.computeRatio)return Ji;if("count"===t.aggregation)return Qi}}(t),s=r?{format:r}:{},a=t.measure.alias?t.measure.alias:t.measure.title,n=a?{alias:a}:{};return Object.assign(Object.assign({localIdentifier:t.measure.localIdentifier,definition:i},n),s)}function Xi(t){return"approximate_count"===t?"count":t}var Yi=i(29257),tr=i(33692);function er(t,e){const i=t.attribute.alias,r=i?{alias:i}:{};return Object.assign({displayForm:Mi(t.attribute.displayForm),localIdentifier:t.attribute.localIdentifier||`a${e+1}`},r)}function ir(t){const e=t.attributes.map(er),i=e.length?{attributes:e}:{},r=t.measures.map(Zi),s=r.length?{measures:r}:{},a=_i(t.filters),n=a.length?{filters:a}:{},o=function(t){const e=t.dimensions.map(Ti.qN).reduce(((t,e)=>(t.push(...e),t)),[]).filter(Yi.UB);return e.map((e=>{const i=(0,Ti.OT)(t.dimensions,e.attributeIdentifier);if(!i.length)throw new Error(`Native total references attribute that is not in any dimension: ${e.attributeIdentifier}`);if(i.length>1)throw new Error(`Native total references attribute that is in multiple dimensions: ${e.attributeIdentifier}`);const r=i[0];let s;if(1===r.dimIdx){const i=[...t.dimensions[0].itemIdentifiers,...r.dim.itemIdentifiers],a=i.findIndex((t=>t===e.attributeIdentifier));s=i.slice(0,a).filter((t=>t!==Ti.Pm))}else s=r.dim.itemIdentifiers.slice(0,r.itemIdx).filter((t=>t!==Ti.Pm));return{measureIdentifier:e.measureIdentifier,attributeIdentifiers:s}}))}(t),l=o.length?{nativeTotals:o}:{};return Object.assign(Object.assign(Object.assign(Object.assign({},s),i),n),l)}function rr(t){var e;!function(t){t.forEach((t=>{(0,tr.Ti)(t)&&t.measureSortItem.locators.forEach((t=>{(0,tr.at)(t)&&(0,N.kG)(null!==t.attributeLocatorItem.element,"Nulls are not supported as attribute element values or uris on bear")}))}))}(null!==(e=t.sortBy)&&void 0!==e?e:[]);const i=n()(t.sortBy)?{}:{sorts:t.sortBy},r=function(t){return t.dimensions.map((t=>{const e=function(t=[]){return t.map((t=>({type:t.type,attributeIdentifier:t.attributeIdentifier,measureIdentifier:t.measureIdentifier})))}(t.totals),i=n()(e)?{}:{totals:e};return Object.assign({itemIdentifiers:t.itemIdentifiers},i)}))}(t),s=n()(r)?{}:{dimensions:r};return Object.assign(Object.assign({},i),s)}const sr=t=>({execution:{afm:ir(t),resultSpec:rr(t)}});function ar(t){var e;return{warningCode:t.warningCode,message:t.message,parameters:null===(e=t.parameters)||void 0===e?void 0:e.map((t=>rt(t)?(0,Ui.lR)(t):t))}}var nr=i(79051),or=i.n(nr);const lr=["MM/dd/yyyy","dd/MM/yyyy","dd-MM-yyyy","yyyy-MM-dd","M/d/yy","dd.MM.yyyy"],ur="MM/dd/yyyy";var cr=i(99606),dr=i.n(cr);const hr=(t=ur)=>(e,i=t)=>{if(!lr.includes(i))throw new fi.S2(`Unsupported date format "${i}". Supported date formats are ${lr}`);return dr()(e,i)};function pr(t,e,i){if(!(0,zi.xG)(t)||!(null==e?void 0:e.length)||!i||i===ur)return t;const r=t.attributeHeaderItem.uri;if(!e.some((t=>null==r?void 0:r.startsWith(t))))return t;try{return{attributeHeaderItem:{name:(s=hr(i),t=>s(((t,e=ur)=>{if(!lr.includes(e))throw new fi.S2(`Unsupported date format "${e}". Supported date formats are ${lr}`);if(null===t)throw new fi.S2("Unsupported date value null. Nulls are not supported as date values");return or()(t,e,new Date)})(t)))(t.attributeHeaderItem.name),uri:r}}}catch(e){return t}var s}const gr=["sum","max","min","avg","med","nat"];class mr{constructor(t,e,i,r){this.authApiCall=t,this.definition=e,this.execFactory=i,this.execResponse=r,this.asDataView=t=>t.then((t=>{if(!t)throw new fi.S2("Server returned no data");if(function(t){return function(t){return 0===t.data.length}(t)&&function(t){return!t.headerItems}(t)}(t))throw new fi.J("The execution resulted in no data to display.",new vr(this,t));return new vr(this,t)})),this.dimensions=r.dimensions.map((t=>({headers:t.headers.map((t=>function(t){return!n()(t)&&void 0!==t.attributeHeader}(t)?{attributeHeader:Object.assign(Object.assign({},t.attributeHeader),{ref:(0,Ui.lR)(t.attributeHeader.uri),formOf:Object.assign(Object.assign({},t.attributeHeader.formOf),{ref:(0,Ui.lR)(t.attributeHeader.formOf.uri)})})}:{measureGroupHeader:{items:t.measureGroupHeader.items.map((t=>({measureHeaderItem:Object.assign(Object.assign({},t.measureHeaderItem),{ref:t.measureHeaderItem.uri?(0,Ui.lR)(t.measureHeaderItem.uri):void 0})}))),totalItems:t.measureGroupHeader.totalItems}}))}))),this._fingerprint=Lt().hash(r.links.executionResult)}async readAll(){return this.asDataView(this.authApiCall((t=>t.execution.getExecutionResult(this.execResponse.links.executionResult)),ki))}async readWindow(t,e){const i=function(t){return t.map(((t=0)=>t))}(t),r=function(t){return t.map(((t=fr)=>t>fr?(console.warn("The maximum limit per page is "+fr),fr):t))}(e);return this.asDataView(this.authApiCall((t=>t.execution.getPartialExecutionResult(this.execResponse.links.executionResult,r,i)),ki))}transform(){return this.execFactory.forDefinition(this.definition)}async export(t){const e=this.buildExportOptions(t);return this.authApiCall((t=>t.report.exportResult(this.definition.workspace,this.execResponse.links.executionResult,e)))}buildExportOptions(t){const e={format:t.format,mergeHeaders:t.mergeHeaders,title:t.title,showFilters:t.showFilters};return t.showFilters&&(e.afm=sr(this.definition).execution.afm),e}equals(t){return this.fingerprint()===t.fingerprint()}fingerprint(){return this._fingerprint}}const fr=1e3,br={attribute:0,columns:1};function yr(t,e,i){var r,s,a,n;const o=br[i],l=null===(r=null==e?void 0:e.dimensions[o])||void 0===r?void 0:r.totals,u=null===(a=null===(s=null==e?void 0:e.dimensions[o])||void 0===s?void 0:s.itemIdentifiers)||void 0===a?void 0:a.find(Ti.Dc);if(!(null==l?void 0:l.length)||!u)return t;const c=e.buckets,d=(0,Ei.w6)(c),h=((null===(n=(0,Ei.H)(c,i))||void 0===n?void 0:n.items)||[]).filter($i.dt).map((t=>{var e;return null===(e=t.attribute)||void 0===e?void 0:e.localIdentifier})),p=d.map((t=>t.measure.localIdentifier)),g=(m=h,l.reduce(((t,e)=>{var i;const r=m.indexOf(e.attributeIdentifier);return-1!==r?Object.assign(Object.assign({},t),{[r]:[...null!==(i=t[r])&&void 0!==i?i:[],e]}):t}),{}));var m;const f=function(t,e){return Object.keys(t).reduce(((i,r)=>{const s=[...t[r]];return s.sort(((t,i)=>{const r=gr.indexOf(t.type)-gr.indexOf(i.type);return 0!==r?r:e.indexOf(t.measureIdentifier)-e.indexOf(i.measureIdentifier)})),Object.assign(Object.assign({},i),{[r]:s})}),{})}(g,p),b=function(t){return Object.keys(t).reduce(((t,e)=>Object.assign(Object.assign({},t),{[e]:0})),{})}(f);return t.map((t=>{const e=[];return t.map((t=>t.find(zi.AM)?t.map(((t,i)=>{if((0,zi.aZ)(t)){const r=Math.max(0,h.length-e[i]),s=b[r],a=f[r][s],n=null==a?void 0:a.measureIdentifier,o=p.indexOf(n),l=Math.max(o,0),u=Object.assign(Object.assign({},t),{totalHeaderItem:Object.assign(Object.assign({},null==t?void 0:t.totalHeaderItem),{measureIndex:l})});return b[r]=(s+1)%f[r].length,u}return t})):(t.forEach(((t,i)=>{var r;e[i]=null!==(r=e[i])&&void 0!==r?r:0,(0,zi.aZ)(t)&&(e[i]=e[i]+1)})),t)))}))}class vr{constructor(t,e){var i,r,s,a,n,o,l;this.result=t,this.definition=t.definition,this.data=e.data,this.headerItems=e.headerItems?e.headerItems:[],this.totals=e.totals,this.totalTotals=e.totalTotals,this.totalCount=e.paging.total,this.count=e.paging.count,this.offset=e.paging.offset,this.warnings=null!==(r=null===(i=e.warnings)||void 0===i?void 0:i.map(ar))&&void 0!==r?r:[],this._fingerprint=`${t.fingerprint()}/${this.offset.join(",")}-${this.count.join(",")}`,this.headerItems=function(t,e){let i=t;return i=yr(i,e,"attribute"),i=yr(i,e,"columns"),i}(this.headerItems,this.definition),this.headerItems=(s=this.headerItems,l=t.dimensions,o=l.reduce(((t,e)=>(t.push(...e.headers.filter(zi._w)),t)),[]).filter((t=>"GDC.time.day_us"===t.attributeHeader.type)).map((t=>t.attributeHeader.formOf.uri)),a=(t,e)=>pr(t,o,null==e?void 0:e.dateFormat),n=this.definition.postProcessing,a?s.map((t=>t.map((t=>t.map((t=>a(t,n))))))):s)}fingerprint(){return this._fingerprint}equals(t){return this.fingerprint()===t.fingerprint()}}class wr{constructor(t,e,i){this.authCall=t,this.definition=e,this.executionFactory=i}checkDefIsExecutable(t){var e;if(null===(e=t.filters)||void 0===e?void 0:e.some((t=>(0,Ii.Vc)(t)&&(0,Ii.Or)(t))))throw new fi.J("Server returned no data")}async execute(){this.checkDefIsExecutable(this.definition);const t=sr(this.definition);return this.authCall((e=>e.execution.getExecutionResponse(this.definition.workspace,t).then((t=>new mr(this.authCall,this.definition,this.executionFactory,t)))),ki)}explain(){return console.warn("Backend does not support explain mode"),{data:()=>Promise.reject(new Error("Backend does not support explain mode data call.")),download:()=>Promise.resolve()}}withDimensions(...t){return this.executionFactory.forDefinition((0,Ai.Bm)(this.definition,...t))}withSorting(...t){return this.executionFactory.forDefinition((0,Ai.Pc)(this.definition,t))}withDateFormat(t){return this.executionFactory.forDefinition((0,Ai.nc)(this.definition,t))}withExecConfig(t){return n()(null==t?void 0:t.dataSamplingPercentage)||console.warn("Backend does not support data sampling, result will be not affected"),this.executionFactory.forDefinition(this.definition)}fingerprint(){return this._fingerprint||(this._fingerprint=(0,Pi.Nr)(this.definition)),this._fingerprint}equals(t){return Si()(this.definition,t.definition)}}var jr=i(1408),Cr=i(42487),Or=i(51805),Dr=i.n(Or),xr=i(39899),kr=i.n(xr);const Fr=(t,e)=>{if(t||e)return[t,e].filter(Boolean).join(" ")},Ar=t=>{const{email:e,login:i,firstName:r,lastName:s,links:a}=t;return{ref:(0,Ui.lR)(a.self),email:e,login:i,firstName:r,lastName:s,fullName:Fr(r,s)}},Ir=t=>{const{email:e,login:i,uri:r,firstName:s,lastName:a,state:n}=t,o=(t=>{switch(t){case"ACTIVE":return"ENABLED";case"INACTIVE":return"DISABLED";default:return}})(n),l=o?{status:o}:{};return Object.assign({ref:(0,Ui.lR)(r),email:e,login:i,uri:r,firstName:null!=s?s:void 0,lastName:null!=a?a:void 0,fullName:Fr(s,a)},l)},Pr=t=>{const{content:{email:e,login:i,firstname:r,lastname:s,status:a},links:n}=t,o=a?{status:a}:{};return Object.assign({ref:(0,Ui.lR)(n.self),uri:n.self,email:e,login:i,firstName:r,lastName:s,fullName:Fr(r,s)},o)},Rr=async t=>{var e,i;const r=null===(i=null===(e=(await t()).userMeta)||void 0===e?void 0:e.links)||void 0===i?void 0:i.self;return null!=r?r:null},Sr=async t=>{var e,i,r;const s=null!==(r=null===(i=null===(e=(await t()).userMeta)||void 0===e?void 0:e.links)||void 0===i?void 0:i.self)&&void 0!==r?r:"",a=Dr()(s.split("/"));return null!=a?a:null},Tr=async t=>{const e=await Sr(t);if(!e)throw new fi.S2("Cannot obtain the current user login md5");return e},Er=t=>{const e=/\/obj\/([^$/?]*)/.exec(t);return e?e[1]:""},$r=async(t,e,i)=>(0,Bi.hj)(t)?t.uri:i((i=>i.md.getObjectUri(e,t.identifier).catch((e=>{var i;if(Di(e)&&(null===(i=e.message)||void 0===i?void 0:i.search("not found"))>-1)throw new fi.ml(`Object with ${t.identifier} does not exist.`,404,e.responseBody);throw e})))),zr=async(t,e,i,r=!0)=>{if(n()(t))return[];const s=t.filter(Bi.$y).map((t=>t.identifier)),a=await i((t=>t.md.getUrisFromIdentifiers(e,s))),o=[];return t.forEach((t=>{if((0,Bi.hj)(t))o.push(t.uri);else{const e=a.find((e=>e.identifier===t.identifier));if(!e){if(r)throw new fi.S2("REFERENCED_OBJECT_NOT_FOUND",new Error(`Referenced object for ${t.identifier} not found`));return void console.debug(`Unable to translate identifier ${t.identifier} to object URI. The ref will be skipped.`)}o.push(e.uri)}})),o},Br=async(t,e)=>(0,Bi.$y)(t)?t.identifier:e((e=>e.md.getObjectIdentifier(t.uri))),Ur=async(t,e)=>Promise.all(t.map((t=>Br(t,e)))),Mr=async(t,e,i)=>{const r=e.filter((e=>!t.has(e))),s=kr()(r),a=await Promise.all(s.map((t=>i((async e=>{try{const i=await e.xhr.getParsed(t);return Ar(i.accountSetting)}catch(t){return}})))));return a.forEach((e=>{if(e){const i=(0,Bi.hj)(e.ref)?e.ref.uri:void 0;(0,N.kG)(i,"User must have uri in bear backend instances."),t.set(i,e)}})),t};class Lr{constructor(t,e,i,r=[],s){this.authCall=t,this.definition=e,this.insight=i,this.filters=r,this.executionFactory=s}async execute(){const t=await this.createVisualizationExecution();return this.authCall((e=>e.execution._getVisExecutionResponse(this.definition.workspace,t).then((t=>new mr(this.authCall,this.definition,this.executionFactory,t)))),ki)}explain(){return console.warn("Backend does not support explain mode"),{data:()=>Promise.reject(new Error("Backend does not support explain mode data call.")),download:()=>Promise.resolve()}}async createVisualizationExecution(){return{visualizationExecution:{reference:await $r((0,Cr.Cj)(this.insight),this.definition.workspace,this.authCall),resultSpec:rr(this.definition),filters:_i(this.filters)}}}withDimensions(...t){return this.executionFactory.forDefinition((0,Ai.Bm)(this.definition,...t))}withSorting(...t){return this.executionFactory.forDefinition((0,Ai.Pc)(this.definition,t))}withDateFormat(t){return this.executionFactory.forDefinition((0,Ai.nc)(this.definition,t))}withExecConfig(t){return n()(null==t?void 0:t.dataSamplingPercentage)||console.warn("Backend does not support data sampling, result will be not affected"),this.executionFactory.forDefinition(this.definition)}fingerprint(){return this._fingerprint||(this._fingerprint=(0,Pi.Nr)(this.definition)),this._fingerprint}equals(t){return Si()(this.definition,t.definition)}}class Wr extends jr.vH{constructor(t,e){super(e),this.authCall=t}forDefinition(t){return new wr(this.authCall,t,this)}forInsightByRef(t,e){const i=(0,Ai.Bm)((0,Ai.M)(this.workspace,t,e),Ai.ni),r=Et()(e),s=new Nr(this.authCall,this.workspace,t,r);return new Lr(this.authCall,i,t,r,s)}}class Nr extends jr.vH{constructor(t,e,i,r=[]){super(e),this.authCall=t,this.insight=i,this.filters=r}forDefinition(t){return new Lr(this.authCall,t,this.insight,this.filters,this)}forInsightByRef(t,e){const i=(0,Ai.Bm)((0,Ai.M)(this.workspace,t,e),Ai.ni);return new Lr(this.authCall,i,t,e,this)}}var Gr=i(39218),qr=i.n(Gr),Vr=i(89074),Hr=i.n(Vr);function _r(t){return Hr()(qr(),qt())(t)}var Kr=i(3223),Jr=i.n(Kr),Qr=i(23977),Zr=i.n(Qr),Xr=i(91404),Yr=i.n(Xr),ts=i(25),es=i(98962),is=i(18587),rs=i(1556),ss=i(37914),as=i(29205),ns=i.n(as),os=i(64509),ls=i(11732);class us extends os.U{}const cs=[Ct,Dt,xt,kt,Ft,function(t){return!vt()(t)&&"prompt"===t.meta.category},At],ds=t=>{if(!(t=>cs.some((e=>e(t))))(t))throw new fi.S2(`Cannot convert metadata object, convertor not found! (${JSON.stringify(t,null,4)})`);const e=(0,Ui.lR)(t.meta.uri),i=e=>e.title(t.meta.title).description(t.meta.summary).id(t.meta.identifier).production(1===t.meta.isProduction).uri(t.meta.uri);if(Ct(t)){const r=t.content.displayForms.map((t=>(0,ts.H)((0,Ui.lR)(t.meta.uri),(i=>i.attribute(e).title(t.meta.title).description(t.meta.summary).id(t.meta.identifier).uri(t.meta.uri).displayFormType(t.content.type)))));return(0,es.a)(e,(t=>t.modify(i).displayForms(r)))}return Dt(t)?(0,ts.H)(e,(e=>e.modify(i).attribute((0,Ui.lR)(t.content.formOf)).displayFormType(t.content.type))):xt(t)?(0,is._)(e,(e=>e.modify(i).expression(t.content.expression).format(t.content.format||"##,#"))):kt(t)?(0,rs.k)(e,(t=>t.modify(i))):Ft(t)?(0,ss.q)(e,(t=>t.modify(i))):((t,e=ns())=>(0,ls.AZ)(us,{type:"variable",ref:t},e))(e,(t=>t.modify(i)))},hs=(t,e)=>{const i=(0,Ui.lR)(e.link);return{type:t,uri:e.link,id:e.identifier,ref:i,title:e.title,description:e.summary,production:!0,unlisted:1===e.unlisted,deprecated:"1"===e.deprecated}};function ps(t){const e=(0,Ui.lR)(t.link);return(0,is._)(e,(e=>e.id(t.identifier).uri(t.link).title(t.title||"").description(t.summary||"")))}var gs=i(13096);function ms(t){return{meta:Object.assign(Object.assign({},(0,gs.i)(t)&&{identifier:t.id,uri:t.uri}),{title:t.title||"",summary:t.description,locked:t.isLocked}),content:{expression:t.expression,format:t.format}}}var fs=i(33969),bs=i.n(fs);const ys=/[[\]{}]/g,vs=[["text",/^[^#{}[\]"()0-9.]+/],["quoted_text",/^"(?:[^"\\]|\\"|\\'|\\\\.)*"/],["number",/^[+-]?((\d+(\.\d*)?)|(\.\d+))/],["bracket",/^[()]+/],["identifier",/^\{[^}]+\}/],["element_uri",/^\[[a-zA-Z0-9\\/]+elements\?id=\d+\]/],["uri",/^\[[a-zA-Z0-9\\/]+\]/],["comment",/#[^\n]*/]],ws=(t,e)=>Hr()(bs()((e=>e.type===t)),Jr()((t=>t.value)),Yr())(e);var js=i(44490),Cs=i.n(js),Os=i(40005);const Ds=(t,e)=>Object.keys(e).find((i=>e[i]===t)),xs=()=>(0,Os.Z)().replace(/-/g,""),ks=(t,e)=>Cs()(t)?t.map((t=>ks(t,e))):H()(t)?Object.keys(t).reduce(((i,r)=>(i[r]=ks(t[r],e),i)),{}):Ci()(t)?e(t):t,Fs=t=>(e,i=xs)=>t(e,i),As=t=>e=>((t,e)=>e[t])(e,t)||e,Is=Fs((({references:t,properties:e})=>({properties:ks(e,As(t)),references:t}))),Ps=Fs((({properties:t,references:e},i)=>{const r=((t,e)=>{const i={};return{convertedReferences:i,conversion:r=>{if(!rt(r))return r;const s=Ds(r,t)||Ds(r,i)||e();return i[s]=r,s}}})(e,i);return{properties:ks(t,r.conversion),references:r.convertedReferences}}));var Rs=i(79884),Ss=i.n(Rs);const Ts=t=>Ss()(t),Es=t=>{try{return t?JSON.parse(t):{}}catch(e){return console.error(`Error parsing properties: "${t}"`),{}}};function $s(t){return!n()(t)&&void 0!==t.uri}function zs(t,e){return $s(t)?(0,Ui.lR)(t.uri):(0,Ui.Ii)(t.identifier,e)}function Bs(t,e){return i=t,n()(i)||void 0===i.localIdentifier?zs(t,e):(0,Ui.Qc)(t.localIdentifier);var i}const Us=t=>{if(!t.length)return{uris:[]};const e=t[0];return/\/gdc\/md\/\S+\/obj\/\S+/.test(e)?{uris:t}:{values:t}},Ms=t=>function(t){return!n()(t)&&void 0!==t.measureValueFilter}(t)?(t=>({measureValueFilter:{condition:t.measureValueFilter.condition,measure:Bs(t.measureValueFilter.measure,"measure")}}))(t):function(t){return!n()(t)&&void 0!==t.rankingFilter}(t)?(t=>{const{measures:e,operator:i,value:r,attributes:s}=t.rankingFilter;return{rankingFilter:{measure:Bs(e[0],"measure"),operator:i,value:r,attributes:s}}})(t):Ls(t),Ls=t=>c(t)?d(t)?{positiveAttributeFilter:{displayForm:zs(t.positiveAttributeFilter.displayForm,"displayForm"),in:Us(t.positiveAttributeFilter.in)}}:{negativeAttributeFilter:{displayForm:zs(t.negativeAttributeFilter.displayForm,"displayForm"),notIn:Us(t.negativeAttributeFilter.notIn)}}:function(t){return!n()(t)&&void 0!==t.absoluteDateFilter}(t)?{absoluteDateFilter:{dataSet:zs(t.absoluteDateFilter.dataSet,"dataSet"),from:t.absoluteDateFilter.from||"",to:t.absoluteDateFilter.to||""}}:((q()(t.relativeDateFilter.from)||q()(t.relativeDateFilter.to))&&console.warn("RelativeDateFilter without 'from' or 'to' field encountered.This can make sense in some legacy contexts (e.g. PoP measures with All time global filter), but generally, this indicates an error.Please check the visualization object data to make sure the relativeDateFilter data is what you expected."),{relativeDateFilter:Object.assign(Object.assign({},t.relativeDateFilter),{granularity:t.relativeDateFilter.granularity,from:t.relativeDateFilter.from,to:t.relativeDateFilter.to})}),Ws=t=>{if(function(t){return!n()(t)&&void 0!==t.arithmeticMeasure}(t))return t;if(function(t){return!n()(t)&&void 0!==t.popMeasureDefinition}(t))return t;if(function(t){return!n()(t)&&void 0!==t.previousPeriodMeasure}(t))return t;const{filters:e}=t.measureDefinition;return{measureDefinition:Object.assign(Object.assign({},t.measureDefinition),{filters:e?Et()(e.map(Ls)):[]})}},Ns=t=>l(t)?(t=>{const{definition:e}=t.measure;return{measure:Object.assign(Object.assign({},t.measure),{definition:Ws(e)})}})(t):(t=>({attribute:Object.assign(Object.assign({},t.visualizationAttribute),{displayForm:zs(t.visualizationAttribute.displayForm,"displayForm")})}))(t),Gs=t=>({items:t.items.map(Ns),localIdentifier:t.localIdentifier,totals:t.totals}),qs=(t,e,i)=>{var r,s,a;const o=(t=>{const{content:e}=t;if(!e)return t;const{properties:i}=e;if(!i)return t;const{properties:r,references:s}=Is({properties:Es(i),references:e.references||{}}),a=n()(s)?void 0:{references:s};return Object.assign(Object.assign({},t),{content:Object.assign(Object.assign(Object.assign({},zt()(t.content,"references")),{properties:Ts(r)}),a)})})(t.visualizationObject),{content:l,meta:u}=o,c=Es(l.properties);return{insight:{buckets:l.buckets.map(Gs),filters:l.filters?Et()(l.filters.map(Ms)):[],ref:(0,Ui.lR)(u.uri),identifier:u.identifier,properties:c,sorts:c.sortItems||[],title:u.title,uri:u.uri,visualizationUrl:e,created:u.created,createdBy:u.author?null==i?void 0:i.get(u.author):void 0,updated:u.updated,updatedBy:u.contributor?null==i?void 0:i.get(u.contributor):void 0,isLocked:u.locked,tags:null!==(s=null===(r=u.tags)||void 0===r?void 0:r.split(" ").filter(Boolean))&&void 0!==s?s:[],summary:null!==(a=u.summary)&&void 0!==a?a:""}}},Vs=t=>{const e=(0,Ui.lR)(t.link);return{insight:{identifier:t.identifier||"",title:t.title||"",uri:t.link,ref:e,properties:[],sorts:[],visualizationUrl:"",buckets:[],filters:[],tags:[],created:t.created,updated:t.updated,summary:t.summary}}};class Hs{constructor(t,e){this.authCall=t,this.workspace=e}async getMeasureExpressionTokens(t){const e=await $r(t,this.workspace,this.authCall),i=await this.authCall((t=>t.xhr.getParsed(e)));if(r=i,vt()(r)||!jt()(r,"metric"))throw new Error("To get measure expression tokens, provide the correct measure identifier. Did you provide a measure identifier?");var r;const s=(t=>{const e=[];let i=t;for(;i.length;){let t;for(const[r,s]of vs)if(t=i.match(s),t){const[s]=t;e.push({type:r,value:s}),i=i.substr(s.length);break}if(!t)throw new Error(`Unable to match token, rest of output is: "${i}"`)}return e.map((t=>Object.assign(Object.assign({},t),{value:"comment"===t.type?t.value:t.value.replace(ys,"")})))})(i.metric.content.expression),a=ws("identifier",s),n=ws("uri",s),o=ws("element_uri",s),l=(await this.authCall((t=>t.md.getUrisFromIdentifiers(this.workspace,a)))).map((t=>t.uri)),u=Hr()(Jr()(Zr()(/\/elements\?id=.*/,"")),Yr())(o),c=Yr()([...n,...l,...u]),d=(await this.authCall((t=>t.md.getObjects(this.workspace,c)))).map(_r),h=await Promise.all(o.map((t=>this.authCall((e=>e.md.getAttributeElementDefaultDisplayFormValue(t)))))),p=d.reduce(((t,e)=>(t[e.meta.uri]=e,t)),{}),g=d.reduce(((t,e)=>(t[e.meta.identifier]=e,t)),{}),m=h.reduce(((t,e)=>(e&&(t[e.uri]=e),t)),{});return s.map((t=>"element_uri"===t.type?function(t,e){const i=t[e.value];return Object.assign({type:"attributeElement"},i?{value:i.title}:{value:"",deleted:!0})}(m,t):"uri"===t.type||"identifier"===t.type?function(t,e,i){const r="uri"===t.type?ds(e[t.value]):ds(i[t.value]);return{type:r.type,value:r.title,id:r.id,ref:r.ref}}(t,p,g):"comment"===t.type||"number"===t.type||"quoted_text"===t.type||"text"===t.type||"bracket"===t.type?_s(t.type,t.value):_s("text",t.value)))}async createMeasure(t){return function(t){const e=(0,Ui.lR)(t.meta.uri),{meta:i,content:r}=t;return(0,is._)(e,(t=>t.id(i.identifier).uri(i.uri).title(i.title).description(i.summary||"").expression(r.expression).format(r.format||"#,#.##").deprecated("1"===i.deprecated).isLocked(Boolean(i.locked)).production(Boolean(i.isProduction)).unlisted(Boolean(i.unlisted))))}((await this.authCall((e=>e.md.createObject(this.workspace,{metric:ms(t)})))).metric)}async deleteMeasure(t){const e=await $r(t,this.workspace,this.authCall);await this.authCall((t=>t.md.deleteObject(e)))}async updateMeasure(t){const e=t.uri.split("/").slice(-1)[0];return await this.authCall((i=>i.md.updateObject(this.workspace,e,{metric:ms(t)}))),t}async getMeasureReferencingObjects(t){const e=await $r(t,this.workspace,this.authCall),i=await this.authCall((t=>t.md.getObjectUsedBy(this.workspace,e,{types:["metric","visualizationObject"],nearest:!0})));return Promise.resolve({measures:i.filter((t=>"metric"===t.category)).map(ps),insights:i.filter((t=>"visualizationObject"===t.category)).map(Vs)})}}function _s(t,e){return{type:t,value:e}}class Ks{constructor(t,e){this.authCall=t,this.workspace=e,this.getColorPalette=async()=>await this.authCall((t=>t.project.getColorPaletteWithGuids(this.workspace)))||[],this.getTheme=async()=>{const t=(await this.authCall((t=>t.project.getProjectFeatureFlags(this.workspace)))).selectedUiTheme;return t?this.authCall((e=>e.md.getObjectByIdentifier(this.workspace,t).then((t=>{const e=_r(t);return At(e)&&e.content||{}})).catch((t=>{if(Di(t))return{};throw t})))):{}}}}var Js=i(23334),Qs=i.n(Js),Zs=i(99991),Xs=i.n(Zs),Ys=i(81986),ta=i.n(Ys),ea=i(39166),ia=i(95296),ra=i(94514),sa=i(19676),aa=i(69036),na=i(23120),oa=i(37754),la=i(7045);const ua=t=>"dateDataset"!==t&&"attributeHierarchy"!==t,ca={attribute:"attribute",fact:"fact",measure:"metric"},da=t=>ca[t],ha=t=>(0,Ui.lR)(t.uri),pa=t=>(0,Ui.lR)(t.links.self),ga=t=>{const{groups:e=[]}=t;return e.map((t=>(0,Ui.Ii)(t)))},ma=t=>e=>{var i;return e.id(t.identifier).uri(t.uri).title(t.title).description(null!==(i=t.summary)&&void 0!==i?i:"").production(1===t.isProduction).unlisted(1===t.unlisted).deprecated("1"===t.deprecated)},fa=t=>e=>e.id(t.identifier).uri(t.links.self).title(t.title).description(t.summary).production(t.production).unlisted(!1).deprecated(!1),ba=(t,e)=>{const i=ha(t.meta);return(0,ts.H)(i,(i=>i.modify(ma(t.meta)).attribute(e).displayFormType(t.content.type)))},ya=(t,e)=>{const{availableDateAttributes:i=[]}=t,r=ha(t.meta),s=i.map((t=>((t,e)=>{const{attributeMeta:i,defaultDisplayFormMeta:r}=t,s=ha(i),a=ha(r),n=e[i.identifier],o=n.attribute.content.displayForms.map((t=>ba(t,s))),l=n.attribute.content.drillDownStepAttributeDF?(0,Ui.lR)(n.attribute.content.drillDownStepAttributeDF):void 0;return(0,oa.hy)((e=>e.attribute(s,(t=>t.modify(ma(i)).drillDownStep(l).displayForms(o))).defaultDisplayForm(a,(t=>t.modify(ma(r)))).granularity(t.type)))})(t,e)));return(0,oa.xS)((e=>e.dataSet(r,(e=>e.modify(ma(t.meta)))).dateAttributes(s).relevance(t.relevance)))},va=t=>{const{content:e,meta:i}=t.metric,r=(0,Ui.lR)(i.uri);return(0,aa.Y)((t=>t.measure(r,(t=>{var r;return t.modify(ma(i)).expression(e.expression).format(null!==(r=e.format)&&void 0!==r?r:"#,#.##")}))))},wa=t=>(0,la.Dt)((e=>e.title(t.title).tag((0,Ui.Ii)(t.identifier))));var ja=i(26235),Ca=i(26090),Oa=i(33082),Da=i(16473);const xa=t=>{if((0,Bi.$y)(t))throw new Error("Cannot convert ref specified by identifier");return t},ka=t=>(0,Ii.tG)(t)?(t=>{const e=(0,Ii.xo)(t);if((0,Bi.$y)(e))throw new Error("Cannot convert measure value filter for measure specified by identifier");return{measureValueFilter:{measure:e,condition:(0,Ii.Mr)(t)}}})(t):(0,Ii.Ey)(t)?(t=>{const{measure:e,attributes:i,operator:r,value:s}=t.rankingFilter;return{rankingFilter:{measures:[xa(e)],attributes:null==i?void 0:i.map(xa),operator:r,value:s}}})(t):Fa(t),Fa=t=>(0,Ii.Vc)(t)?(t=>{const e=(0,Ii.eh)(t);return Wi(e),{positiveAttributeFilter:{displayForm:Mi((0,Ii.zH)(t)),in:(0,Ii.OF)(e)?e.uris:e.values}}})(t):(0,Ii.II)(t)?(t=>{const e=(0,Ii.eh)(t);return Wi(e),{negativeAttributeFilter:{displayForm:Mi((0,Ii.zH)(t)),notIn:(0,Ii.OF)(e)?e.uris:e.values}}})(t):(0,Ii.yf)(t)?(t=>({absoluteDateFilter:Object.assign({dataSet:Mi((0,Ii.zH)(t))},(0,Ii.Nl)(t))}))(t):(t=>({relativeDateFilter:Object.assign({dataSet:Mi((0,Ii.zH)(t))},(0,Ii.wF)(t))}))(t),Aa=t=>({dataSet:Mi(t.dataSet),periodsAgo:t.periodsAgo}),Ia=t=>{if((0,Ki.MI)(t))return(t=>{const e=(0,Ki.eR)(t),i=(0,Ki.n6)(t);if(!e&&!i)throw new Error("Measure has neither uri nor identifier.");const r=Xi((0,Ki.Rd)(t)),s=(0,Ki.mw)(t),a=((0,Ki.gY)(t)||[]).map(Fa);return{measureDefinition:Object.assign(Object.assign(Object.assign({item:e?{identifier:e}:{uri:i}},r&&{aggregation:r}),s&&{computeRatio:s}),!n()(a)&&{filters:a})}})(t);if((0,Ki.Nx)(t))return(t=>({arithmeticMeasure:{measureIdentifiers:(0,Ki.YV)(t),operator:(0,Ki.PN)(t)}}))(t);if((0,Ki.E3)(t))return(t=>({popMeasureDefinition:{measureIdentifier:(0,Ki.pY)(t),popAttribute:Mi((0,Ki.dN)(t))}}))(t);if((0,Ki.yq)(t))return(t=>({previousPeriodMeasure:{measureIdentifier:(0,Ki.pY)(t),dateDataSets:(0,Ki.Hz)(t).map(Aa)}}))(t);throw new Error("Unknown measure type")},Pa=t=>(0,Ki.kb)(t)?(t=>{const e=(0,Ki.F8)(t),i=(0,Ki.Lc)(t),r=(0,Ki.JL)(t);return{measure:Object.assign(Object.assign(Object.assign({definition:Ia(t),localIdentifier:(0,Ki.i1)(t)},e&&{alias:e}),i&&{format:i}),r&&{title:r})}})(t):(t=>{const e=(0,$i.pV)(t);return{visualizationAttribute:Object.assign({localIdentifier:(0,$i.WP)(t),displayForm:(0,$i.KH)(t)},e&&{alias:e})}})(t),Ra=t=>{const{totals:e}=t;return Object.assign({items:t.items.map(Pa),localIdentifier:t.localIdentifier},!n()(e)&&{totals:e})},Sa=t=>{const{properties:e,references:i}=Ps({properties:(0,Cr.XF)(t),references:{}}),r=Ye()(e,((t,e)=>"controls"!==e&&n()(t))),s=(0,Cr.Tm)(t).map(ka);return Object.assign(Object.assign(Object.assign({buckets:(0,Cr.Av)(t).map(Ra),visualizationClass:{uri:(0,Cr.Yt)(t)}},!n()(r)&&{properties:Ts(r)}),!n()(s)&&{filters:s}),!n()(i)&&{references:i})},Ta=t=>({content:Sa(t),meta:{title:(0,Cr._H)(t),category:"visualizationObject",summary:(0,Cr.BR)(t)}}),Ea=t=>{const e=Ta(t),i=(0,Cr.zB)(t);return{content:e.content,meta:Object.assign(Object.assign(Object.assign(Object.assign({},e.meta),{identifier:(0,Cr.wG)(t),uri:(0,Cr.T)(t),created:(0,Cr.$)(t),updated:(0,Cr.FM)(t)}),i&&{locked:i}),{tags:(0,Cr.oj)(t).join(" ")})}};class $a{constructor(t,e,i,r){this.catalogGroups=t,this.items=e,this.availableItems=i,this.options=r}groups(){return(0,N.kG)(this.options.loadGroups,"Catalog groups are not loaded."),this.catalogGroups}allItems(){return this.items}attributes(){return this.items.filter(ra.f)}measures(){return this.items.filter(ea.m)}facts(){return this.items.filter(ia.j)}dateDatasets(){return this.items.filter(ja.q)}attributeHierarchies(){return this.items.filter(Ca.t)}allAvailableItems(){return this.availableItems}availableAttributes(){return this.availableItems.filter(ra.f)}availableMeasures(){return this.availableItems.filter(ea.m)}availableFacts(){return this.availableItems.filter(ia.j)}availableDateDatasets(){return this.availableItems.filter(ja.q)}availableAttributeHierarchies(){return this.availableItems.filter(Ca.t)}}class za{constructor(t,e,i,r,s={types:["attribute","measure","fact","dateDataset","attributeHierarchy"],excludeTags:[],includeTags:[],loadGroups:!0},a){this.authCall=t,this.workspace=e,this.groups=i,this.items=r,this.options=s,this.mappings=a,this.loadAvailableCatalogItems=async t=>{const{types:e}=this.options,i=e.filter(ua);if(0===i.length)return[];const r=i.map(da),s=await this.authCall((e=>e.catalogue.loadItemDescriptionObjects(this.workspace,t.content,this.mappings.attributeByDisplayFormUri))),a=await this.authCall((t=>t.catalogue.loadAvailableItemUris(this.workspace,{catalogQueryRequest:{bucketItems:s,types:r}}))),n=e.includes("attributeHierarchy")?[...a,...this.items.filter(Ca.t)]:[...a];return this.items.filter((t=>{return n.includes((e=t,(0,ra.f)(e)?e.attribute.uri:(0,ea.m)(e)?e.measure.uri:(0,ia.j)(e)?e.fact.uri:(0,Ca.t)(e)?e.attributeHierarchy.uri:e.dataSet.uri));var e}))},this.loadAvailableDateDatasets=async t=>{const{types:e,includeTags:i,excludeTags:r,dataset:s,production:a,includeDateGranularities:n}=this.options;if(!e.includes("dateDataset"))return[];const[o,l,u]=await Promise.all([Ur(i,this.authCall),Ur(r,this.authCall),s?Br(s,this.authCall):Promise.resolve("")]),c=!a&&!u;return(await this.authCall((e=>e.catalogue.loadDateDataSets(this.workspace,{bucketItems:t.content,includeAvailableDateAttributes:!0,dataSetIdentifier:u,attributesMap:this.mappings.attributeByDisplayFormUri,includeObjectsWithTags:o.length?o:void 0,excludeObjectsWithTags:l.length?l:void 0,returnAllDateDataSets:c,includeDateGranularities:n})))).dateDataSets.map((t=>ya(t,this.mappings.attributeById)))}}withOptions(t){const e=Object.assign(Object.assign({},this.options),t);return new za(this.authCall,this.workspace,this.groups,this.items,e,this.mappings)}forDataset(t){return this.withOptions({dataset:t})}forTypes(t){return this.withOptions({types:t})}includeTags(t){return this.withOptions({includeTags:t})}excludeTags(t){return this.withOptions({excludeTags:t})}forItems(t){return this.withOptions({items:t})}forInsight(t){return this.withOptions({insight:t})}withGroups(t){return this.withOptions({loadGroups:t})}async load(){const t=function(t,e){const{items:i=[],insight:r}=t;if(0===i.length&&!r)throw new Error("No items or insight was specified.");const s=function(t){const e=new Set,i=new Set;return t.forEach((t=>{(0,Ki.Nx)(t)?e.add((0,Ki.i1)(t)):(0,Ki.kb)(t)&&i.add((0,Ki.i1)(t))})),t.filter((t=>{if((0,$i.dt)(t)||(0,Ki.MI)(t))return!0;if((0,Ki.Nx)(t))return!1;if((0,Ki.E3)(t)||(0,Ki.yq)(t)){const r=(0,Ki.pY)(t);return!e.has(r)&&i.has(r)}throw new N.ej("unexpected type of item encountered while constructing items for availability query")}))}(r?(0,Cr.zy)(r):i).map((t=>function(t,e){var i,r;if((0,$i.dt)(t)){const i=(0,$i.KH)(t);if((0,Bi.$y)(i)){const r=e.displayFormById[i.identifier];return(0,Oa.ST)(t,(e=>e.displayForm((0,Ui.lR)(r.meta.uri)).localId((0,$i.WP)(t))))}return t}if((0,Ki.MI)(t)){const r=(0,Ki.Q6)(t);if((0,Bi.$y)(r)){const s=e.measureById[r.identifier],a=e.factById[r.identifier],n=null!==(i=null==s?void 0:s.uri)&&void 0!==i?i:a.uri;return(0,Da.HB)(t,(e=>e.measureItem((0,Ui.lR)(n)).localId((0,Ki.i1)(t))))}return t}if((0,Ki.E3)(t)){const i=(0,Ki.dN)(t);if((0,Bi.$y)(i)){const s=e.attributeById[i.identifier],a=e.dateAttributeById[i.identifier],n=null!==(r=null==s?void 0:s.attribute.meta.uri)&&void 0!==r?r:a.attribute.uri;return(0,Da.Mn)(t,(e=>e.popAttribute((0,Ui.lR)(n)).localId((0,Ki.i1)(t))))}}return t}(t,e)));return Ta({insight:{title:"",filters:[],properties:{},sorts:[],visualizationUrl:"",buckets:[{items:s}]}})}(this.options,this.mappings),[e,i]=await Promise.all([this.loadAvailableCatalogItems(t),this.loadAvailableDateDatasets(t)]),r=[...e,...i];return new $a(this.groups,this.items,r,this.options)}}class Ba{constructor(t,e,i,r,s,a){this.authCall=t,this.workspace=e,this.catalogGroups=i,this.items=r,this.options=s,this.mappings=a}groups(){return(0,N.kG)(this.options.loadGroups,"Catalog groups are not loaded."),this.catalogGroups}allItems(){return this.items}attributes(){return this.items.filter(ra.f)}measures(){return this.items.filter(ea.m)}facts(){return this.items.filter(ia.j)}dateDatasets(){return this.items.filter(ja.q)}attributeHierarchies(){return this.items.filter(Ca.t)}availableItems(){return new za(this.authCall,this.workspace,this.catalogGroups,this.items,this.options,this.mappings)}}const Ua=({production:t,dataset:e})=>void 0===t?t:!e&&t?1:0,Ma=["attribute","measure","fact"],La=t=>Ma.includes(t);class Wa{constructor(t,e,i={types:["attribute","measure","fact","dateDataset","attributeHierarchy"],excludeTags:[],includeTags:[],loadGroups:!0}){this.authCall=t,this.workspace=e,this.options=i,this.tagsAndDatasetIdsPromise=null,this.loadAllCatalogItemsAndMappings=async()=>{const[t,e]=await Promise.all([this.loadBearCatalogItems(),this.loadDateDatasets()]),i=(r=await this.loadBearAttributes(t,Xs()(e,(t=>{var e;return null!==(e=t.availableDateAttributes)&&void 0!==e?e:[]}))),Xs()(r,(t=>[t,...t.attribute.content.displayForms.map((t=>({attributeDisplayForm:t})))])));var r;const{attributeByDisplayFormUri:s,displayFormById:a,displayFormByUri:o,attributeById:l}=(t=>{const[e,i]=Qs()(t,Ot),r=i.map((t=>t.attributeDisplayForm)),s=ta()(e,(t=>t.attribute.meta.uri)),a=ta()(e,(t=>t.attribute.meta.identifier)),n=ta()(r,(t=>t.meta.uri)),o=ta()(r,(t=>t.meta.identifier)),l=Object.keys(n).reduce(((t,e)=>{const i=n[e].content.formOf,r=s[i];return t[e]=r,t}),{});return{attributeById:a,attributeByDisplayFormUri:l,displayFormById:o,displayFormByUri:n}})(i),u=t.map(((t,e)=>i=>{return r=i,n()(r)||"attribute"!==r.type?function(t){return!n()(t)&&"metric"===t.type}(i)?(t=>{const e=pa(t),i=ga(t);return(0,aa.Y)((r=>r.measure(e,(e=>e.modify(fa(t)).expression(t.expression).format(t.format))).groups(i)))})(i):(t=>{const e=pa(t),i=ga(t);return(0,na.Z)((r=>r.fact(e,(e=>e.modify(fa(t)))).groups(i)))})(i):((t,e,i)=>{var r;const s=pa(t),a=e[t.links.defaultDisplayForm],n=i[t.identifier],o=(null!==(r=t.links.geoPinDisplayForms)&&void 0!==r?r:[]).map((t=>e[t])),l=n.attribute.content.displayForms.map((t=>ba(t,s))),u=ga(t),c=n.attribute.content.drillDownStepAttributeDF?(0,Ui.lR)(n.attribute.content.drillDownStepAttributeDF):void 0,d=n.attribute.content.linkAttributeDF?(0,Ui.lR)(n.attribute.content.linkAttributeDF):void 0;return(0,sa.W)((e=>e.attribute(s,(e=>e.modify(fa(t)).drillDownStep(c).drillToAttributeLink(d).displayForms(l))).defaultDisplayForm(ba(a,s)).displayForms(l).geoPinDisplayForms(o.map((t=>ba(t,s)))).groups(u)))})(i,t,e);var r})(o,l)),c=e.map((t=>ya(t,l))),d=this.options.types.includes("attributeHierarchy")?function(t,e){const i=t.filter(ra.f).filter((t=>t.attribute.drillDownStep)),r=e.flatMap((t=>t.dateAttributes.filter((t=>t.attribute.drillDownStep))));return[...i,...r].map((t=>{const{attribute:e}=t,i=(0,Os.Z)();return{type:"attributeHierarchy",attributeHierarchy:{type:"attributeHierarchy",id:i,uri:i,ref:(0,Ui.lR)(i),title:`Attribute hierarchy for ${e.title}`,description:"",production:!0,deprecated:!1,unlisted:!1,attributes:[e.ref,e.drillDownStep]}}}))}(u,c):[],h=u.concat(c,d),p=ta()(u.filter(ea.m).map((t=>t.measure)),(t=>t.id)),g=ta()(u.filter(ia.j).map((t=>t.fact)),(t=>t.id)),m=ta()(Xs()(c,(t=>t.dateAttributes)),(t=>t.attribute.id));return{allCatalogItems:h,mappings:{attributeById:l,attributeByDisplayFormUri:s,displayFormById:a,measureById:p,factById:g,dateAttributeById:m}}},this.loadDateDatasets=async()=>{const{types:t,production:e,includeDateGranularities:i}=this.options;if(!t.includes("dateDataset"))return[];const{includeTagsIds:r,excludeTagsIds:s,dataSetId:a}=await this.getTagsAndDatasetIds(),n=!e&&!a;return(await this.authCall((t=>t.catalogue.loadDateDataSets(this.workspace,{returnAllDateDataSets:n,dataSetIdentifier:a,excludeObjectsWithTags:s.length?s:void 0,includeObjectsWithTags:r.length?r:void 0,includeDateGranularities:i})))).dateDataSets},this.loadBearCatalogItems=async()=>{const{types:t,dataset:e}=this.options,i=t.filter(ua);if(0===i.length)return[];const{includeTagsIds:r,excludeTagsIds:s,dataSetId:a}=await this.getTagsAndDatasetIds(),n=i.map(da);return this.authCall((t=>t.catalogue.loadAllItems(this.workspace,{types:n,includeWithTags:r.length?r:void 0,excludeWithTags:s.length?s:void 0,production:Ua(this.options),csvDataSets:e?[a]:[]})))},this.loadBearAttributes=async(t,e)=>{const{types:i}=this.options;if(!i.some((t=>"attribute"===t||"dateDataset"===t)))return[];const r=t.filter(ra.f).map((t=>t.links.self)),s=e.map((t=>t.attributeMeta.uri));return this.authCall((t=>t.md.getObjects(this.workspace,kr()([...r,...s]))))},this.loadCatalogGroups=async()=>{const{types:t,loadGroups:e}=this.options;if(!e||!t.some(La))return[];const{dataset:i}=this.options,{includeTagsIds:r,excludeTagsIds:s,dataSetId:a}=await this.getTagsAndDatasetIds();return(await this.authCall((t=>t.catalogue.loadGroups(this.workspace,{includeWithTags:r.length?r:void 0,excludeWithTags:s.length?s:void 0,production:Ua(this.options),csvDataSets:i?[a]:[]})))).map(wa)},this.getTagsAndDatasetIds=async()=>{if(!this.tagsAndDatasetIdsPromise){const{dataset:t,includeTags:e,excludeTags:i}=this.options;this.tagsAndDatasetIdsPromise=Promise.all([Ur(e,this.authCall),Ur(i,this.authCall),t?Br(t,this.authCall):Promise.resolve("")]).then((([t,e,i])=>({dataSetId:i,excludeTagsIds:e,includeTagsIds:t})))}return this.tagsAndDatasetIdsPromise}}withOptions(t){const e=Object.assign(Object.assign({},this.options),t);return new Wa(this.authCall,this.workspace,e)}forDataset(t){return this.withOptions({dataset:t})}forTypes(t){return this.withOptions({types:t})}includeTags(t){return this.withOptions({includeTags:t})}excludeTags(t){return this.withOptions({excludeTags:t})}withGroups(t){return this.withOptions({loadGroups:t})}async load(){const[{allCatalogItems:t,mappings:e},i]=await Promise.all([this.loadAllCatalogItemsAndMappings(),this.loadCatalogGroups()]);return new Ba(this.authCall,this.workspace,i,t,this.options,e)}}const Na={locale:"en-US",userId:"Anonymous",separators:{thousand:",",decimal:"."}},Ga={metadataTimeZone:"Europe/Prague"},qa=["enableAnalyticalDashboardPermissions","enableNewAnalyticalDashboardsNavigation"];class Va{constructor(t,e){this.authCall=t,this.workspace=e}getSettings(){return this.authCall((async t=>{const e=await t.project.getProjectFeatureFlags(this.workspace);return Object.assign(Object.assign(Object.assign({},Ga),{workspace:this.workspace}),e)}))}getSettingsForCurrentUser(){return this.authCall((async(t,{getPrincipal:e})=>{const i=await Sr(e);if(!i){const t=await this.getSettings();return Object.assign(Object.assign(Object.assign({},Ga),Na),t)}const[r,s,a,n]=await Promise.all([t.project.getProjectFeatureFlags(this.workspace),t.user.getUserFeatureFlags(i,["user"]),t.user.getCurrentProfile(),t.user.getUserRegionalNumberFormatting(i)]),{language:o}=a;return Object.assign(Object.assign(Object.assign({},Ga),{userId:i,workspace:this.workspace,locale:o,separators:n}),((t,e)=>Object.assign(Object.assign({},t),(t=>{const e=Object.assign({},t);for(const t of qa)delete e[t];return e})(e)))(r,s))}))}setLocale(t){throw new fi.tn("Backend does not support workspace locale setup")}}const Ha={permissions:{}};class _a{constructor(t,e){this.authCall=t,this.workspace=e}async getPermissionsForCurrentUser(){return(({permissions:t})=>Object.keys(t).reduce(((e,i)=>{const r=t[i];return e[i]="1"===r,e}),{}))((await this.authCall((async(t,{getPrincipal:e})=>{const i=await Tr(e);return t.project.getPermissions(this.workspace,i)}))).associatedPermissions||Ha)}}var Ka=i(95175),Ja=i.n(Ka);const Qa=t=>{const{content:e,meta:i}=t.visualizationClass;return{visualizationClass:Object.assign(Object.assign({},e),{identifier:i.identifier,title:i.title,uri:i.uri})}};var Za=i(98857),Xa=i.n(Za),Ya=i(52948),tn=i.n(Ya),en=i(27098),rn=i.n(en),sn=i(35182),an=i.n(sn);const nn=t=>{switch(t){case"displayForm":return"attributeDisplayForm";case"measure":return"metric";case"variable":return"prompt";default:return t}},on=["fact","attribute"],ln=on.map(nn);class un{constructor(t,e,i,r){this.authCall=t,this.workspace=e,this.insight=i,this.requestedTypes=r,this.run=async()=>{if(n()(this.typesForXref))return{};const t=await this.findReferencedObjects();if(this.requestedTypes.includes("dataSet")){const e=await this.findDatasets(t);t.push(...e)}const e=await this.loadObjects(t);return this.createResult(e)},this.findReferencedObjects=async()=>{const t=this.typesForXref.map(nn),{entries:e}=await this.authCall((e=>e.xhr.getParsed(`/gdc/md/${this.workspace}/using2/${this.objectId}?types=${t.join(",")}`)));return e},this.findDatasets=async t=>{const e={inUseMany:{uris:t.filter((t=>ln.includes(t.category))).map((t=>t.link)),types:["dataSet"],nearest:!1}},i=await this.authCall((t=>t.xhr.postParsed(`/gdc/md/${this.workspace}/usedby2`,{body:e})));return Hr()(rn()((t=>t.entries)),an()((t=>t.identifier)))(tn()(i.useMany))},this.loadObjects=async t=>{const e=this.typesForLoad.map(nn),i=t.filter((t=>e.includes(t.category))).map((t=>t.link));return this.authCall((t=>t.md.getObjects(this.workspace,i)))};const s=(0,Cr.T)(this.insight);var a;this.objectId=Er(s),this.typesForXref=function(t){let e=t.includes("dataSet")?Xa()(t,on):t;return(t.includes("attribute")||t.includes("displayForm"))&&(e=Xa()(e,["attribute","displayForm"])),e}(this.requestedTypes),this.typesForLoad=(a=this.requestedTypes).includes("attribute")||a.includes("displayForm")?Xa()(a,["attribute","displayForm"]):a}createResult(t){const e=t.map(_r),i=e.map(ds),r=this.requestedTypes.includes("dataSet");if(1===this.requestedTypes.length&&r)return{dataSetMeta:i};const s=ta()(e,(t=>t.meta.uri)),a=[],n=[];i.forEach((t=>{const e=s[t.uri];switch(t.type){case"displayForm":case"variable":break;case"attribute":a.push((t=>{var e,i;const{content:r,meta:s}=t.attribute,a=(0,Ui.lR)(s.uri),n=null!==(e=r.displayForms)&&void 0!==e?e:[],o=null!==(i=n.find((t=>1===t.content.default)))&&void 0!==i?i:n[0],l=n.filter((t=>"GDC.geo.pin"===t.content.type));return(0,sa.W)((t=>{let e=t.attribute(a,(t=>t.modify(ma(s)))).displayForms(n.map((t=>(0,ts.H)((0,Ui.lR)(t.meta.uri),(e=>e.modify(ma(t.meta)).attribute(a).displayFormType(t.content.type)))))).geoPinDisplayForms(l.map((t=>(0,ts.H)((0,Ui.lR)(t.meta.uri),(e=>e.modify(ma(t.meta)).attribute(a).displayFormType(t.content.type))))));return o&&(e=e.defaultDisplayForm((0,Ui.lR)(o.meta.uri),(t=>t.modify(ma(o.meta)).attribute(a).displayFormType(o.content.type)))),e}))})({attribute:e}));break;case"fact":a.push((t=>{const{meta:e}=t.fact,i=(0,Ui.lR)(e.uri);return(0,na.Z)((t=>t.fact(i,(t=>t.modify(ma(e))))))})({fact:e}));break;case"measure":a.push(va({metric:e}));break;case"dataSet":n.push(t)}}));const o=r?{dataSetMeta:n}:{};return Object.assign(Object.assign({},o),{catalogItems:a})}}var cn=i(19113),dn=i(55991),hn=i(34183),pn=i.n(hn),gn=i(48870),mn=i.n(gn);const fn=t=>(0,Ii.tG)(t)||(0,Ii.Ey)(t);async function bn(t,e){const[i,r]=pn()(fn,t),s=r.map(Ii.zH),a=await e(s),n=mn()(r,a).map((([t,e])=>{if((0,Ii.yf)(t)){const{from:i,to:r}=(0,Ii.Nl)(t);return(0,dn.xk)((0,Ui.lR)(e),i,r)}if((0,Ii.QJ)(t)){const{granularity:i,from:r,to:s}=(0,Ii.wF)(t);return(0,dn.u3)((0,Ui.lR)(e),i,r,s)}if((0,Ii.Vc)(t)){const i=(0,Ii.eh)(t);return(0,dn.Z1)((0,Ui.lR)(e),i)}if((0,Ii.II)(t)){const i=(0,Ii.eh)(t);return(0,dn.o7)((0,Ui.lR)(e),i)}return t}));return[...i,...n]}var yn=i(29118);function vn(t){return kr()(Et()([t.visualizationObject.meta.author,t.visualizationObject.meta.contributor]))}function wn(t){return kr()(Et()([t.dashboardPlugin.meta.author,t.dashboardPlugin.meta.contributor]))}class jn{constructor(t,e){this.authCall=t,this.workspace=e,this.getVisualizationClass=async t=>{const e=await $r(t,this.workspace,this.authCall),i=await this.authCall((t=>t.md.getObjects(this.workspace,[e])));return Qa(i[0])},this.getVisualizationClasses=async(t={})=>{const e=await this.authCall((e=>{const i={category:"visualizationClass"};return t.includeDeprecated&&(i.deprecated=!0),e.md.getObjectsByQuery(this.workspace,i)}));return Hr()(Ja()((t=>{var e;return null!==(e=t.visualizationClass.content.orderIndex)&&void 0!==e?e:0})),Jr()(Qa))(e)},this.getInsight=async(t,e={})=>{const i=await $r(t,this.workspace,this.authCall),r=await this.authCall((t=>t.md.getVisualization(i))),s=e.loadUserData?await Mr(new Map,vn(r),this.authCall):void 0,a=(await this.authCall((t=>t.md.getObjects(this.workspace,[r.visualizationObject.content.visualizationClass.uri]))))[0].visualizationClass.content.url;return qs(r,a,s)},this.getVisualizationClassesByVisualizationClassUri=async(t={})=>(await this.getVisualizationClasses(t)).reduce(((t,e)=>(e.visualizationClass.uri&&(t[e.visualizationClass.uri]=e.visualizationClass.url),t)),{}),this.getInsights=async t=>{const e=await this.getVisualizationClassesByVisualizationClassUri({includeDeprecated:!0});return this.getInsightsInner(null!=t?t:{},e,new Map)},this.getInsightsInner=async(t,e,i)=>{var r;const s=Object.assign(Object.assign({},t),{getTotalCount:!0});return yn.r.for((async({limit:r,offset:a})=>{const n=await this.authCall((t=>t.md.getObjectsByQueryWithPaging(this.workspace,Object.assign(Object.assign({category:"visualizationObject"},s),{limit:r,offset:a})))),{items:o,paging:{totalCount:l}}=n,u=t.loadUserData?await Mr(i,Xs()(o,vn),this.authCall):i;return{items:o.map((t=>qs(t,e[t.visualizationObject.content.visualizationClass.uri],u))),totalCount:l}}),null!==(r=s.limit)&&void 0!==r?r:50,s.offset)},this.createInsight=async t=>{const e=await this.getInsightWithConvertedVisClass(t),i=await this.authCall((t=>t.md.saveVisualization(this.workspace,{visualizationObject:Ta(e)})));return qs(i,(0,Cr.Yt)(t))},this.updateInsight=async t=>{const e=(0,Cr.wG)(t),i=await this.authCall((t=>t.md.getObjectUri(this.workspace,e))),r=await this.getInsightWithConvertedVisClass(t);return await this.authCall((t=>t.md.updateVisualization(this.workspace,i,{visualizationObject:Ea(r)}))),t},this.deleteInsight=async t=>{const e=await $r(t,this.workspace,this.authCall);await this.authCall((t=>t.md.deleteVisualization(e)))},this.openInsightAsReport=async t=>{const e=Ta(t);return this.authCall((t=>t.md.openVisualizationAsReport(this.workspace,{visualizationObject:e})))},this.getInsightReferencedObjects=async(t,e=["dataSet","measure","fact","attribute"])=>new un(this.authCall,this.workspace,t,e).run(),this.getInsightReferencingObjects=async t=>{const e=await $r(t,this.workspace,this.authCall),i=Er(e);return this.authCall((async t=>({analyticalDashboards:(await t.xhr.getParsed(`/gdc/md/${this.workspace}/usedby2/${i}?types=analyticalDashboard`)).entries.map((t=>hs("analyticalDashboard",t)))})))},this.getInsightWithAddedFilters=async(t,e)=>{if(!e.length)return t;const i=await async function(t,e,i){const[r,s]=function(t){const e=t.filter((t=>!fn(t)));return e.every((t=>(0,Bi.$y)((0,Ii.zH)(t))))||e.every((t=>(0,Bi.hj)((0,Ii.zH)(t))))}([...t,...e])?[t,e]:await Promise.all([bn(t,i),bn(e,i)]);return(0,cn.f)(r,s)}((0,Cr.Tm)(t),e,(t=>zr(t,this.workspace,this.authCall)));return(0,Cr.AZ)(t,i)},this.getVisualizationClassByUrl=async t=>(await this.getVisualizationClasses()).find((e=>e.visualizationClass.url===t))}async getInsightWithConvertedVisClass(t){const e=(0,Cr.Yt)(t),i=await this.getVisualizationClassByUrl(e);if(!i)throw new Error(`Visualization class with url ${e} not found.`);return{insight:Object.assign(Object.assign({},t.insight),{visualizationUrl:i.visualizationClass.uri})}}}const Cn=t=>Object.assign({},t);class On{constructor(t,e){this.authCall=t,this.workspace=e}async getDatasets(){return(await this.authCall((t=>t.catalogue.loadDataSets(this.workspace)))).map(Cn)}async getAllDatasetsMeta(){return(await this.authCall((t=>t.project.getDatasets(this.workspace)))).map((t=>hs("dataSet",t)))}}var Dn=i(11985),xn=i(5953),kn=i(84879),Fn=i(29322),An=i(43050),In=i(10897),Pn=i(96783);const Rn=t=>((0,N.kG)((0,Bi.hj)(t)),t.uri),Sn=t=>((0,N.kG)((0,Bi.Mt)(t)),t.localIdentifier),Tn=t=>{const e={width:t.gridWidth};return t.gridHeight&&(e.height=t.gridHeight),t.heightAsRatio&&(e.heightAsRatio=t.heightAsRatio),e},En=t=>["xl","md","lg","sm","xs"].reduce(((e,i)=>{const r=t[i];return r&&(e[i]=Tn(r)),e}),{}),$n=t=>{var e,i;const r={columns:t.items.map((t=>(t=>{const{size:e,widget:i}=t;if((0,xn.Qd)(i))return{size:En(e),content:{widget:{qualifier:{uri:Rn(i.ref)}}}};if((0,Fn.LI)(i))return{size:En(e),content:zn(i)};if((0,xn.eu)(i))throw new fi.S2("Cannot convert layout widget definition to bear model!");return{size:En(e)}})(t)))};if(t.header){const s=Ye()(t.header,(t=>!t));if(!n()(s)){const s={};(null===(e=t.header)||void 0===e?void 0:e.title)&&(s.title=t.header.title),(null===(i=t.header)||void 0===i?void 0:i.description)&&(s.description=t.header.description),r.header=s}}return r},zn=t=>{const{sections:e}=t,i={fluidLayout:{rows:e.map($n)}};return t.size&&(i.fluidLayout.size=Tn(t.size)),i},Bn=t=>{if((0,kn.jG)(t)){const{dateFilter:{granularity:e,type:i,attribute:r,dataSet:s,from:a,to:n}}=t,o={dateFilter:{granularity:e,type:i,from:null==a?void 0:a.toString(),to:null==n?void 0:n.toString()}};return r&&(o.dateFilter.attribute=Rn(r)),s&&(o.dateFilter.dataSet=Rn(s)),o}const{attributeFilter:{attributeElements:e,displayForm:i,negativeSelection:r,localIdentifier:s,title:a,filterElementsBy:n=[],selectionMode:o}}=t,l=Rn(i),u=n.map((t=>({filterLocalIdentifier:t.filterLocalIdentifier,over:{attributes:t.over.attributes.map(Rn)}})));if((0,Ii.ct)(e))throw new fi.tn("Bear backend does not support value attribute filters in analytical dashboards");return Wi(e),{attributeFilter:Object.assign({negativeSelection:r,attributeElements:e.uris,displayForm:l,localIdentifier:s,filterElementsBy:u,title:a},void 0!==o?{selectionMode:o}:{})}};function Un(t){if((0,kn.br)(t)){const{created:e,filters:i}=t;return{tempFilterContext:Object.assign({created:e,filters:i.map(Bn)},t?{uri:Rn(t.ref)}:{})}}const{description:e,filters:i,title:r}=t;return{filterContext:{content:{filters:i.map(Bn)},meta:Object.assign({summary:e,title:r},(0,kn.kx)(t)?{uri:Rn(t),identifier:t.identifier}:{})}}}const Mn=t=>(0,kn.V0)(t)?{dateFilterReference:{dataSet:Rn(t.dataSet)}}:{attributeFilterReference:{displayForm:Rn(t.displayForm)}};function Ln(t){if((0,An.x4)(t)){const{tab:e}=t;return{projectDashboard:Rn(t.target),projectDashboardTab:e}}const{origin:e}=t;let i;if((0,An.oU)(e)){const{measure:t}=e;i={drillFromMeasure:{localIdentifier:Sn(t)}}}else{if(!(0,An.KQ)(e))throw new fi.S2("Unable to convert unknown drill origin!");{const{attribute:t}=e;i={drillFromAttribute:{localIdentifier:Sn(t)}}}}if((0,An.hh)(t))return{drillToDashboard:{from:i,target:"in-place",toDashboard:void 0!==t.target?(r=t.target,(0,N.kG)((0,Bi.$y)(r)),r.identifier):void 0}};if((0,An.f5)(t))return{drillToVisualization:{from:i,target:"pop-up",toVisualization:{uri:Rn(t.target)}}};if((0,An.TR)(t))return{drillToCustomUrl:{from:i,target:"new-window",customUrl:t.target.url}};if((0,An.oZ)(t))return{drillToAttributeUrl:{from:i,target:"new-window",drillToAttributeDisplayForm:{uri:Rn(t.target.hyperlinkDisplayForm)},insightAttributeDisplayForm:{uri:Rn(t.target.displayForm)}}};var r;throw new fi.S2("Unable to convert unknown drill!")}const Wn=t=>{const{ignoreDashboardFilters:e,dateDataSet:i,title:r,description:s,drills:a}=t,o=Object.assign(Object.assign({},(0,xn.Qd)(t)?{identifier:t.identifier,uri:Rn(t.ref)}:{}),{title:r,summary:s}),l=i&&Rn(i),u=e.map(Mn);if("kpi"===t.type){(0,N.kG)(t.kpi,"Widget type is kpi, but kpi props are not defined!");const{kpi:e,configuration:i}=t;return{kpi:{content:Object.assign(Object.assign(Object.assign({},(0,In.VP)(e)?{comparisonDirection:e.comparisonDirection,comparisonType:e.comparisonType}:{comparisonType:e.comparisonType}),{metric:Rn(e.metric),ignoreDashboardFilters:u,dateDataSet:l,drillTo:a.length>0?Ln(a[0]):void 0}),i?{configuration:i}:{}),meta:o}}}const{insight:c,properties:d={},configuration:h}=t,{properties:p,references:g}=Ps({properties:d,references:{}}),m=Ye()(p,((t,e)=>"controls"!==e&&n()(t)));return{visualizationWidget:{content:Object.assign(Object.assign(Object.assign({visualization:Rn(c),ignoreDashboardFilters:u,dateDataSet:l,drills:a?a.map(Ln):[]},!n()(m)&&{properties:Ts(m)}),!n()(g)&&{references:g}),h?{configuration:h}:{}),meta:o}}},Nn=t=>{const{type:e}=t;return(0,m._T)(t,["type"])},Gn=t=>{const{type:e}=t;return(0,m._T)(t,["type"])},qn=t=>{const{plugin:e,parameters:i}=t;return{type:Rn(e),parameters:i}},Vn=t=>{const{filterContext:e,layout:i,ref:r,identifier:s,title:a,description:o,dateFilterConfig:l,isLocked:u,tags:c,plugins:d,shareStatus:h,isUnderStrictControl:p}=t,g=i&&zn(i),m=i&&(0,Dn.ln)(i),f=r&&Rn(r),b=(null==e?void 0:e.ref)&&Rn(e.ref),y=l&&(t=>{var e,i,r,s;const a=null===(i=null===(e=t.addPresets)||void 0===e?void 0:e.absolutePresets)||void 0===i?void 0:i.map(Nn),n=null===(s=null===(r=t.addPresets)||void 0===r?void 0:r.relativePresets)||void 0===s?void 0:s.map(Gn),o=a||n?Object.assign(Object.assign({},a&&{absolutePresets:a}),n&&{relativePresets:n}):void 0;return Object.assign(Object.assign({},t),o&&{addPresets:o})})(l),v=null==d?void 0:d.map(qn),w="shared"===h?{sharedWithSomeone:1}:{};let j={};return void 0!==p&&(j=p?{flags:["strictAccessControl"]}:{flags:[]}),{analyticalDashboard:{content:Object.assign(Object.assign(Object.assign({},y&&{dateFilterConfig:y}),v&&!n()(v)&&{plugins:v}),{filterContext:b,widgets:m?m.filter(xn.Qd).map((t=>Rn(t.ref))):[],layout:g}),meta:Object.assign(Object.assign(Object.assign(Object.assign({},f?{uri:f,identifier:s}:{}),{title:a,summary:o,locked:u,tags:null==c?void 0:c.join(" "),unlisted:"public"===h?0:1}),w),j)}}},Hn=t=>{const{dashboard:e,widget:i,description:r,isTriggered:s,threshold:a,title:n,whenTriggered:o,ref:l,identifier:u,filterContext:c}=t,d=l&&Rn(l);return{kpiAlert:{content:{filterContext:(null==c?void 0:c.ref)&&Rn(c.ref),dashboard:Rn(e),kpi:Rn(i),isTriggered:s,threshold:a,whenTriggered:o},meta:Object.assign(Object.assign({},d?{uri:d,identifier:u}:{}),{title:n,summary:r})}}},_n=t=>{if((0,Pn.X)(t)){const{dashboard:e,format:i,filterContext:r}=t;return{kpiDashboardAttachment:{uri:Rn(e),format:i,filterContext:r&&Rn(r)}}}if((0,Pn.z)(t)){const{widgetDashboard:e,widget:i,filterContext:r,formats:s,exportOptions:a}=t;return{visualizationWidgetAttachment:{uri:Rn(i),dashboardUri:Rn(e),formats:s,filterContext:r&&Rn(r),exportOptions:a&&{includeFilterContext:a.includeFilters?"yes":"no",mergeHeaders:a.mergeHeaders?"yes":"no"}}}}throw new fi.S2("Cannot convert scheduled email attachment - only dashboard and widget attachments are supported!")},Kn=t=>{const{title:e,description:i,uri:r,identifier:s,body:a,subject:n,to:o,when:l,bcc:u,lastSuccessful:c,unsubscribed:d,attachments:h,unlisted:p}=t;return{scheduledMail:{content:{attachments:h.map(_n),body:a,subject:n,to:o,when:{startDate:l.startDate,endDate:l.endDate,timeZone:l.timeZone,recurrency:l.recurrence},bcc:u,lastSuccessfull:c,unsubscribed:d},meta:Object.assign(Object.assign({unlisted:p?1:0},r?{uri:r,identifier:s}:{}),{title:e,summary:i})}}};function Jn(t){return!n()(t)&&!!t.kpi}function Qn(t){return!(0,kn.jG)(t)||void 0!==t.dateFilter.from||void 0!==t.dateFilter.to}const Zn=t=>{if(ii(t)){const{attributeFilter:{attributeElements:e,displayForm:i,negativeSelection:r,localIdentifier:s,title:a,filterElementsBy:n=[],selectionMode:o}}=t,l=n.map((t=>({filterLocalIdentifier:t.filterLocalIdentifier,over:{attributes:t.over.attributes.map(Ui.lR)}})));return{attributeFilter:Object.assign({attributeElements:{uris:e},displayForm:(0,Ui.lR)(i),negativeSelection:r,localIdentifier:s,filterElementsBy:l,title:a},void 0!==o?{selectionMode:o}:{})}}const{dateFilter:{granularity:e,type:i,attribute:r,dataSet:s,from:a,to:n}}=t,o={dateFilter:{granularity:e,type:i,from:"relative"===i?Number(a):a,to:"relative"===i?Number(n):n}};return r&&(o.dateFilter.attribute=(0,Ui.lR)(r)),s&&(o.dateFilter.dataSet=(0,Ui.lR)(s)),o},Xn=t=>{const{filterContext:{content:{filters:e},meta:{identifier:i,uri:r,summary:s,title:a}}}=t;return Object.assign(Object.assign({description:s},r?{identifier:i,uri:r,ref:(0,Ui.lR)(r)}:{}),{title:a,filters:e.map(Zn)})},Yn=2,to=12,eo=t=>{const e={gridWidth:t.width};return t.height&&(e.gridHeight=t.height),t.heightAsRatio&&(e.heightAsRatio=t.heightAsRatio),e},io=t=>["xl","md","lg","sm","xs"].reduce(((e,i)=>{const r=t[i];return r&&(e[i]=eo(r)),e}),{}),ro=(t,e)=>{const{fluidLayout:{rows:i},fluidLayout:r}=t,s={type:"IDashboardLayout",sections:i.map((t=>((t,e)=>{const i={type:"IDashboardLayoutSection",items:t.columns.map((t=>((t,e)=>{const{content:i}=t;if(r=i,!n()(r)&&r.widget){const r=e.find((t=>{const{qualifier:e}=i.widget;return $s(e)?(0,Bi.T8)((0,Ui.lR)(e.uri),t.ref):(0,Bi.T8)((0,Ui.Ii)(e.identifier),t.ref)}));return{type:"IDashboardLayoutItem",size:io(t.size),widget:r}}return function(t){return!n()(t)&&!!t.fluidLayout}(i)?{type:"IDashboardLayoutItem",widget:ro(i,e),size:io(t.size)}:{type:"IDashboardLayoutItem",size:io(t.size)};var r})(t,e)))};return t.header&&(i.header=t.header),i})(t,e)))};return r.size&&(s.size=eo(r.size)),s};function so(t,e,i){if(t.length<1)return;const r=function(t,e,i){return[{type:"IDashboardLayoutSection",items:ao(t,e,i)}]}(t,e,i);return{type:"IDashboardLayout",sections:r}}function ao(t,e,i){return t.map((t=>function(t,e,i){return{type:"IDashboardLayoutItem",widget:t,size:{xl:{gridWidth:no(t,e,i)}}}}(t,e,i)))}function no(t,e,i){if("kpi"===t.type)return Yn;const r=t.insight.uri,s=e.find((t=>o(t)&&t.visualizationObject.meta.uri===r)).visualizationObject.content.visualizationClass.uri;return"headline"===i.find((t=>t.visualizationClass.meta.uri===s)).visualizationClass.content.url.split(":")[1]?Yn:to}const oo=t=>{const{drillTo:{projectDashboard:e,projectDashboardTab:i}={},metric:r}=t.kpi.content;return{type:"drillToLegacyDashboard",origin:{type:"drillFromMeasure",measure:(0,Ui.lR)(r)},target:(0,Ui.lR)(e),tab:i,transition:"in-place"}},lo=t=>{if(e=t,!vt()(e)&&e.drillFromMeasure)return{type:"drillFromMeasure",measure:t.drillFromMeasure};if(function(t){return!vt()(t)&&!!t.drillFromAttribute}(t))return{type:"drillFromAttribute",attribute:t.drillFromAttribute};throw new fi.S2("Unable to convert unknown drill origin!");var e},uo=t=>{if(e=t,!vt()(e)&&e.drillToDashboard){const{drillToDashboard:{toDashboard:e,target:i,from:r}}=t;return{type:"drillToDashboard",origin:lo(r),target:void 0!==e?(0,Ui.Ii)(e):void 0,transition:i}}if(function(t){return!vt()(t)&&!!t.drillToVisualization}(t)){const{drillToVisualization:{toVisualization:e,target:i,from:r}}=t;return{type:"drillToInsight",origin:lo(r),target:(0,Ui.lR)(e.uri),transition:i}}if(function(t){return!vt()(t)&&!!t.drillToCustomUrl}(t)){const{drillToCustomUrl:{target:e,customUrl:i,from:r}}=t;return{type:"drillToCustomUrl",origin:lo(r),target:{url:i},transition:e}}if(function(t){return!vt()(t)&&!!t.drillToAttributeUrl}(t)){const{drillToAttributeUrl:{drillToAttributeDisplayForm:e,insightAttributeDisplayForm:i,target:r,from:s}}=t;return{type:"drillToAttributeUrl",origin:lo(s),target:{displayForm:(0,Ui.lR)(i.uri),hyperlinkDisplayForm:(0,Ui.lR)(e.uri)},transition:r}}var e;throw new fi.S2("Unable to convert unknown drill!")},co=t=>{return e=t,!n()(e)&&e.dateFilterReference?{type:"dateFilterReference",dataSet:(0,Ui.lR)(t.dateFilterReference.dataSet)}:{type:"attributeFilterReference",displayForm:(0,Ui.lR)(t.attributeFilterReference.displayForm)};var e},ho=t=>{const{visualizationWidget:{content:{visualization:e,ignoreDashboardFilters:i,dateDataSet:r,drills:s,references:a,properties:n,configuration:o},meta:{identifier:l,uri:u,title:c,summary:d}}}=t,{properties:h}=Is({properties:Es(n),references:a||{}});return Object.assign({type:"insight",ref:(0,Ui.lR)(u),identifier:l,uri:u,title:c,description:d,insight:(0,Ui.lR)(e),dateDataSet:r?(0,Ui.lR)(r):void 0,ignoreDashboardFilters:i?i.map(co):[],drills:s?s.map(uo):[],properties:h},o?{configuration:o}:{})},po=t=>{const{kpi:{content:e,content:{dateDataSet:i,ignoreDashboardFilters:r,drillTo:s,configuration:a},meta:{identifier:o,uri:l,title:u,summary:c}}}=t;return Object.assign(Object.assign({type:"kpi",ref:(0,Ui.lR)(l),identifier:o,uri:l,title:u,description:c,dateDataSet:i?(0,Ui.lR)(i):void 0,ignoreDashboardFilters:r?r.map(co):[],drills:s?[oo(t)]:[]},a?{configuration:a}:{}),{kpi:(d=e,n()(d)||"none"!==d.comparisonType?{comparisonType:e.comparisonType,comparisonDirection:e.comparisonDirection,metric:(0,Ui.lR)(e.metric)}:{comparisonType:e.comparisonType,metric:(0,Ui.lR)(e.metric)})});var d},go=t=>{const{absolutePresets:e=[],relativePresets:i=[]}=t;return{absolutePresets:e.map((t=>Object.assign(Object.assign({},t),{type:"absolutePreset"}))),relativePresets:i.map((t=>Object.assign(Object.assign({},t),{type:"relativePreset"})))}},mo=t=>{const{filterName:e,mode:i,addPresets:r,hideGranularities:s,hideOptions:a}=t;return{filterName:e,mode:i,addPresets:r&&go(r),hideGranularities:s,hideOptions:a}},fo=t=>{const{type:e,parameters:i}=t;return{type:"IDashboardPluginLink",plugin:(0,Ui.lR)(e),parameters:i}},bo=(t,e)=>t&&!e?"private":t&&e?"shared":"public",yo=(t,e,i=[],r,s)=>{var a;const{meta:{summary:n,created:l,author:u,updated:c,contributor:d,identifier:h,uri:p,title:g,locked:m,tags:f,unlisted:b,sharedWithSomeone:y,flags:v},content:{layout:w,filterContext:j,dateFilterConfig:C,widgets:O,plugins:D}}=t.analyticalDashboard,x=e.filter((t=>!o(t))).map(vo),k=x.filter(xn.Qd),F=ta()(k,"uri"),A=O.map((t=>F[t])),I=x.find((t=>r?t.uri===r:t.uri===j)),P=(null==v?void 0:v.some((t=>"strictAccessControl"===t)))?{isUnderStrictControl:!0}:{};return Object.assign(Object.assign({type:"IDashboard",title:g,description:n,identifier:h,uri:p,ref:(0,Ui.lR)(p),created:l,createdBy:u?null==s?void 0:s.get(u):void 0,updated:c,updatedBy:d?null==s?void 0:s.get(d):void 0,isLocked:!!m,shareStatus:bo(!!b,!!y)},P),{dateFilterConfig:C&&mo(C),filterContext:r&&I?(R=I,Object.assign(Object.assign({},R),{filters:R.filters.filter(Qn)})):I,layout:w?ro(w,A):so(A,e,i),plugins:null==D?void 0:D.map(fo),tags:null!==(a=null==f?void 0:f.split(" ").filter((t=>t)))&&void 0!==a?a:[]});var R},vo=t=>{if(e=t,!vt()(e)&&jt()(e,"visualizationWidget"))return ho(t);if(Jn(t))return po(t);if(function(t){return!n()(t)&&t.hasOwnProperty("filterContext")}(t))return Xn(t);if(function(t){return!n()(t)&&t.hasOwnProperty("tempFilterContext")}(t))return(t=>{const{tempFilterContext:{created:e,filters:i,uri:r}}=t;return{uri:r,ref:(0,Ui.lR)(r),filters:i.map(Zn),created:e}})(t);var e;throw new Error("No converter for the dashboard dependency!")},wo=t=>{if(e=t,!n()(e)&&e.kpiDashboardAttachment){const{kpiDashboardAttachment:{format:e,uri:i,filterContext:r}}=t;return{dashboard:(0,Ui.lR)(i),format:e,filterContext:r?(0,Ui.lR)(r):void 0}}if(function(t){return!n()(t)&&!!t.visualizationWidgetAttachment}(t)){const{visualizationWidgetAttachment:{uri:e,dashboardUri:i,formats:r,filterContext:s,exportOptions:a}}=t,n=a?{exportOptions:{includeFilters:"yes"===a.includeFilterContext,mergeHeaders:"yes"===a.mergeHeaders}}:{};return Object.assign({widgetDashboard:(0,Ui.lR)(i),widget:(0,Ui.lR)(e),formats:r,filterContext:s?(0,Ui.lR)(s):void 0},n)}var e},jo=(t,e)=>{const{scheduledMail:{content:{attachments:i,body:r,subject:s,to:a,when:n,bcc:o,lastSuccessfull:l,unsubscribed:u},meta:{uri:c,identifier:d,title:h,summary:p,unlisted:g,author:m,contributor:f}}}=t,b=Et()(i.map(wo));return Object.assign(Object.assign({title:h,description:p},c?{ref:(0,Ui.lR)(c),identifier:d,uri:c}:{}),{body:r,subject:s,to:a,when:{startDate:n.startDate,endDate:n.endDate,timeZone:n.timeZone,recurrence:n.recurrency},bcc:o,lastSuccessful:l,unsubscribed:u,attachments:b,unlisted:!!g,createdBy:m?null==e?void 0:e.get(m):void 0,updatedBy:f?null==e?void 0:e.get(f):void 0})},Co=(t,e)=>{const{kpiAlert:{content:{dashboard:i,isTriggered:r,kpi:s,threshold:a,whenTriggered:n},meta:{uri:o,identifier:l,title:u,summary:c}}}=t;return Object.assign(Object.assign({title:u,description:c},o?{ref:(0,Ui.lR)(o),identifier:l,uri:o}:{}),{dashboard:(0,Ui.lR)(i),widget:(0,Ui.lR)(s),threshold:a,whenTriggered:n,isTriggered:r,filterContext:e&&Xn(e)})};function Oo(t,e){var i;const{dashboardPlugin:{content:{url:r},meta:{title:s,summary:a,uri:n,identifier:o,updated:l,created:u,tags:c,author:d,contributor:h}}}=t;return{type:"IDashboardPlugin",name:s,description:null!=a?a:"",uri:n,identifier:o,updated:l,created:u,createdBy:d?null==e?void 0:e.get(d):void 0,updatedBy:h?null==e?void 0:e.get(h):void 0,tags:null!==(i=null==c?void 0:c.split(" ").filter((t=>t)))&&void 0!==i?i:[],ref:(0,Ui.lR)(n),url:r}}var Do=i(7909),xo=i.n(Do);const ko=t=>"measure"===t?"metric":t;class Fo{constructor(t,e,i,r){this.authCall=t,this.workspace=e,this.widget=i,this.requestedTypes=r,this.run=async()=>{if(n()(this.typesForXref))return{};const t=await this.findReferencedObjects(),e=await this.loadObjects(t);return this.createResult(e)},this.findReferencedObjects=async()=>{const t=this.typesForXref.map(ko),{entries:e}=await this.authCall((e=>e.xhr.getParsed(`/gdc/md/${this.workspace}/using2/${this.objectId}?types=${t.join(",")}`)));return e},this.loadObjects=async t=>{const e=this.typesForLoad.map(ko),i=t.filter((t=>e.includes(t.category))).map((t=>t.link));return this.authCall((t=>t.md.getObjects(this.workspace,i)))};const s=(0,xn.np)(this.widget);this.objectId=Er(s),this.typesForXref=this.requestedTypes,this.typesForLoad=this.requestedTypes}createResult(t){const e=t.map(_r),i=e.map(ds),r=ta()(e,(t=>t.meta.uri)),s=[];return i.forEach((t=>{const e=r[t.uri];"measure"===t.type&&s.push(va({metric:e}))})),{catalogItems:s}}}var Ao=i(99449),Io=i.n(Ao);async function Po(t,e,i){if(!e||!t.length||t.every(Ii.wh))return[];const[r,...s]=await i([e,...t.map((t=>(0,Ii.zH)(t)))]),a=Io()(t,s).filter((([,t])=>r===t)).map((([t])=>t)),n=Dr()(a);return!n||(0,Ii.wh)(n)?[]:[n]}async function Ro(t,e,i){if(!e.length)return t;if(!t.length)return[];const r=await i([...e.map(kn.mu),...t.map((t=>(0,Ii.zH)(t)))]),s=e.length,a=r.slice(0,s),n=r.slice(s);return Io()(t,n).filter((([,t])=>!a.includes(t))).map((([t])=>t))}function So(t){return(0,kn.j)(t)?t.attributeFilter.displayForm:t.dateFilter.dataSet}var To=i(16206),Eo=i.n(To);const $o=["kpi","visualizationWidget","filterContext"];class zo{constructor(t,e){this.authCall=t,this.workspace=e,this.getDashboards=async(t={})=>{const e=await this.authCall((t=>t.md.getAnalyticalDashboards(this.workspace))),i=await this.getAccessibleDashboards(e,!!t.includeAvailableViaLink),r=t.loadUserData?await Mr(new Map,Et()(Xs()(i,(t=>[t.author,t.contributor]))),this.authCall):new Map;return i.map((t=>((t,e,i)=>{var r,s,a;const n=(null===(r=t.flags)||void 0===r?void 0:r.some((t=>"strictAccessControl"===t)))?{isUnderStrictControl:!0}:{};return Object.assign({ref:(0,Ui.lR)(t.link),identifier:t.identifier,uri:t.link,title:t.title,description:t.summary,updated:t.updated,updatedBy:t.contributor?null==i?void 0:i.get(t.contributor):void 0,created:t.created,createdBy:t.author?null==i?void 0:i.get(t.author):void 0,tags:null!==(a=null===(s=t.tags)||void 0===s?void 0:s.split(" ").filter(Boolean))&&void 0!==a?a:[],isLocked:!!t.locked,shareStatus:bo(!!t.unlisted,!!t.sharedWithSomeone),availability:e},n)})(t,this.isExplicitlyShared(t,e)?"full":"viaLink",r)))},this.getDashboard=async(t,e,i={})=>{const r=await $r(t,this.workspace,this.authCall),s=e?await $r(e,this.workspace,this.authCall):void 0,a=await this.getBearDashboard(r),n=[...$o],o=[];a.analyticalDashboard.content.layout||(n.push("visualizationObject"),o.push(...await this.getBearVisualizationClasses()));const[l,u]=await Promise.all([this.getBearDashboardDependencies(r,n),this.getBearExportFilterContext(e)]);u&&(a.analyticalDashboard.content.filterContext=s,l.push(u));const c=i.loadUserData?await Mr(new Map,(d=a,kr()(Et()([d.analyticalDashboard.meta.author,d.analyticalDashboard.meta.contributor]))),this.authCall):new Map;var d;return yo(a,l,o,s,c)},this.createDashboard=async t=>this.updateDashboard({type:"IDashboard",description:"",filterContext:void 0,title:"",shareStatus:"private",isUnderStrictControl:!1},t),this.updateDashboard=async(t,e)=>{if(!(0,Bi.T8)(t.ref,e.ref))throw new Error("Cannot update dashboard with different refs!");if(Si()(t,e))return t;const i=e.plugins?await this.ensureDashboardPluginLinksHaveUris(e.plugins):void 0,r=Object.assign(Object.assign({},e),{plugins:i}),[s,a]=await Promise.all([this.updateFilterContext(t.filterContext,r.filterContext),this.updateLayoutAndWidgets(t.layout,r.layout)]);if(!t.ref&&!r.ref){const t=Object.assign(Object.assign({},r),{filterContext:s,layout:a});return this.createBearDashboard(t)}const{created:n,updated:o,ref:l,uri:u,identifier:c}=t,d=Object.assign(Object.assign({},r),{created:n,updated:o,ref:l,uri:u,identifier:c,filterContext:s,layout:a}),h=this.collectDeletedWidgets(t.layout,r.layout),p=pt()(await Promise.all(h.map((t=>this.getBearWidgetAlertsForWidget(t)))));return p.length&&await this.deleteWidgetAlerts(p),await this.updateBearDashboard(d),await this.deleteBearWidgets(h),d},this.deleteDashboard=async t=>{await this.deleteBearMetadataObject(t)},this.exportDashboardToPdf=async(t,e)=>{const i=await $r(t,this.workspace,this.authCall),r=null==e?void 0:e.map(Bn);return this.authCall((t=>t.dashboard.exportToPdf(this.workspace,i,r).then((t=>t))))},this.createScheduledMail=async(t,e)=>{const i=e&&await this.createBearFilterContext(e),r=i?Object.assign(Object.assign({},t),{attachments:t.attachments.map((t=>Object.assign(Object.assign({},t),{filterContext:i.ref})))}):t,s=Kn(r),a=await this.authCall((t=>t.md.createObject(this.workspace,s)));return jo(a)},this.updateScheduledMail=async(t,e,i)=>{const r=Object.assign(Object.assign({},e),{attachments:e.attachments.map((t=>Object.assign(Object.assign({},t),{filterContext:i})))}),s=Kn(r);await this.updateBearMetadataObject(t,s)},this.deleteScheduledMail=async t=>{await this.deleteBearMetadataObject(t)},this.getScheduledMailsForDashboard=async(t,e={})=>{const{createdByCurrentUser:i}=e,r=i?await this.getScheduledMailObjectLinksForDashboardAndCurrentUser(t):await this.getScheduledMailObjectLinksForDashboard(t);let s=new Map;return e.loadUserData&&(s=await Mr(s,Et()(Xs()(r,(t=>[t.author,t.contributor]))),this.authCall),0===s.values.length&&await this.authCall((async t=>{var e,i;const r=await t.user.getCurrentProfile(),a=Ar(r);(null===(e=r.links)||void 0===e?void 0:e.self)&&s.set(null===(i=r.links)||void 0===i?void 0:i.self,a)}))),(await this.authCall((async t=>t.md.getObjects(this.workspace,r.map((({link:t})=>t)))))).map((t=>jo(t,s)))},this.getScheduledMailsCountForDashboard=async t=>(await this.getScheduledMailObjectLinksForDashboard(t)).length,this.getAllWidgetAlertsForCurrentUser=async()=>{const t=await this.getAllBearKpiAlertsForCurrentUser();return this.getConvertedAlerts(t)},this.getDashboardWidgetAlertsForCurrentUser=async t=>{const e=await this.getDashboardBearKpiAlertsForCurrentUser(t);return this.getConvertedAlerts(e)},this.getWidgetAlertsCountForWidgets=async t=>{const e=await Promise.all(t.map((t=>$r(t,this.workspace,this.authCall))));return(await this.authCall((t=>t.md.getObjectsUsedByMany(this.workspace,e,{types:["kpiAlert"],nearest:!0})))).map((t=>({ref:(0,Ui.lR)(t.uri),alertCount:t.entries.length})))},this.createWidgetAlert=async t=>{const[e,i]=await Promise.all([this.createOrUpdateWidgetAlertFilterContext(t),$r(t.dashboard,this.workspace,this.authCall)]),r=Object.assign(Object.assign({},t),{dashboard:(0,Ui.lR)(i),filterContext:e});return this.createBearWidgetAlert(r)},this.updateWidgetAlert=async t=>{const e=await this.createOrUpdateWidgetAlertFilterContext(t),i=Object.assign(Object.assign({},t),{filterContext:e});return this.updateBearWidgetAlert(i)},this.deleteWidgetAlert=async t=>{await this.deleteBearMetadataObject(t)},this.deleteWidgetAlerts=async t=>{const e=await Promise.all(t.map((t=>$r(t,this.workspace,this.authCall))));return this.authCall((t=>t.md.bulkDeleteObjects(this.workspace,e,"cascade")))},this.getWidgetReferencedObjects=async(t,e=["measure"])=>((0,N.kG)("kpi"===(0,xn.oS)(t),"getWidgetReferencedObjects is currently supported for kpi widgets only"),new Fo(this.authCall,this.workspace,t,e).run()),this.getResolvedFiltersForWidget=async(t,e)=>async function(t,e,i,r){const s=t.filter(Ii.gE),a=t.filter(Ii.ZU);if(!s.length&&!a.length)return t;const[n,o]=await Promise.all([Po(s,i,r),Ro(a,e,r)]),l=[...n,...o];return t.filter((t=>{return e=t,!((0,Ii.gE)(e)||(0,Ii.ZU)(e))||l.includes(t);var e}))}(e,t.ignoreDashboardFilters,t.dateDataSet,(t=>zr(t,this.workspace,this.authCall))),this.createBearWidgetAlert=async t=>{const e=Object.assign(Object.assign({},t),{title:t.title||"kpi alert"}),i=Hn(e),r=await this.authCall((t=>t.md.createObject(this.workspace,i))),s=Un(e.filterContext);return Co(r,s)},this.updateBearWidgetAlert=async t=>{const e=Hn(t);return await this.updateBearMetadataObject(t.ref,e),t},this.createOrUpdateWidgetAlertFilterContext=async t=>{const{filterContext:e}=t,i={title:`Filter context for ${(0,Bi.Rs)(t.widget)}`,description:"",filters:[]};return(0,kn.kx)(e)?this.updateBearFilterContext(e):this.createBearFilterContext(e||i)},this.getBearWidgetAlertsForWidget=async t=>(await this.authCall((e=>e.md.getObjectUsedBy(this.workspace,t.uri,{types:["kpiAlert"],nearest:!0})))).map((t=>(0,Ui.lR)(t.link))),this.getBearDashboard=async t=>this.authCall((e=>e.md.getObjectDetails(t))),this.createBearDashboard=async t=>{const e=Vn(t),i=await this.authCall((t=>t.md.createObject(this.workspace,e))),r=await this.getBearDashboardDependencies(i.analyticalDashboard.meta.uri,$o);return yo(i,r)},this.updateBearDashboard=async t=>{const e=Vn(t);return await this.updateBearMetadataObject(t.ref,e),t},this.getAccessibleDashboards=async(t,e)=>e?(await this.authCall((t=>t.md.getAnalyticalDashboards(this.workspace,!0)))).filter((e=>{var i;return this.isExplicitlyShared(e,t)||!(null===(i=null==e?void 0:e.flags)||void 0===i?void 0:i.includes("strictAccessControl"))})):t,this.updateLayoutAndWidgets=async(t,e)=>{if(!e)return;const i=this.collectCreatedWidgetsWithLayoutPaths(e),r=this.collectUpdatedWidgetsWithLayoutPaths(t,e);return(await Promise.all([...i.map((t=>this.createBearWidget(t.widget).then((e=>Object.assign(Object.assign({},t),{widget:e}))))),...r.map((t=>this.updateBearWidget(t.widget).then((e=>Object.assign(Object.assign({},t),{widget:e})))))])).reduce(((t,e)=>j()(t,e.path,e.widget)),xo()(e))},this.updateFilterContext=async(t,e)=>{if((0,kn.br)(t))throw new fi.S2("Cannot update temp filter context!");return(0,kn.Fk)(e)?this.createBearFilterContext(e):(0,kn.kx)(e)&&!Si()(t,e)?this.updateBearFilterContext(e):t},this.getBearExportFilterContext=async t=>{if(!t)return;const e=await $r(t,this.workspace,this.authCall);return this.authCall((async t=>{var i;let r;try{r=await t.md.getObjectDetails(e)}catch(t){throw 404===(null===(i=null==t?void 0:t.response)||void 0===i?void 0:i.status)&&(r=void 0),t}return r}))},this.createBearFilterContext=async t=>{const e=Un(await this.sanitizeFilterContext(t)),i=await this.authCall((t=>t.md.createObject(this.workspace,e)));return Xn(i)},this.updateBearFilterContext=async t=>{const e=Un(await this.sanitizeFilterContext(t));return await this.updateBearMetadataObject(t.ref,e),t},this.sanitizeFilterContext=t=>async function(t,e){const{filters:i}=t;if(!i.length)return t;const r=Et()(Xs()(i,(t=>{var e;return[So(t),...(0,kn.j)(t)?Xs()(null!==(e=t.attributeFilter.filterElementsBy)&&void 0!==e?e:[],(t=>t.over.attributes)):[]]}))),s=await e(r),a=Io()(r,s),n=i.map((t=>{var e;const i=So(t);if(!i)return t;const r=a.find((([t])=>t===i));(0,N.kG)(r);const s=(0,Ui.lR)(r[1]);if((0,kn.j)(t)){const i=null===(e=t.attributeFilter.filterElementsBy)||void 0===e?void 0:e.map((t=>Object.assign(Object.assign({},t),{over:Object.assign(Object.assign({},t.over),{attributes:t.over.attributes.map((t=>{const e=a.find((([e])=>e===t));return(0,N.kG)(e),(0,Ui.lR)(e[1])}))})})));return{attributeFilter:Object.assign(Object.assign({},t.attributeFilter),{displayForm:s,filterElementsBy:i})}}return{dateFilter:Object.assign(Object.assign({},t.dateFilter),{dataSet:s})}}));return Object.assign(Object.assign({},t),{filters:n})}(t,(t=>zr(t,this.workspace,this.authCall))),this.createBearWidget=async t=>{const e=Wn(t);return(t=>Jn(t)?po(t):ho(t))(await this.authCall((t=>t.md.createObject(this.workspace,e))))},this.updateBearWidget=async t=>{const e=Wn(t);return await this.updateBearMetadataObject(t.ref,e),t},this.deleteBearWidgets=async t=>{await Promise.all(t.map((t=>this.deleteBearMetadataObject(t.ref))))},this.collectCreatedWidgetsWithLayoutPaths=t=>(t?(0,Dn.Vy)(t):[]).filter((t=>(0,xn.eu)(t.widget))),this.collectUpdatedWidgetsWithLayoutPaths=(t,e)=>{const i=t?(0,Dn.Vy)(t):[];return(e?(0,Dn.Vy)(e):[]).filter((({widget:t})=>(0,xn.Qd)(t)&&i.some((e=>(0,xn.Qd)(e.widget)&&(0,Bi.T8)(t.ref,e.widget.ref)&&!Si()(t,e.widget)))))},this.collectDeletedWidgets=(t,e)=>{const i=t?(0,Dn.ln)(t):[],r=e?(0,Dn.ln)(e):[];return i.filter((t=>(0,xn.Qd)(t)&&r.every((e=>(0,xn.Qd)(e)&&!(0,Bi.T8)(t.ref,e.ref)))))},this.getAllBearKpiAlertsForCurrentUser=async()=>this.authCall((async(t,e)=>{const i=await Rr(e.getPrincipal);return i?t.md.getObjectsByQuery(this.workspace,{category:"kpiAlert",author:i}):[]})),this.getDashboardBearKpiAlertsForCurrentUser=async t=>{const e=await this.getAllBearKpiAlertsForCurrentUser();if(0===e.length)return[];const i=await $r(t,this.workspace,this.authCall);return e.filter((t=>t.kpiAlert.content.dashboard===i))},this.getConvertedAlerts=async t=>{const e=await this.getBearKpiAlertsFilterContexts(t),i=ta()(e,(t=>t.filterContext.meta.uri));return t.map((t=>{const e=i[t.kpiAlert.content.filterContext];return Co(t,e)}))},this.getBearKpiAlertsFilterContexts=async t=>{const e=t.map((t=>t.kpiAlert.content.filterContext)).filter((t=>!!t));return this.authCall((t=>t.md.getObjects(this.workspace,e)))},this.getScheduledMailObjectLinksForDashboard=async t=>{const e=await $r(t,this.workspace,this.authCall);return this.authCall((t=>t.md.getObjectUsedBy(this.workspace,e,{nearest:!0,types:["scheduledMail"]})))},this.getScheduledMailObjectLinksForDashboardAndCurrentUser=async t=>this.authCall((async(e,i)=>{const r=await Rr(i.getPrincipal);return r?(await this.getScheduledMailObjectLinksForDashboard(t)).filter((({author:t})=>t===r)):[]})),this.updateBearMetadataObject=async(t,e)=>{const i=await $r(t,this.workspace,this.authCall),r=Er(i);await this.authCall((t=>t.md.updateObject(this.workspace,r,e)))},this.deleteBearMetadataObject=async t=>{const e=await $r(t,this.workspace,this.authCall);return this.authCall((t=>t.md.deleteObject(e)))},this.getBearVisualizationClasses=async()=>this.authCall((t=>t.md.getObjectsByQuery(this.workspace,{category:"visualizationClass"}))),this.getBearDashboardDependencies=async(t,e)=>{const i=(await this.authCall((i=>i.md.getObjectUsing(this.workspace,t,{types:e,nearest:!1})))).map((t=>t.link));return this.authCall((t=>t.md.getObjects(this.workspace,i)))},this.getBearDashboardReferences=async(t,e)=>{const i=Et()(e.map(Bo));return n()(i)?{dependencies:[],visClassMapping:{}}:wi()(e,"insight")?Promise.all([this.getBearDashboardDependencies(t,i),this.insights.getVisualizationClassesByVisualizationClassUri({includeDeprecated:!0})]).then((([t,e])=>({dependencies:t,visClassMapping:e}))):this.getBearDashboardDependencies(t,i).then((t=>({dependencies:t,visClassMapping:{}})))},this.getDashboardReferencedObjects=async(t,e=["insight","dashboardPlugin"])=>{const i=[...e];if(n()(t.plugins)&&Eo()(i,(t=>"dashboardPlugin"===t)),n()(i))return{plugins:[],insights:[]};const{dependencies:r,visClassMapping:s}=await this.getBearDashboardReferences(t.uri,i),a=[],l=[];return r.forEach((t=>{var e;o(t)?a.push(qs(t,s[t.visualizationObject.content.visualizationClass.uri])):(e=t,n()(e)||void 0===e.dashboardPlugin||l.push(Oo(t)))})),{insights:a,plugins:l}},this.createDashboardPlugin=async t=>{const e=(t=>{const{uri:e,identifier:i,name:r,tags:s,description:a,url:n}=t;return{dashboardPlugin:{content:{url:n},meta:Object.assign(Object.assign({},e?{uri:e,identifier:i}:{}),{title:r,summary:a,tags:null==s?void 0:s.join(" ")})}}})(t),i=await this.authCall((t=>t.md.createObject(this.workspace,e)));if(void 0!==t.identifier){const e=Er(i.dashboardPlugin.meta.uri);i.dashboardPlugin.meta.identifier=t.identifier,await this.authCall((t=>t.md.updateObject(this.workspace,e,i)))}return Oo(i)},this.deleteDashboardPlugin=async t=>{const e=await $r(t,this.workspace,this.authCall);return this.authCall((t=>t.md.deleteObject(e)))},this.getDashboardPlugin=async(t,e)=>{const i=await $r(t,this.workspace,this.authCall),r=await this.authCall((t=>t.md.getObjectDetails(i)));return Oo(r,(null==e?void 0:e.loadUserData)?await Mr(new Map,wn(r),this.authCall):new Map)},this.getDashboardPlugins=async t=>{const e=(await this.authCall((t=>t.md.getDashboardPlugins(this.workspace)))).map((t=>t.link)),i=await this.authCall((t=>t.md.getObjects(this.workspace,e))),r=(null==t?void 0:t.loadUserData)?await Mr(new Map,Et()(Xs()(i,wn)),this.authCall):new Map;return i.map((t=>Oo(t,r)))},this.getDashboardPermissions=async t=>{try{const e=await $r(t,this.workspace,this.authCall);await this.authCall((t=>t.md.getObjectDetails(e)));const i=await this.authCall((()=>this.permissions.getPermissionsForCurrentUser())),r=i.canManageAnalyticalDashboard,s=i.canManageACL,a=r&&i.canManageProject;return{canEditDashboard:r,canEditLockedDashboard:a,canShareDashboard:s,canShareLockedDashboard:a,canViewDashboard:!0}}catch(t){return{canEditDashboard:!1,canEditLockedDashboard:!1,canShareDashboard:!1,canShareLockedDashboard:!1,canViewDashboard:!1}}},this.ensureDashboardPluginLinksHaveUris=async t=>{const e=await zr(t.map((t=>t.plugin)),this.workspace,this.authCall,!0);return t.map(((t,i)=>Object.assign(Object.assign({},t),{plugin:(0,Ui.lR)(e[i])})))},this.validateDashboardsExistence=async t=>{const e=await Promise.all(t.map((async t=>{try{const{title:e,identifier:i,isUnderStrictControl:r,uri:s}=await this.getDashboard(t);return{ref:t,title:r?void 0:e,identifier:i,uri:s}}catch(e){return 403===e.httpStatus?{ref:t,identifier:(0,Bi.Rs)(t),uri:""}:void 0}})));return Et()(e)},this.insights=new jn(this.authCall,this.workspace),this.permissions=new _a(this.authCall,this.workspace)}isExplicitlyShared(t,e){return e.some((({link:e})=>e===t.link))}async getDashboardWithReferences(t,e,i={},r=["insight"]){const s=await this.getDashboard(t,e,i);return{dashboard:s,references:await this.getDashboardReferencedObjects(s,r)}}}function Bo(t){return{insight:"visualizationObject",dashboardPlugin:"dashboardPlugin"}[t]}class Uo{constructor(t,e){this.authCall=t,this.workspace=e,this.options={}}withOptions(t){return this.options=t,this}async queryAll(){return(await this.query()).all()}async queryWorker(t){var e;const{search:i}=t;return yn.r.for((async({limit:t,offset:e})=>{const r=await this.authCall((r=>r.project.getUserListWithPaging(this.workspace,{prefixSearch:i,userState:"ACTIVE",offset:e,limit:t}))),{items:s,paging:{totalCount:a}}=r.userList;return{items:s.map(Ir),totalCount:a}}),null!==(e=this.options.limit)&&void 0!==e?e:1e3,this.options.offset)}async query(){return this.queryWorker(this.options)}}const Mo=t=>Object.assign({type:"allTime"},t),Lo=t=>Object.assign({type:"absoluteForm"},t),Wo=t=>{const{granularities:e}=t,i=(0,m._T)(t,["granularities"]);return Object.assign({type:"relativeForm",availableGranularities:e},i)},No=t=>Object.assign({type:"absolutePreset"},t),Go=t=>Object.assign({type:"relativePreset"},t),qo=t=>{const{dateFilterConfig:{content:{selectedOption:e,allTime:i,absoluteForm:r,relativeForm:s,absolutePresets:a,relativePresets:n},meta:o}}=t;return{ref:(0,Ui.lR)(o.uri),selectedOption:e,allTime:i&&Mo(i),absoluteForm:r&&Lo(r),relativeForm:s&&Wo(s),absolutePresets:null==a?void 0:a.map(No),relativePresets:null==n?void 0:n.map(Go)}};class Vo{constructor(t,e){this.authCall=t,this.workspace=e}withLimit(t){return(0,N.kG)(t>0,`limit must be a positive number, got: ${t}`),this.limit=t,this}withOffset(t){return this.offset=t,this}async query(){return this.queryWorker()}async queryWorker(){return yn.r.for((async({limit:t,offset:e})=>{const i=await this.authCall((i=>i.md.getObjectsByQueryWithPaging(this.workspace,{offset:e,limit:t,category:"dateFilterConfig",getTotalCount:!0}))),{items:r,paging:{totalCount:s}}=i;return{items:r.map(qo),totalCount:s}}),this.limit,this.offset)}}var Ho=i(99296),_o=i(45763),Ko=i.n(_o),Jo=i(47704),Qo=i.n(Jo);class Zo{constructor(t,e,i){this.authCall=t,this.displayFormRef=e,this.workspace=i,this.getAfm=async(t,e,i)=>{if(!(null==t?void 0:t.length)&&!(null==e?void 0:e.length)&&!(null==i?void 0:i.length))return;const r=(null==t?void 0:t.length)?[{expression:{value:await this.createFiltersExpressionFromAttributeFilters(t)}}]:void 0,s=(null==e?void 0:e.length)?e.map(Zi):void 0,a=r&&i&&[...r,...i];return{attributes:[{localIdentifier:"a1",displayForm:Mi(this.displayFormRef)}],filters:a||r||i,measures:s}},this.createFiltersExpressionFromAttributeFilters=async t=>{const e=t.map((t=>(0,Ii.zH)(t.attributeFilter))),i=Qo()([this.displayFormRef,...e],Bi.T8),[r,s]=await Promise.all([this.getIdentifierUriPairs(t),this.getDisplayFormAttributeUriMapping(i)]),a=t=>{const e=s.find((([e])=>(0,Bi.T8)(e,t)));return(0,N.kG)(e,`Attribute URI for the display form "${(0,Bi.Rs)(t)}" was not found`),e[1]},n=a(this.displayFormRef),o=Ko()(t,(t=>(t=>{if((0,Bi.hj)(t))return t.uri;{const e=r.find((e=>e.identifier===t.identifier));if(void 0===e)throw new Error(`URI for identifier ${t.identifier} have not been found`);return e.uri}})(t.overAttribute)));return Object.keys(o).map((t=>`((${o[t].map((t=>{const e=(0,Ii.II)(t.attributeFilter),i=(0,Ii.eh)(t.attributeFilter),r=(s=t.attributeFilter,a((0,Ii.zH)(s)));var s;if(!(0,Ii.OF)(i))throw new fi.tn("Only attribute elements by ref are supported in elements attribute filter on the bear backend");return`[${r}] ${e?"NOT IN":"IN"} (${i.uris.map((t=>`[${t}]`)).join(", ")})`})).join(" AND ")}) OVER [${t}] TO [${n}])`)).join(" AND ")},this.getIdentifierUriPairs=t=>{const e=this.getAllIdentifiersUsedInAttributeFilters(t);return this.authCall((t=>t.md.getUrisFromIdentifiers(this.workspace,e)))},this.getAllIdentifiersUsedInAttributeFilters=t=>Xs()(t,(t=>[t.overAttribute,(0,Ii.zH)(t.attributeFilter)].filter(Bi.$y).map((t=>t.identifier)))),this.getDisplayFormAttributeUriMapping=async t=>{const e=await zr(t,this.workspace,this.authCall);return this.authCall((async i=>{const r=await i.md.getObjects(this.workspace,e);return t.map((t=>{const e=r.find((e=>(0,Bi.$y)(t)?t.identifier===e.attributeDisplayForm.meta.identifier:t.uri===e.attributeDisplayForm.meta.uri));if(void 0===e)throw new Error("Cannot find attribute for display form");return[t,e.attributeDisplayForm.content.formOf]}))}))}}}class Xo{constructor(t,e){this.authCall=t,this.workspace=e}forDisplayForm(t){return new Yo(this.authCall,t,this.workspace)}forFilter(t,e){return new tl(this.authCall,t,e,this.workspace)}}class Yo{constructor(t,e,i){this.authCall=t,this.displayFormRef=e,this.workspace=i,this.limit=50,this.offset=0}withLimit(t){return(0,N.kG)(t>0,`limit must be a positive number, got: ${t}`),this.limit=t,this}withOffset(t){return this.offset=t,this}withAttributeFilters(t){return this.attributeFilters=t,this}withDateFilters(t){return this.dateFilters=t,this}withMeasures(t){return this.measures=t.length>0?t:void 0,this}withOptions(t){return this.options=t,this}withSignal(t){return console.warn("Cancelling requests is not supported on bear backend."),this}async query(){var t;const e=new Zo(this.authCall,this.displayFormRef,this.workspace);return this.limitingAfm=await e.getAfm(this.attributeFilters,this.measures,this.dateFilters),this.queryWorker(null!==(t=this.options)&&void 0!==t?t:{})}async getObjectId(){if(!this.objectId){const t=await $r(this.displayFormRef,this.workspace,this.authCall);this.objectId=Er(t)}return this.objectId}async queryWorker(t){const e=await this.getObjectId(),{elements:i}=t,r=(0,m._T)(t,["elements"]);(0,N.kG)(!(0,Ho.Gb)(i),"Specifying elements by value is not supported.");const s=null==i?void 0:i.uris;return(0,N.kG)(!s||s.every((t=>null!==t)),"Nulls are not supported as attribute element uris on bear"),yn.r.for((async({limit:t,offset:i})=>{const a=Object.assign(Object.assign(Object.assign({},r),{uris:s}),{limit:t,offset:i,afm:this.limitingAfm}),n=await this.authCall((t=>t.md.getValidElements(this.workspace,e,a))),{items:o,paging:l}=n.validElements,u=Number.parseInt(l.total,10);return{items:o.map((({element:t})=>t)),totalCount:u}}),this.limit,this.offset)}}class tl{constructor(t,e,i,r){this.authCall=t,this.filter=e,this.workspace=r,this.limit=50,this.offset=0;let s=(0,Ii.zH)(e);(0,Ii.QJ)(e)&&((0,N.kG)(i,"Date filter's display form needs to be defined"),s=i),this.elementsQuery=new Yo(this.authCall,s,this.workspace)}withLimit(t){return(0,N.kG)(t>0,`limit must be a positive number, got: ${t}`),this.limit=t,this}withOffset(t){return this.offset=t,this}async query(){if((0,Ii.ZU)(this.filter)){const t=(0,Ii.eh)(this.filter);return(0,Ii.OF)(t)?this.resultForElementsByRef(t):this.resultForElementsByValue(t)}return this.elementsQuery.withDateFilters([this.filter]).query()}async resultForElementsByRef(t){return t.uris.length?this.elementsQuery.withOptions({elements:{uris:t.uris}}).withOffset(this.offset).withLimit(this.limit).query():Promise.resolve(new yn.q([],this.limit,this.offset))}async resultForElementsByValue(t){const e=t.values.map((t=>({title:t,uri:t})));return Promise.resolve(new yn.q(e,this.limit,this.offset))}}class el{constructor(t,e){this.authCall=t,this.workspace=e,this.elements=()=>new Xo(this.authCall,this.workspace),this.getAttributeDisplayForm=async t=>{const e=await $r(t,this.workspace,this.authCall),i=(await this.authCall((t=>t.md.getObjectDetails(e)))).attributeDisplayForm;return this.buildAttributeDisplayForm(i)},this.getAttribute=async t=>{const e=await $r(t,this.workspace,this.authCall),i=await this.authCall((t=>t.md.getObjectDetails(e)));return this.buildAttribute(i.attribute)},this.getAttributeDisplayForms=async t=>{const e=await zr(t,this.workspace,this.authCall,!1);return(await this.authCall((t=>t.md.getObjects(this.workspace,e)))).map((t=>{if(e=t,vt()(e)||!jt()(e,"attributeDisplayForm"))throw new fi.S2("INVALID_REFERENCED_OBJECT",new Error("Referenced object is not attributeDisplayForm"));var e;const i=t.attributeDisplayForm;return this.buildAttributeDisplayForm(i)}))},this.getAttributes=async t=>{const e=await zr(t,this.workspace,this.authCall,!1);return(await this.authCall((t=>t.md.getObjects(this.workspace,e)))).map((t=>{const{meta:{title:e,uri:i,isProduction:r,identifier:s,summary:a},content:{displayForms:n}}=t.attribute,o=(0,Ui.lR)(i),l=n.map((t=>this.buildAttributeDisplayForm(t)));return(0,es.a)(o,(t=>t.title(e).uri(i).production(Boolean(r)).id(s).description(a).displayForms(l)))}))},this.buildAttributeDisplayForm=t=>{const{meta:{title:e,summary:i,identifier:r,uri:s},content:{formOf:a,default:n,type:o}}=t,l=(0,Ui.lR)(s),u=1===n;return(0,ts.H)(l,(t=>t.attribute((0,Ui.lR)(a)).title(e).description(i).isDefault(u).id(r).uri(s).displayFormType(o)))},this.buildAttribute=t=>{const{title:e,uri:i,isProduction:r,identifier:s,summary:a}=t.meta,{displayForms:n}=t.content,o=n.map((t=>this.buildAttributeDisplayForm(t))),l=(0,Ui.lR)(i);return(0,es.a)(l,(t=>t.title(e).uri(i).production(Boolean(r)).id(s).description(a).displayForms(o)))}}async getCommonAttributes(t){const e=await zr(t,this.workspace,this.authCall);return(await this.authCall((t=>t.ldm.getCommonAttributes(this.workspace,e)))).map(Ui.lR)}getCommonAttributesBatch(t){return Promise.all(t.map((async t=>this.getCommonAttributes(t))))}async getAttributeByDisplayForm(t){const e=await $r(t,this.workspace,this.authCall),i=await this.authCall((t=>t.md.getObjectDetails(e))),r=await this.authCall((t=>t.md.getObjectDetails(i.attributeDisplayForm.content.formOf)));return this.buildAttribute(r.attribute)}async getAttributeDatasetMeta(t){const e=await $r(t,this.workspace,this.authCall),i=Er(e);return this.authCall((async t=>{const e=await t.xhr.getParsed(`/gdc/md/${this.workspace}/usedby2/${i}?types=dataSet`);return(0,N.kG)(e.entries.length>0,"Attribute must have a dataset associated to it."),hs("dataSet",e.entries[0])}))}}class il{constructor(t,e){this.authCall=t,this.workspace=e}async getFactDatasetMeta(t){const e=await $r(t,this.workspace,this.authCall),i=Er(e);return this.authCall((async t=>{const e=await t.xhr.getParsed(`/gdc/md/${this.workspace}/usedby2/${i}?types=dataSet`);return(0,N.kG)(e.entries.length>0,"Fact must have a dataset associated to it."),hs("dataSet",e.entries[0])}))}}const rl=t=>{const{content:{name:e,description:i,id:r},links:s}=t;return{ref:(0,Ui.lR)(s.self),name:e,id:r,description:i}};class sl{constructor(t,e){this.authCall=t,this.workspace=e}async queryAllPages(t){const e=await this.authCall((e=>e.project.getUserGroups(this.workspace,{limit:t}))),{items:i,paging:r}=e.userGroups,s=async(t,e=[])=>{if(!t)return e;const i=await this.authCall((e=>e.xhr.getParsed(t))),{items:r,paging:a}=i.userGroups,n=[...e,...r];return t=a.next,s(a.next,n)};return s(r.next,i)}async query(t){const{offset:e=0,limit:i=100,search:r}=t;let s=await this.queryAllPages(i);if(r){const t=r.toLocaleLowerCase();s=s.filter((e=>{const{name:i}=e.userGroup.content;return(null==i?void 0:i.toLowerCase().indexOf(t))>-1}))}const a=s.map((t=>rl(t.userGroup)));return new yn.q(a,i,e)}}var al=i(80912);const nl=t=>{return e=t.aclEntry.grantee,n()(e)||void 0===e.user?{type:"group",userGroup:rl(t.aclEntry.grantee.userGroup)}:{type:"user",user:Pr(t.aclEntry.grantee.user)};var e},ol=t=>t.fullName?t.fullName:`${t.firstName} ${t.lastName}`,ll=t=>{var e;return{type:"user",ref:t.ref,name:ol(t),email:t.email,status:null!==(e=t.status)&&void 0!==e?e:"DISABLED"}},ul=t=>{var e;return{type:"group",ref:t.ref,name:null!==(e=t.name)&&void 0!==e?e:""}},cl=t=>{const{permissions:e,inheritedPermissions:i}=t,r=(0,m._T)(t,["permissions","inheritedPermissions"]),s=(0,al.Jo)(t)?"user":"group";return Object.assign(Object.assign({},r),{type:s})};class dl{constructor(t,e){this.authCall=t,this.workspace=e,this.users=new Uo(this.authCall,this.workspace),this.userGroups=new sl(this.authCall,this.workspace)}async getAccessList(t){const e=await $r(t,this.workspace,this.authCall),i=await this.authCall((t=>t.project.getGranteesInfo(e,{}))),{grantees:{items:r}}=i;return r.map(nl)}async grantAccess(t,e){const i=await $r(t,this.workspace,this.authCall),r=await Promise.all(e.map((t=>$r(t.granteeRef,this.workspace,this.authCall))));return this.authCall((t=>t.project.addGrantees(i,r)))}async revokeAccess(t,e){const i=await $r(t,this.workspace,this.authCall),r=await Promise.all(e.map((t=>$r(t.granteeRef,this.workspace,this.authCall))));return this.authCall((t=>t.project.removeGrantees(i,r)))}async changeAccess(t,e){const i=e.filter((t=>t.permissions.length>0)).map(cl),r=e.filter((t=>0===t.permissions.length)).map(cl);i.length&&await this.grantAccess(t,i),r.length&&await this.revokeAccess(t,r)}async getAvailableGrantees(t,e){let i={},r={};e&&(i=Object.assign(Object.assign({},i),{search:`%${e}`}),r=Object.assign(Object.assign({},r),{search:`${e}`}));const s=this.users.withOptions(i).query(),a=this.userGroups.query(r),[n,o]=await Promise.all([s,a]);return[...n.items.map(ll),...o.items.map(ul)]}}class hl{constructor(t,e,i){this.authCall=t,this.workspace=e,this.descriptor=i}async getDescriptor(){var t,e;if(!this.descriptor){const i=await this.authCall((async t=>t.project.getProject(this.workspace)));return{id:this.workspace,description:null!==(t=null==i?void 0:i.meta.summary)&&void 0!==t?t:"",title:null!==(e=null==i?void 0:i.meta.title)&&void 0!==e?e:""}}return this.descriptor}async getParentWorkspace(){}attributes(){return new el(this.authCall,this.workspace)}execution(){return new Wr(this.authCall,this.workspace)}settings(){return new Va(this.authCall,this.workspace)}insights(){return new jn(this.authCall,this.workspace)}dashboards(){return new zo(this.authCall,this.workspace)}measures(){return new Hs(this.authCall,this.workspace)}facts(){return new il(this.authCall,this.workspace)}styling(){return new Ks(this.authCall,this.workspace)}catalog(){return new Wa(this.authCall,this.workspace)}datasets(){return new On(this.authCall,this.workspace)}permissions(){return new _a(this.authCall,this.workspace)}users(){return new Uo(this.authCall,this.workspace)}dateFilterConfigs(){return new Vo(this.authCall,this.workspace)}userGroups(){return new sl(this.authCall,this.workspace)}accessControl(){return new dl(this.authCall,this.workspace)}}class pl{constructor(t){this.authCall=t}forUser(t){return new gl(this.authCall,t)}forCurrentUser(){return new gl(this.authCall)}}class gl{constructor(t,e){this.authCall=t,this.userId=e,this.limit=100,this.offset=0,this.search=void 0}withLimit(t){return this.limit=t,this}withOffset(t){return this.offset=t,this}withParent(){throw new fi.tn("not supported")}withSearch(t){return this.search=t,this}query(){return this.queryWorker()}async queryWorker(){return yn.r.for((async({limit:t,offset:e})=>{const i=await this.authCall((async(i,{getPrincipal:r})=>{const s=this.userId||await Tr(r);return i.project.getProjectsWithPaging(s,e,t,this.search)})),{items:r,paging:{totalCount:s}}=i.userProjects;return{items:r.map((t=>{const e=(({userProject:t})=>{const e={description:t.projectDescription,title:t.projectTitle,id:t.links.self.match(/\/gdc\/projects\/(.+)/i)[1]};return t.demoProject&&(e.isDemo=!0),e})(t);return new hl(this.authCall,e.id,e)})),totalCount:s}}),this.limit,this.offset)}}class ml{constructor(t){this.authCall=t}async getSettings(){return this.authCall((async(t,{getPrincipal:e})=>{const i=await Sr(e);if(!i)return Na;const[r,s,a]=await Promise.all([t.user.getUserFeatureFlags(i),t.user.getCurrentProfile(),t.user.getUserRegionalNumberFormatting(i)]),{language:n}=s;return Object.assign(Object.assign(Object.assign({},Ga),{userId:i,locale:n,separators:a}),r)}))}setLocale(t){throw new fi.tn("Backend does not support user locale setup")}}class fl{constructor(t){this.authCall=t}settings(){return new ml(this.authCall)}getUser(){return this.authCall((async t=>{const e=await t.user.getCurrentProfile();return Ar(e)}))}}const bl=(t,e,i)=>{const r=e.filter((t=>!wi()(i,t.uri))).find((e=>e.identifier===t));return null==r?void 0:r.uri};var yl=i(73075),vl=i(16893);class wl{constructor(t,e){this.authCall=t,this.scope=e,this.isUrlValid=(t,e)=>this.authCall((async i=>i.xhr.postParsed("/gdc/securitySettings/validate",{body:{validationRequest:{type:e,value:t,scope:this.scope}}}).then((({validationResponse:t})=>t.valid)))),this.isDashboardPluginUrlValid=async(t,e)=>{var i;const r=(0,vl.q)(t);if(r)return console.warn("Dashboard plugin URL is not valid: ",r),!1;const s=await this.authCall((async t=>t.project.getConfigItem(e,"dashboardPluginHosts")));return function(t,e){return!(!e||n()(e)||"string"!=typeof e)&&e.split(";").map((t=>t.trim())).filter((t=>!n()(t))).some((e=>t.startsWith(e)))}(t,null===(i=null==s?void 0:s.settingItem)||void 0===i?void 0:i.value)}}}class jl{constructor(){this.defaultReject=t=>Promise.reject(new fi.tn(t)),this.defaultRejectTheme=()=>this.defaultReject("Backend does not support theming on organization level"),this.defaultRejectColorPalette=()=>this.defaultReject("Backend does not support color palette on organization level"),this.getThemes=()=>this.defaultRejectTheme(),this.getActiveTheme=()=>this.defaultRejectTheme(),this.setActiveTheme=()=>this.defaultRejectTheme(),this.clearActiveTheme=()=>this.defaultRejectTheme(),this.createTheme=t=>this.defaultRejectTheme(),this.updateTheme=t=>this.defaultRejectTheme(),this.deleteTheme=t=>this.defaultRejectTheme(),this.getColorPalettes=()=>this.defaultRejectColorPalette(),this.getActiveColorPalette=()=>this.defaultRejectColorPalette(),this.setActiveColorPalette=()=>this.defaultRejectColorPalette(),this.clearActiveColorPalette=()=>this.defaultRejectColorPalette(),this.createColorPalette=t=>this.defaultRejectColorPalette(),this.updateColorPalette=t=>this.defaultRejectColorPalette(),this.deleteColorPalette=t=>this.defaultRejectColorPalette()}}class Cl{constructor(t,e,i){this.authCall=t,this.organizationId=e,this.organizationName=i}async getDescriptor(){if(this.organizationName)return{id:this.organizationId,title:this.organizationName};const t=await this.authCall((t=>t.user.getAccountInfo()));return{id:this.organizationId,title:t.organizationName}}securitySettings(){const t=`/gdc/domains/${this.organizationId}`;return new wl(this.authCall,t)}styling(){return new jl}settings(){throw new fi.tn("Backend does not support organization settings service")}}class Ol{constructor(t){this.authCall=t}async getCurrentOrganization(){const{organization:{id:t,name:e}}=await this.authCall((t=>t.organization.getCurrentOrganization()));return new Cl(this.authCall,t,e)}}class Dl{async resolveEntitlements(){return Promise.resolve([{name:"PdfExports"}])}}const xl={canCalculateGrandTotals:!0,canCalculateSubTotals:!0,canCalculateTotals:!0,canCalculateNativeTotals:!0,canExportCsv:!0,canExportXlsx:!0,canSortData:!0,canTransformExistingResult:!1,canWorkspaceManagerSeeEverySharedObject:!1,maxDimensions:2,supportsElementUris:!0,supportsObjectUris:!0,supportsCsvUploader:!0,supportsLegacyReports:!0,supportsRankingFilter:!0,supportsRankingFilterWithMeasureValueFilter:!0,supportsElementsQueryParentFiltering:!0,supportsKpiWidget:!0,supportsWidgetEntity:!0,supportsHyperlinkAttributeLabels:!0,supportsGenericDateAttributeElements:!0,supportsExplain:!1,supportsAccessControl:!0,usesStrictAccessControl:!1,supportsOwners:!0,allowsInconsistentRelations:!1,supportsTimeGranularities:!1,supportsHierarchicalWorkspaces:!1,supportsCustomColorPalettes:!0,supportsOrganizationSettings:!1,supportsInlineMeasures:!1,supportsBootstrapResource:!0,supportsMetadataObjectLocking:!0,supportsGranularAccessControl:!1,supportsEveryoneUserGroupForAccessControl:!0,supportsNonProductionDatasets:!0,supportsShowAllAttributeValues:!1,supportsSeparateLatitudeLongitudeLabels:!1,supportsEnumeratingDatetimeAttributes:!0};class kl{constructor(t,e,i,r){var s,a;if(this.capabilities=xl,this.isAuthenticated=async()=>{try{return await this.authProvider.getCurrentPrincipal({client:this.sdk,backend:this})}catch(t){if(Fl(t))return null;throw t}},this.authenticate=t=>t?this.triggerAuthentication(!0):this.authApiCall((async t=>{const e=await this.authProvider.getCurrentPrincipal({client:t,backend:this});return(0,N.kG)(e,"Principal must be defined"),e})),this.authApiCall=async(t,e=Fi)=>{try{return await t(this.sdk,await this.getAsyncCallContext())}catch(i){if((0,N.kG)(yi()(i)),!Fl(i))throw this.handleNotAuthenticated(e(i));try{return await this.triggerAuthentication(),await t(this.sdk,await this.getAsyncCallContext())}catch(t){throw(0,N.kG)(yi()(t)),this.handleNotAuthenticated(e(t))}}},this.getAuthenticationContext=()=>({client:this.sdk,backend:this}),this.triggerAuthentication=async(t=!1)=>{if(!this.authProvider)throw new fi.$b("Backend is not set up with authentication provider.");t&&this.authProvider.reset();try{return await this.authProvider.authenticate(this.getAuthenticationContext())}catch(t){throw(0,N.kG)(yi()(t)),this.handleNotAuthenticated(Fi(t))}},this.handleNotAuthenticated=t=>{var e,i;return(0,fi.wO)(t)&&(null===(i=(e=this.authProvider).onNotAuthenticated)||void 0===i||i.call(e,{client:this.sdk,backend:this},t)),t},this.getAsyncCallContext=async()=>({getPrincipal:async()=>{if(!this.authProvider)throw new fi.$b("Cannot obtain principal without an authProvider.");const t=await this.authProvider.getCurrentPrincipal({client:this.sdk,backend:this});return null!=t?t:this.authProvider.authenticate(this.getAuthenticationContext())}}),this.config=function(t){return null!=t?t:{}}(t),this.implConfig=function(t){return null!=t?t:{}}(e),this.telemetry=function(t){return null!=t?t:{}}(i),this.authProvider=r||new yl.v7,this.sdk=function(t,e,i){const r=e.factory?e.factory():mi();return t.hostname&&r.config.setCustomDomain(t.hostname),e.packageName&&e.packageVersion?r.config.setJsPackage(e.packageName,e.packageVersion):r.config.setJsPackage("@gooddata/sdk-backend-bear","0.0.0-dev.0"),i.componentName&&(r.config.setRequestHeader("X-GDC-JS-SDK-COMP",i.componentName),i.props&&!n()(i.props)&&r.config.setRequestHeader("X-GDC-JS-SDK-COMP-PROPS",i.props.join(","))),r}(this.config,this.implConfig,this.telemetry),this.implConfig.ajaxSettings&&this.sdk.xhr.ajaxSetup(this.implConfig.ajaxSettings),null===(a=(s=this.authProvider).initializeClient)||void 0===a||a.call(s,this.sdk),this.implConfig.onLegacyCallbacksReady){const t={openAsReport:(t,e)=>{const i=Ea(e);return this.authApiCall((e=>e.md.openVisualizationAsReport(t,{visualizationObject:i})))},getBootstrapResource:t=>this.authApiCall((e=>e.user.getBootstrapResource(t))),ajaxSetup:t=>{this.lastAjaxSetupSettings=t,this.sdk.xhr.ajaxSetup(t)},log:(t,e)=>this.sdk.xhr.post(t,{data:JSON.stringify({logMessages:e})}),updateProfileCurrentWorkspace:async(t,e)=>{var i,r;const s=null===(r=null===(i=e.links)||void 0===i?void 0:i.profile)||void 0===r?void 0:r.split("/").pop();(0,N.kG)(s,"Cannot obtain userId from IProfileSetting");const a=Object.assign(Object.assign({},e),{currentProjectUri:`/gdc/projects/${t}`});await this.authApiCall((t=>t.user.updateProfileSettings(s,{profileSetting:a})))},sanitizeDrillingActivationPostMessageData:(t,e)=>(async(t,e,i)=>{const{uris:r,identifiers:s,composedFrom:a}=e,n=Cs()(r)?r:[],o=Cs()(s)?s:[],l=(null==a?void 0:a.uris)&&Cs()(a.uris)?a.uris:[],u=(null==a?void 0:a.identifiers)&&Cs()(a.identifiers)?a.identifiers:[],c=kr()([...o,...u]),d=c.length?await i(t,c):[];return{uris:kr()([...n,...Et()(o.map((t=>bl(t,d,n))))]),composedFrom:{uris:kr()([...l,...Et()(u.map((t=>bl(t,d,l))))])}}})(t,e,((t,e)=>this.authApiCall((i=>i.md.getUrisFromIdentifiers(t,e))))),getProjectDashboards:t=>this.authApiCall((e=>e.md.getProjectDashboards(t))),getUrisFromIdentifiers:(t,e)=>this.authApiCall((i=>i.md.getUrisFromIdentifiers(t,e))),getObjectsByUri:(t,e)=>this.authApiCall((i=>i.md.getObjects(t,e))),getVisualizationObject:(t,e)=>this.authApiCall((async i=>{const[r]=await i.md.getObjects(t,[e]);return r})),getUISettings:()=>this.sdk.xhr.get("/gdc/account/organization/settings").then((t=>t.getData())),isDomainAdmin:t=>this.authApiCall((e=>e.xhr.get(`${t}/config`).then((t=>!0)).catch((t=>!Di(t)||403!==t.response.status))))};this.implConfig.onLegacyCallbacksReady(t)}}onHostname(t){return new kl(Object.assign(Object.assign({},this.config),{hostname:t}),this.implConfig,this.telemetry)}withTelemetry(t,e){return new kl(this.config,Object.assign(Object.assign({},this.implConfig),{ajaxSettings:this.lastAjaxSetupSettings}),{componentName:t,props:Object.keys(e)},this.authProvider)}withAuthentication(t){const e=new yl.qL(t);return new kl(this.config,this.implConfig,this.telemetry,e)}deauthenticate(){if(!this.authProvider)throw new fi.$b("Backend is not set up with authentication provider.");return this.authProvider.deauthenticate(this.getAuthenticationContext())}organization(t){return new Cl(this.authApiCall,t)}organizations(){return new Ol(this.authApiCall)}entitlements(){return new Dl}currentUser(){return new fl(this.authApiCall)}workspace(t){return new hl(this.authApiCall,t)}workspaces(){return new pl(this.authApiCall)}}function Fl(t){return Di(t)&&401===t.response.status}class Al{async deauthenticate(t){const e=t.client;await e.user.logout()}async getCurrentPrincipal(t){return this.principal||await this.obtainCurrentPrincipal(t),this.principal||null}async obtainCurrentPrincipal(t){const e=t.client,i=await e.user.getCurrentProfile();this.principal={userId:i.login,userMeta:i}}}class Il extends Al{constructor(t){super(),this.notAuthenticatedHandler=t,this.onNotAuthenticated=(t,e)=>{var i;null===(i=this.notAuthenticatedHandler)||void 0===i||i.call(this,t,e)}}async authenticate(t){const e=t.client;if(!await e.user.isLoggedIn())throw new fi.$b("Please make sure the context is already authenticated when using ContextDeferredAuthProvider");return await this.obtainCurrentPrincipal(t),(0,N.kG)(this.principal,"Principal must be obtainable after login"),this.principal}}const Pl=(t,e)=>function(t,e){return new kl(t,e)}(t,{...e,packageName:"@gooddata/sdk-ui-web-components",packageVersion:"workspace:*"}),Rl=t=>{window.location.href=`${t.backend.config.hostname}/account.html?lastUrl=${encodeURIComponent(window.location.href)}`},Sl=t=>{mi({domain:t.backend.config.hostname}).user.initiateSamlSso(window.location.href).catch((t=>{console.error("Failed to initialize Bear SAML SSO authentication.",t)}))}},10897:(t,e,i)=>{i.d(e,{RG:()=>o,VP:()=>n,jz:()=>a});var r=i(37693),s=i.n(r);function a(t){return n(t)||o(t)}function n(t){return!s()(t)&&("previousPeriod"===t.comparisonType||"lastYear"===t.comparisonType)}function o(t){return!s()(t)&&"none"===t.comparisonType}},96783:(t,e,i)=>{i.d(e,{X:()=>a,z:()=>n});var r=i(37693),s=i.n(r);function a(t){return!s()(t)&&void 0!==t.dashboard}function n(t){return!s()(t)&&void 0!==t.widget}},55991:(t,e,i)=>{i.d(e,{Z1:()=>n,o7:()=>o,qv:()=>c,u3:()=>u,xk:()=>l}),i(73734),i(20253);var r=i(61550),s=i(14215),a=i(2326);function n(t,e){return{positiveAttributeFilter:{displayForm:(0,s.K0)(t)?t:"string"==typeof t?(0,a.Ii)(t):(0,r.KH)(t),in:Array.isArray(e)?{values:e}:e}}}function o(t,e){return{negativeAttributeFilter:{displayForm:(0,s.K0)(t)?t:"string"==typeof t?(0,a.Ii)(t):(0,r.KH)(t),notIn:Array.isArray(e)?{values:e}:e}}}function l(t,e,i){return{absoluteDateFilter:{dataSet:(0,s.K0)(t)?t:(0,a.Ii)(t),from:e,to:i}}}function u(t,e,i,r){return{relativeDateFilter:{dataSet:(0,s.K0)(t)?t:(0,a.Ii)(t),granularity:e,from:i,to:r}}}function c(t){return{relativeDateFilter:{dataSet:(0,s.K0)(t)?t:(0,a.Ii)(t),granularity:"ALL_TIME_GRANULARITY",from:0,to:0}}}},6695:()=>{}}]);
//# sourceMappingURL=27a016fa9b75a8e395fb.js.map